"use strict";(self.webpackChunkgracefullight_github_io=self.webpackChunkgracefullight_github_io||[]).push([[21039],{26025:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>d,toc:()=>o});var l=i(52676),s=i(56448);const r={title:"nodejs alpine3.13 \ud14c\uc2a4\ud2b8",authors:"me",tags:["javascript","nodejs","alpine","docker"],date:new Date("2021-11-17T23:24:45.000Z")},a=void 0,d={permalink:"/en/2021/11/17/nodejs-alpine3-13-benchmark",source:"@site/blog/2021/11/17/nodejs-alpine3-13-benchmark.md",title:"nodejs alpine3.13 \ud14c\uc2a4\ud2b8",description:"\uac1c\uc694",date:"2021-11-17T23:24:45.000Z",tags:[{inline:!0,label:"javascript",permalink:"/en/tags/javascript"},{inline:!0,label:"nodejs",permalink:"/en/tags/nodejs"},{inline:!0,label:"alpine",permalink:"/en/tags/alpine"},{inline:!0,label:"docker",permalink:"/en/tags/docker"}],readingTime:3.725,hasTruncateMarker:!1,authors:[{name:"Gracefullight",title:"Owner",url:"https://github.com/gracefullight",imageURL:"https://avatars.githubusercontent.com/u/11773683?v=4",key:"me"}],frontMatter:{title:"nodejs alpine3.13 \ud14c\uc2a4\ud2b8",authors:"me",tags:["javascript","nodejs","alpine","docker"],date:"2021-11-17T23:24:45.000Z"},unlisted:!1,prevItem:{title:"feconf 2021",permalink:"/en/2021/12/02/feconf-2021"},nextItem:{title:"yarn berry \ub9c8\uc774\uadf8\ub808\uc774\uc158 \uccb4\ud06c\ub9ac\uc2a4\ud2b8",permalink:"/en/2021/09/11/yarn-berry-\ub9c8\uc774\uadf8\ub808\uc774\uc158-\uccb4\ud06c\ub9ac\uc2a4\ud2b8"}},c={authorsImageUrls:[void 0]},o=[{value:"\uac1c\uc694",id:"\uac1c\uc694",level:2},{value:"\ud788\uc2a4\ud1a0\ub9ac",id:"\ud788\uc2a4\ud1a0\ub9ac",level:2},{value:"\ud14c\uc2a4\ud2b81",id:"\ud14c\uc2a4\ud2b81",level:2},{value:"node.12",id:"node12",level:3},{value:"node.13",id:"node13",level:3},{value:"\uacb0\uacfc1",id:"\uacb0\uacfc1",level:3},{value:"\ud14c\uc2a4\ud2b82",id:"\ud14c\uc2a4\ud2b82",level:2},{value:"alpine:3.13",id:"alpine313",level:3},{value:"\uacb0\uacfc2",id:"\uacb0\uacfc2",level:3},{value:"\uacb0\ub860",id:"\uacb0\ub860",level:2},{value:"\ucc38\uc870",id:"\ucc38\uc870",level:2}];function t(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.a)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h2,{id:"\uac1c\uc694",children:"\uac1c\uc694"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["docker nodejs base image \uc5d0 alpine3.13 \uc5d0 \ub300\ud55c \uc774\ubbf8\uc9c0\uac00 \uc788\uc5b4\uc11c ",(0,l.jsx)(n.a,{href:"https://alpinelinux.org/posts/Alpine-3.13.0-released.html",children:"\ub9b4\ub9ac\uc988\ub178\ud2b8"}),"\ub97c \ud655\uc778\ud588\ub2e4."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Node.js (LTS) is compiled with -O2 instead of -Os which noticeably improves performance."})," \ub780 \uad6c\ubb38\uc774 \ub208\uc5d0 \ub744\uc5c8\ub2e4."]}),"\n",(0,l.jsx)(n.li,{children:"noticeably improves \ub780 \ucd94\uc0c1\uc801\uc778 \ud45c\ud604\uc740 \ud638\uae30\uc2ec\uc744 \uc790\uadf9\ud558\uae30\uc5d0 \ucda9\ubd84\ud588\ub2e4."}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\ud788\uc2a4\ud1a0\ub9ac",children:"\ud788\uc2a4\ud1a0\ub9ac"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\ucc98\uc74c\uc5d0 \ube4c\ub4dc \ud50c\ub798\uadf8 \ubcc0\uacbd\uc744 \uc81c\uc548\ud55c \uc0ac\ub78c\uc5d0 \ub530\ub974\uba74, \ube4c\ub4dc \ud50c\ub798\uadf8 \uc218\uc815\uc73c\ub85c ",(0,l.jsx)(n.a,{href:"https://lists.alpinelinux.org/~alpine/devel/%3C1593625212.dirkptm3b0.none%40localhost%3E",children:"15% speedup \uc774 \uc788\uc744 \uac83"}),"\uc774\ub77c\uace0 \ud558\uc600\ub2e4."]}),"\n",(0,l.jsxs)(n.li,{children:["\uc774\uc5d0 \uba87\uba87 \uc54c\ud30c\uc778 \ud328\ud0a4\uc9c0\ub4e4\uc774 O2 \ub85c \uc804\ud658\ub418\uc5c8\uace0, Node.js\ub3c4 ",(0,l.jsx)(n.a,{href:"https://git.alpinelinux.org/aports/commit/?id=53dd8b58d838892bd9fe4849d7e239e0406e14eb",children:"2020-12-19 \ucee4\ubc0b"}),"\uc5d0 \ud3ec\ud568\ub418\uc5c8\ub2e4."]}),"\n",(0,l.jsxs)(n.li,{children:["\uc5ec\uae30\uc5d4 \uc544\ub798\uc640 \uac19\uc740 \ucf54\uba58\ud2b8\uac00 \ub2ec\ub824\uc788\uace0, ",(0,l.jsx)(n.a,{href:"https://github.com/v8/web-tooling-benchmark",children:"v8/web-tooling-benchmark"}),"\ub97c \uc0ac\uc6a9\ud55c \uac83\uc73c\ub85c \ubcf4\uc600\ub2e4."]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Compiling with O2 instead of Os increases binary size by ~10%\n# (53.1 MiB -> 58.6 MiB), but also increases performance by ~20%\n# according to v8/web-tooling-benchmark\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\ud14c\uc2a4\ud2b81",children:"\ud14c\uc2a4\ud2b81"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\ube4c\ub4dc \ud50c\ub798\uadf8\uc758 \ubcc0\uacbd\uc73c\ub85c nodejs \uc720\uc800\uac00 \ubca0\uc774\uc2a4 \uc774\ubbf8\uc9c0\uc758 \ubc84\uc804\uc744 \ud558\ub098 \uc62c\ub824\uc8fc\ub294 \uac83\ub9cc\uc73c\ub85c \uc5b4\ud50c\ub9ac\ucf00\uc774\uc158\uc758 \uc131\ub2a5\uc744 20% \uae4c\uc9c0 \uc62c\ub9b4 \uc218 \uc788\ub2e4\ub294 \uc774\uc57c\uae30\ub85c \ubcf4\uc600\ub2e4."}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"https://github.com/fastify/benchmarks",children:"fastify/benchmarks"})," \ub808\ud30c\uc9c0\ud1a0\ub9ac\uc758 ",(0,l.jsx)(n.a,{href:"https://github.com/fastify/benchmarks/blob/master/benchmarks/express.js",children:"Express.js"})," \ub97c \uc544\ub798\ucc98\ub7fc \ub3c4\ucee4\ub77c\uc774\uc9d5\ud588\ub2e4."]}),"\n"]}),"\n",(0,l.jsxs)(n.h3,{id:"node12",children:["node",":lts-alpine3",".12"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-dockerfile",children:'# \ud14c\uc2a4\ud2b8 \ub2f9\uc2dc LTS === 14\nFROM node:lts-alpine3.12\n\nRUN mkdir -p /usr/src/app \\\n  && chown node:node -R /usr/src/app\n\nWORKDIR /usr/src/app\nCOPY --chown=node:node package*.json ./\n\nUSER node\nRUN npm install && npm cache clean --force\n\nCOPY --chown=node:node . .\nEXPOSE 3000\nCMD [ "node", "server.js" ]\n'})}),"\n",(0,l.jsxs)(n.h3,{id:"node13",children:["node",":lts-alpine3",".13"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-dockerfile",children:'# \ud14c\uc2a4\ud2b8 \ub2f9\uc2dc LTS === 14\nFROM node:lts-alpine3.13\n\nRUN mkdir -p /usr/src/app \\\n  && chown node:node -R /usr/src/app\n\nWORKDIR /usr/src/app\nCOPY --chown=node:node package*.json ./\n\nUSER node\nRUN npm install && npm cache clean --force\n\nCOPY --chown=node:node . .\nEXPOSE 3000\nCMD [ "node", "server.js" ]\n'})}),"\n",(0,l.jsx)(n.h3,{id:"\uacb0\uacfc1",children:"\uacb0\uacfc1"}),"\n",(0,l.jsx)(n.p,{children:"\ucee8\ud14c\uc774\ub108\ub294 \ud14c\uc2a4\ud2b8\ub418\ub294 \uc774\ubbf8\uc9c0\ub9cc\uc744 \ub744\uc6e0\uace0, docker 4CPUs, 6G RAM \uc5d0\uc11c \uc2e4\ud589\ud588\ub2e4."}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.code,{children:"autocannon -c 100 -d 40 -p 10 localhost:3000"})}),"\n",(0,l.jsx)(n.p,{children:"\ubd80\ud47c \uae30\ub300\ub9cc\ud07c \uacb0\uacfc\uac00 \uac19\uac8c \ub098\uc654\uc73c\uba74 \uc88b\uaca0\uc9c0\ub9cc \uacb0\uacfc \ucd94\uac00\ub97c \ubabb\ud560\ub9cc\ud07c Latency, Req/Sec, Bytes/Sec \ubaa8\ub4e0 \uc218\uce58\uc5d0\uc11c \uc5ce\uce58\ub77d \ub4a4\uce58\ub77d\ud558\ub294 \ubaa8\uc2b5\uc744 \ubcf4\uc600\ub2e4."}),"\n",(0,l.jsx)(n.h2,{id:"\ud14c\uc2a4\ud2b82",children:"\ud14c\uc2a4\ud2b82"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"noticeably improves \ub294 CPU intensive Task \ub97c \ube44\uad50\ud574\ubd10\uc57c\ud558\ub294 \uac83\uc77c\uae4c\ub780 \uc758\ubb38\ub9cc \ub0a8\uc558\ub2e4."}),"\n",(0,l.jsxs)(n.li,{children:["node official image \ub97c \ud655\uc778\ud574\ubcf4\ub2c8 ",(0,l.jsx)(n.a,{href:"https://github.com/nodejs/docker-node/blob/main/16/alpine3.13/Dockerfile",children:"nodejs.org\uc758 \ubc30\ud3ec\ubcf8"}),"\uc744 \ud480\uc5b4 \uc0ac\uc6a9\ud558\ub294 \uac83\uc73c\ub85c \ubcf4\uc600\ub2e4."]}),"\n",(0,l.jsx)(n.li,{children:"\ub530\ub77c\uc11c \uc774\ubbf8\uc9c0\ub97c alpine \ud328\ud0a4\uc9c0\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc788\uac8c \uc7ac\uad6c\uc131\ud558\uace0 \ud14c\uc2a4\ud2b8\ud588\ub2e4."}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"alpine313",children:"alpine:3.13"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-dockerfile",children:'FROM alpine:3.13\n\nRUN apk add --update nodejs npm\nRUN addgroup -g 1000 node \\\n  && adduser -u 1000 -G node -s /bin/sh -D node \\\n  && mkdir -p /usr/src/app \\\n  && chown node:node -R /usr/src/app\n\nWORKDIR /usr/src/app\nCOPY --chown=node:node package*.json ./\n\nUSER node\nRUN npm install && npm cache clean --force\n\nCOPY --chown=node:node . .\nEXPOSE 3000\nCMD [ "node", "server.js" ]\n'})}),"\n",(0,l.jsx)(n.h3,{id:"\uacb0\uacfc2",children:"\uacb0\uacfc2"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\ub354 \ub290\ub838\ub2e4."}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\uacb0\ub860",children:"\uacb0\ub860"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["noticeably improves, ~20% \ub780 \ubb38\uad6c\ub85c \uc778\ud574 ",(0,l.jsx)(n.code,{children:"fastify/benchmarks"})," \ub85c\uc9c1\uc73c\ub85c \ub3c4\ucee4\ub77c\uc774\uc9d5\ud558\uc5ec \ud14c\uc2a4\ud2b8\ud574\ubcf4\uc558\uc73c\ub098 \ube44\uc2b7\ud55c \ud37c\ud3ec\uba3c\uc2a4\ub97c \ubcf4\uc5ec\uc8fc\uc5c8\ub2e4."]}),"\n",(0,l.jsx)(n.li,{children:"\uc704\uc758 \uc218\uce58\ub97c \uac80\uc99d\ud560 \uc218 \uc788\ub294 \ud14c\uc2a4\ud2b8\ubca0\ub4dc\uac00 \uc788\ub2e4\uba74 \ub3cc\ub824\ubcf4\uace0 \uc2f6\ub2e4. (\ub9c1\ud06c \uc788\uc73c\uc2dc\uba74 \uacf5\uc720\ubd80\ud0c1\ub4dc\ub9bd\ub2c8\ub2e4.)"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\ucc38\uc870",children:"\ucc38\uc870"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Build flag \ube44\uad50: ",(0,l.jsx)(n.a,{href:"https://wiki.kldp.org/wiki.php/GccOptimizationOptions",children:"GCC Optimization Options"})]}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://git.alpinelinux.org/aports/tree/main/nodejs/APKBUILD?h=3.13-stable",children:"alpine3.13 nodejs apkbuild"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(t,{...e})}):t(e)}},56448:(e,n,i)=>{i.d(n,{Z:()=>d,a:()=>a});var l=i(75271);const s={},r=l.createContext(s);function a(e){const n=l.useContext(r);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),l.createElement(r.Provider,{value:n},e.children)}}}]);