"use strict";(self.webpackChunkgracefullight_github_io=self.webpackChunkgracefullight_github_io||[]).push([[96651],{49613:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>k});var a=t(59496);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var p=a.createContext({}),s=function(e){var n=a.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},c=function(e){var n=s(e.components);return a.createElement(p.Provider,{value:n},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,l=e.originalType,p=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),d=s(t),m=r,k=d["".concat(p,".").concat(m)]||d[m]||u[m]||l;return t?a.createElement(k,i(i({ref:n},c),{},{components:t})):a.createElement(k,i({ref:n},c))}));function k(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var l=t.length,i=new Array(l);i[0]=m;var o={};for(var p in n)hasOwnProperty.call(n,p)&&(o[p]=n[p]);o.originalType=e,o[d]="string"==typeof e?e:r,i[1]=o;for(var s=2;s<l;s++)i[s]=t[s];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},26945:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>i,default:()=>u,frontMatter:()=>l,metadata:()=>o,toc:()=>s});var a=t(31966),r=(t(59496),t(49613));const l={title:"nodejs alpine3.13 \ud14c\uc2a4\ud2b8",authors:"me",tags:["javascript","nodejs","alpine","docker"],date:new Date("2021-11-17T23:24:45.000Z")},i=void 0,o={permalink:"/en/2021/11/17/nodejs-alpine3-13-benchmark",source:"@site/blog/2021/11/17/nodejs-alpine3-13-benchmark.md",title:"nodejs alpine3.13 \ud14c\uc2a4\ud2b8",description:"\uac1c\uc694",date:"2021-11-17T23:24:45.000Z",formattedDate:"November 17, 2021",tags:[{label:"javascript",permalink:"/en/tags/javascript"},{label:"nodejs",permalink:"/en/tags/nodejs"},{label:"alpine",permalink:"/en/tags/alpine"},{label:"docker",permalink:"/en/tags/docker"}],readingTime:3.725,hasTruncateMarker:!1,authors:[{name:"Gracefullight",title:"Owner",url:"https://github.com/gracefullight",imageURL:"https://avatars.githubusercontent.com/u/11773683?v=4",key:"me"}],frontMatter:{title:"nodejs alpine3.13 \ud14c\uc2a4\ud2b8",authors:"me",tags:["javascript","nodejs","alpine","docker"],date:"2021-11-17T23:24:45.000Z"},prevItem:{title:"feconf 2021",permalink:"/en/2021/12/02/feconf-2021"},nextItem:{title:"yarn berry \ub9c8\uc774\uadf8\ub808\uc774\uc158 \uccb4\ud06c\ub9ac\uc2a4\ud2b8",permalink:"/en/2021/09/11/yarn-berry-\ub9c8\uc774\uadf8\ub808\uc774\uc158-\uccb4\ud06c\ub9ac\uc2a4\ud2b8"}},p={authorsImageUrls:[void 0]},s=[{value:"\uac1c\uc694",id:"\uac1c\uc694",level:2},{value:"\ud788\uc2a4\ud1a0\ub9ac",id:"\ud788\uc2a4\ud1a0\ub9ac",level:2},{value:"\ud14c\uc2a4\ud2b81",id:"\ud14c\uc2a4\ud2b81",level:2},{value:"node:lts-alpine3.12",id:"nodelts-alpine312",level:3},{value:"node:lts-alpine3.13",id:"nodelts-alpine313",level:3},{value:"\uacb0\uacfc1",id:"\uacb0\uacfc1",level:3},{value:"\ud14c\uc2a4\ud2b82",id:"\ud14c\uc2a4\ud2b82",level:2},{value:"alpine:3.13",id:"alpine313",level:3},{value:"\uacb0\uacfc2",id:"\uacb0\uacfc2",level:3},{value:"\uacb0\ub860",id:"\uacb0\ub860",level:2},{value:"\ucc38\uc870",id:"\ucc38\uc870",level:2}],c={toc:s},d="wrapper";function u(e){let{components:n,...t}=e;return(0,r.kt)(d,(0,a.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"\uac1c\uc694"},"\uac1c\uc694"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"docker nodejs base image \uc5d0 alpine3.13 \uc5d0 \ub300\ud55c \uc774\ubbf8\uc9c0\uac00 \uc788\uc5b4\uc11c ",(0,r.kt)("a",{parentName:"li",href:"https://alpinelinux.org/posts/Alpine-3.13.0-released.html"},"\ub9b4\ub9ac\uc988\ub178\ud2b8"),"\ub97c \ud655\uc778\ud588\ub2e4."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Node.js (LTS) is compiled with -O2 instead of -Os which noticeably improves performance.")," \ub780 \uad6c\ubb38\uc774 \ub208\uc5d0 \ub744\uc5c8\ub2e4."),(0,r.kt)("li",{parentName:"ul"},"noticeably improves \ub780 \ucd94\uc0c1\uc801\uc778 \ud45c\ud604\uc740 \ud638\uae30\uc2ec\uc744 \uc790\uadf9\ud558\uae30\uc5d0 \ucda9\ubd84\ud588\ub2e4.")),(0,r.kt)("h2",{id:"\ud788\uc2a4\ud1a0\ub9ac"},"\ud788\uc2a4\ud1a0\ub9ac"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\ucc98\uc74c\uc5d0 \ube4c\ub4dc \ud50c\ub798\uadf8 \ubcc0\uacbd\uc744 \uc81c\uc548\ud55c \uc0ac\ub78c\uc5d0 \ub530\ub974\uba74, \ube4c\ub4dc \ud50c\ub798\uadf8 \uc218\uc815\uc73c\ub85c ",(0,r.kt)("a",{parentName:"li",href:"https://lists.alpinelinux.org/~alpine/devel/%3C1593625212.dirkptm3b0.none%40localhost%3E"},"15% speedup \uc774 \uc788\uc744 \uac83"),"\uc774\ub77c\uace0 \ud558\uc600\ub2e4."),(0,r.kt)("li",{parentName:"ul"},"\uc774\uc5d0 \uba87\uba87 \uc54c\ud30c\uc778 \ud328\ud0a4\uc9c0\ub4e4\uc774 O2 \ub85c \uc804\ud658\ub418\uc5c8\uace0, Node.js\ub3c4 ",(0,r.kt)("a",{parentName:"li",href:"https://git.alpinelinux.org/aports/commit/?id=53dd8b58d838892bd9fe4849d7e239e0406e14eb"},"2020-12-19 \ucee4\ubc0b"),"\uc5d0 \ud3ec\ud568\ub418\uc5c8\ub2e4."),(0,r.kt)("li",{parentName:"ul"},"\uc5ec\uae30\uc5d4 \uc544\ub798\uc640 \uac19\uc740 \ucf54\uba58\ud2b8\uac00 \ub2ec\ub824\uc788\uace0, ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/v8/web-tooling-benchmark"},"v8/web-tooling-benchmark"),"\ub97c \uc0ac\uc6a9\ud55c \uac83\uc73c\ub85c \ubcf4\uc600\ub2e4.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# Compiling with O2 instead of Os increases binary size by ~10%\n# (53.1 MiB -> 58.6 MiB), but also increases performance by ~20%\n# according to v8/web-tooling-benchmark\n")),(0,r.kt)("h2",{id:"\ud14c\uc2a4\ud2b81"},"\ud14c\uc2a4\ud2b81"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\ube4c\ub4dc \ud50c\ub798\uadf8\uc758 \ubcc0\uacbd\uc73c\ub85c nodejs \uc720\uc800\uac00 \ubca0\uc774\uc2a4 \uc774\ubbf8\uc9c0\uc758 \ubc84\uc804\uc744 \ud558\ub098 \uc62c\ub824\uc8fc\ub294 \uac83\ub9cc\uc73c\ub85c \uc5b4\ud50c\ub9ac\ucf00\uc774\uc158\uc758 \uc131\ub2a5\uc744 20% \uae4c\uc9c0 \uc62c\ub9b4 \uc218 \uc788\ub2e4\ub294 \uc774\uc57c\uae30\ub85c \ubcf4\uc600\ub2e4."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/fastify/benchmarks"},"fastify/benchmarks")," \ub808\ud30c\uc9c0\ud1a0\ub9ac\uc758 ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/fastify/benchmarks/blob/master/benchmarks/express.js"},"Express.js")," \ub97c \uc544\ub798\ucc98\ub7fc \ub3c4\ucee4\ub77c\uc774\uc9d5\ud588\ub2e4.")),(0,r.kt)("h3",{id:"nodelts-alpine312"},"node:lts-alpine3.12"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-dockerfile"},'# \ud14c\uc2a4\ud2b8 \ub2f9\uc2dc LTS === 14\nFROM node:lts-alpine3.12\n\nRUN mkdir -p /usr/src/app \\\n  && chown node:node -R /usr/src/app\n\nWORKDIR /usr/src/app\nCOPY --chown=node:node package*.json ./\n\nUSER node\nRUN npm install && npm cache clean --force\n\nCOPY --chown=node:node . .\nEXPOSE 3000\nCMD [ "node", "server.js" ]\n')),(0,r.kt)("h3",{id:"nodelts-alpine313"},"node:lts-alpine3.13"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-dockerfile"},'# \ud14c\uc2a4\ud2b8 \ub2f9\uc2dc LTS === 14\nFROM node:lts-alpine3.13\n\nRUN mkdir -p /usr/src/app \\\n  && chown node:node -R /usr/src/app\n\nWORKDIR /usr/src/app\nCOPY --chown=node:node package*.json ./\n\nUSER node\nRUN npm install && npm cache clean --force\n\nCOPY --chown=node:node . .\nEXPOSE 3000\nCMD [ "node", "server.js" ]\n')),(0,r.kt)("h3",{id:"\uacb0\uacfc1"},"\uacb0\uacfc1"),(0,r.kt)("p",null,"\ucee8\ud14c\uc774\ub108\ub294 \ud14c\uc2a4\ud2b8\ub418\ub294 \uc774\ubbf8\uc9c0\ub9cc\uc744 \ub744\uc6e0\uace0, docker 4CPUs, 6G RAM \uc5d0\uc11c \uc2e4\ud589\ud588\ub2e4."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"autocannon -c 100 -d 40 -p 10 localhost:3000")),(0,r.kt)("p",null,"\ubd80\ud47c \uae30\ub300\ub9cc\ud07c \uacb0\uacfc\uac00 \uac19\uac8c \ub098\uc654\uc73c\uba74 \uc88b\uaca0\uc9c0\ub9cc \uacb0\uacfc \ucd94\uac00\ub97c \ubabb\ud560\ub9cc\ud07c Latency, Req/Sec, Bytes/Sec \ubaa8\ub4e0 \uc218\uce58\uc5d0\uc11c \uc5ce\uce58\ub77d \ub4a4\uce58\ub77d\ud558\ub294 \ubaa8\uc2b5\uc744 \ubcf4\uc600\ub2e4."),(0,r.kt)("h2",{id:"\ud14c\uc2a4\ud2b82"},"\ud14c\uc2a4\ud2b82"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"noticeably improves \ub294 CPU intensive Task \ub97c \ube44\uad50\ud574\ubd10\uc57c\ud558\ub294 \uac83\uc77c\uae4c\ub780 \uc758\ubb38\ub9cc \ub0a8\uc558\ub2e4."),(0,r.kt)("li",{parentName:"ul"},"node official image \ub97c \ud655\uc778\ud574\ubcf4\ub2c8 ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/nodejs/docker-node/blob/main/16/alpine3.13/Dockerfile"},"nodejs.org\uc758 \ubc30\ud3ec\ubcf8"),"\uc744 \ud480\uc5b4 \uc0ac\uc6a9\ud558\ub294 \uac83\uc73c\ub85c \ubcf4\uc600\ub2e4."),(0,r.kt)("li",{parentName:"ul"},"\ub530\ub77c\uc11c \uc774\ubbf8\uc9c0\ub97c alpine \ud328\ud0a4\uc9c0\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc788\uac8c \uc7ac\uad6c\uc131\ud558\uace0 \ud14c\uc2a4\ud2b8\ud588\ub2e4.")),(0,r.kt)("h3",{id:"alpine313"},"alpine:3.13"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-dockerfile"},'FROM alpine:3.13\n\nRUN apk add --update nodejs npm\nRUN addgroup -g 1000 node \\\n  && adduser -u 1000 -G node -s /bin/sh -D node \\\n  && mkdir -p /usr/src/app \\\n  && chown node:node -R /usr/src/app\n\nWORKDIR /usr/src/app\nCOPY --chown=node:node package*.json ./\n\nUSER node\nRUN npm install && npm cache clean --force\n\nCOPY --chown=node:node . .\nEXPOSE 3000\nCMD [ "node", "server.js" ]\n')),(0,r.kt)("h3",{id:"\uacb0\uacfc2"},"\uacb0\uacfc2"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\ub354 \ub290\ub838\ub2e4.")),(0,r.kt)("h2",{id:"\uacb0\ub860"},"\uacb0\ub860"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"noticeably improves, ~20% \ub780 \ubb38\uad6c\ub85c \uc778\ud574 ",(0,r.kt)("inlineCode",{parentName:"li"},"fastify/benchmarks")," \ub85c\uc9c1\uc73c\ub85c \ub3c4\ucee4\ub77c\uc774\uc9d5\ud558\uc5ec \ud14c\uc2a4\ud2b8\ud574\ubcf4\uc558\uc73c\ub098 \ube44\uc2b7\ud55c \ud37c\ud3ec\uba3c\uc2a4\ub97c \ubcf4\uc5ec\uc8fc\uc5c8\ub2e4."),(0,r.kt)("li",{parentName:"ul"},"\uc704\uc758 \uc218\uce58\ub97c \uac80\uc99d\ud560 \uc218 \uc788\ub294 \ud14c\uc2a4\ud2b8\ubca0\ub4dc\uac00 \uc788\ub2e4\uba74 \ub3cc\ub824\ubcf4\uace0 \uc2f6\ub2e4. (\ub9c1\ud06c \uc788\uc73c\uc2dc\uba74 \uacf5\uc720\ubd80\ud0c1\ub4dc\ub9bd\ub2c8\ub2e4.)")),(0,r.kt)("h2",{id:"\ucc38\uc870"},"\ucc38\uc870"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Build flag \ube44\uad50: ",(0,r.kt)("a",{parentName:"li",href:"https://wiki.kldp.org/wiki.php/GccOptimizationOptions"},"GCC Optimization Options")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://git.alpinelinux.org/aports/tree/main/nodejs/APKBUILD?h=3.13-stable"},"alpine3.13 nodejs apkbuild"))))}u.isMDXComponent=!0}}]);