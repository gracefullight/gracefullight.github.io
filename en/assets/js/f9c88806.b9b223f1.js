"use strict";(self.webpackChunkgracefullight_github_io=self.webpackChunkgracefullight_github_io||[]).push([["19444"],{36251(e,s,n){n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>r,metadata:()=>l,toc:()=>i});var l=n(6900),o=n(74848),t=n(28453);let r={title:"\uCFE0\uBC84\uB124\uD2F0\uC2A4 \uD658\uACBD\uC5D0\uC11C\uC758 Node.js DNS Cache",authors:"me",tags:["nodejs","dns","k8s","docker"],date:new Date("2020-11-30T00:06:31.000Z")},d,c={authorsImageUrls:[void 0]},i=[{value:"DNS Cache",id:"dns-cache",level:2},{value:"UV_THREAD_POOL_SIZE",id:"uv_thread_pool_size",level:3},{value:"dns.lookup",id:"dnslookup",level:3},{value:"alpine",id:"alpine",level:3},{value:"kube-dns",id:"kube-dns",level:3},{value:"cacheable-lookup",id:"cacheable-lookup",level:3},{value:"\uACB0\uB860",id:"\uACB0\uB860",level:2},{value:"\uCC38\uC870",id:"\uCC38\uC870",level:2}];function a(e){let s={a:"a",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s.h2,{id:"dns-cache",children:"DNS Cache"}),"\n",(0,o.jsx)(s.p,{children:"\uCFE0\uBC84\uB124\uD2F0\uC2A4 \uD658\uACBD\uC5D0\uC11C\uB294 Node.js \uC774\uBBF8\uC9C0\uB97C \uC62C\uB9B4 \uC2DC \uC885\uC885 \uC544\uB798\uC640 \uAC19\uC740 IP \uBC18\uD658 \uC5D0\uB7EC\uBA54\uC138\uC9C0\uAC00 \uBCF4\uC778\uB2E4.\n\uC774\uB294 \uC11C\uBE44\uC2A4 \uC5F0\uACB0\uC870\uCC28 \uBD88\uAC00\uB2A5\uD558\uAC8C \uB9CC\uB4E4\uC5B4 \uC6B4\uC601\uC5D0 \uC9C0\uC7A5\uC744 \uC8FC\uC5C8\uB2E4."}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"Error: getaddrinfo EAI_AGAIN your-service\n"})}),"\n",(0,o.jsx)(s.p,{children:"\uBA3C\uC800 Node.js \uB808\uBCA8\uC5D0\uC11C\uBD80\uD130 \uD655\uC778\uC744 \uC2DC\uC791\uD558\uC600\uB2E4."}),"\n",(0,o.jsx)(s.h3,{id:"uv_thread_pool_size",children:"UV_THREAD_POOL_SIZE"}),"\n",(0,o.jsxs)(s.p,{children:["Node.js Man \uC744 \uBCF4\uBA74 \uB2E4\uC74C\uACFC \uAC19\uC740 ",(0,o.jsx)(s.a,{href:"https://nodejs.org/dist/latest-v14.x/docs/api/dns.html#dns_dns_lookup",children:"\uC8FC\uC758\uC0AC\uD56D"}),"\uC774 \uC788\uB2E4."]}),"\n",(0,o.jsxs)(s.blockquote,{children:["\n",(0,o.jsxs)(s.p,{children:["Though the call to ",(0,o.jsx)(s.code,{children:"dns.lookup()"})," will be asynchronous from JavaScript's perspective, it is implemented as a synchronous call to getaddrinfo(3) that runs on libuv's threadpool. This can have surprising negative performance implications for some applications, see the UV_THREADPOOL_SIZE documentation for more information."]}),"\n"]}),"\n",(0,o.jsxs)(s.p,{children:["\uC5F0\uAD00\uB41C ",(0,o.jsx)(s.em,{children:"UV_HTREADPOOL_SIZE"})," \uBB38\uC11C\uB294 \uB2E4\uC74C\uACFC \uAC19\uB2E4."]}),"\n",(0,o.jsxs)(s.blockquote,{children:["\n",(0,o.jsx)(s.p,{children:"Asynchronous system APIs are used by Node.js whenever possible, but where they do not exist, libuv's threadpool is used to create asynchronous node APIs based on synchronous system APIs."}),"\n"]}),"\n",(0,o.jsx)(s.p,{children:"\uC2A4\uB808\uB4DC \uD480\uC744 \uC0AC\uC6A9\uD558\uB294 API \uB294 \uB2E4\uC74C\uACFC \uAC19\uB2E4."}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:"all fs APIs, other than the file watcher APIs and those that are explicitly synchronous"}),"\n",(0,o.jsx)(s.li,{children:"asynchronous crypto APIs such as crypto.pbkdf2(), crypto.scrypt(), crypto.randomBytes(), crypto.randomFill(), crypto.generateKeyPair()"}),"\n",(0,o.jsx)(s.li,{children:(0,o.jsx)(s.strong,{children:"dns.lookup()"})}),"\n",(0,o.jsx)(s.li,{children:"all zlib APIs, other than those that are explicitly synchronous"}),"\n"]}),"\n",(0,o.jsxs)(s.p,{children:["\uC774 \uBA54\uC18C\uB4DC\uB4E4\uC744 \uC0AC\uC6A9\uD560 \uB54C\uB294 \uBCD1\uB82C \uC694\uCCAD\uACFC \uBD80\uD558\uC5D0 \uC2E0\uACBD\uC744 \uC368\uC57C\uD558\uBA70 ",(0,o.jsx)(s.code,{children:"UV_THREADPOOL_SIZE"})," \uC0AC\uC774\uC988\uB97C Node.js \uAE30\uBCF8\uAC12\uC778 ",(0,o.jsx)(s.strong,{children:"4"}),"\uC5D0\uC11C \uC801\uC808\uD788 \uC99D\uAC00\uC2DC\uCF1C\uC918\uC57C\uD55C\uB2E4."]}),"\n",(0,o.jsx)(s.h3,{id:"dnslookup",children:"dns.lookup"}),"\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.code,{children:"dns.lookup"}),"\uAC00 \uBE44\uB3D9\uAE30\uC778\uCC99\uD558\uB294 \uB3D9\uAE30 \uBA54\uC18C\uB4DC\uC784\uC744 \uD655\uC778\uD560 \uC218 \uC788\uC5C8\uB2E4.\n\uBCF4\uD1B5 \uC774 \uBA54\uC18C\uB4DC\uB97C \uC9C1\uC811 \uC0AC\uC6A9\uD558\uB294 \uACBD\uC6B0\uB294 \uAC70\uC758 \uC5C6\uB2E4."]}),"\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.code,{children:"axios"})," \uB4F1 http \uC5F0\uACB0\uC744 \uD558\uB294 \uB77C\uC774\uBE0C\uB7EC\uB9AC\uC5D0\uC11C Hostname \uC744 IP \uB85C \uBCC0\uACBD\uD558\uAE30 \uC704\uD574 \uC0AC\uC6A9\uD55C\uB2E4."]}),"\n",(0,o.jsxs)(s.p,{children:["java \uB294 30s",(0,o.jsx)(s.a,{href:"https://github.com/AdoptOpenJDK/openjdk-jdk/blob/97f8261e4190b8edf83c1d8f11ea57f6c8338284/src/java.base/share/classes/sun/net/InetAddressCachePolicy.java#L48",children:"\xb9"}),", php \uB294 120s",(0,o.jsx)(s.a,{href:"https://www.php.net/manual/en/function.curl-setopt.php",children:"\xb2"}),"\uC758 \uB3C4\uBA54\uC778 \uCE90\uC2DC\uB97C \uAE30\uBCF8\uC73C\uB85C \uC81C\uACF5\uD558\uC9C0\uB9CC Node.js \uC5D0\uC11C\uB294 \uADF8\uB7F0 \uAC83\uC774 \uC5C6\uB2E4."]}),"\n",(0,o.jsxs)(s.p,{children:["Node.js \uCEE4\uBBA4\uB2C8\uD2F0\uC5D0\uC11C\uB294 ",(0,o.jsx)(s.a,{href:"https://github.com/nodejs/node/issues/5893",children:"native dns lookup cache \uAE30\uB2A5\uC774 \uC81C\uC548"})," \uB418\uC5C8\uC9C0\uB9CC, ",(0,o.jsx)(s.code,{children:"dns.resolve4"})," \uC640 ",(0,o.jsx)(s.code,{children:"dns.resolve6"})," \uC5D0 \uC11C\uBC84\uC5D0\uC11C \uBC18\uD658\uD558\uB294 ",(0,o.jsx)(s.code,{children:"ttl"})," \uAC12\uC744 \uC0AC\uC6A9\uD560 \uC218 \uC788\uAC8C \uCD94\uAC00\uB418\uC5B4 \uC774\uAC78 \uC0AC\uC6A9\uD558\uC5EC DNS \uCE90\uC2F1\uC744 \uD558\uAC8C \uAD8C\uC7A5\uB418\uC5C8\uB2E4."]}),"\n",(0,o.jsx)(s.h3,{id:"alpine",children:"alpine"}),"\n",(0,o.jsx)(s.p,{children:"alpine \uC774\uBBF8\uC9C0\uC5D0\uB294 musl \uC744 \uC0AC\uC6A9\uD558\uBBC0\uB85C \uB2E4\uC74C\uACFC \uAC19\uC740 \uC774\uC288\uAC00 \uBC1C\uC0DD\uD560 \uC218 \uC788\uC73C\uB098 \uD574\uB2F9 \uC11C\uBE44\uC2A4\uB294 \uADF8\uB807\uC9C0 \uC54A\uC558\uB2E4."}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:(0,o.jsx)(s.a,{href:"https://github.com/gliderlabs/docker-alpine/blob/master/docs/caveats.md#dns",children:"docker-alpine#dns"})}),"\n",(0,o.jsx)(s.li,{children:(0,o.jsx)(s.a,{href:"https://wiki.musl-libc.org/functional-differences-from-glibc.html#Name-Resolver/DNS",children:"musl#dns"})}),"\n"]}),"\n",(0,o.jsx)(s.h3,{id:"kube-dns",children:"kube-dns"}),"\n",(0,o.jsxs)(s.p,{children:["\uB0A8\uC740 \uAC74 \uCFE0\uBC84\uB124\uD2F0\uC2A4 \uD658\uACBD\uC774\uC5C8\uB2E4. ",(0,o.jsx)(s.a,{href:"https://github.com/kubernetes/kubernetes/issues/32749",children:"kube-dns \uB300\uC2E0 dnsmasq \uB97C \uC0AC\uC6A9\uD558\uC790 \uC81C\uC548"}),"\uC774 \uC788\uC5C8\uACE0, ",(0,o.jsx)(s.a,{href:"https://github.com/kubernetes/kubernetes/issues/56903",children:"DNS intermittent delays of 5s"})," \uC774\uC288\uC640 \uACF5\uC2DD \uBB38\uC11C\uC758 ",(0,o.jsx)(s.a,{href:"https://github.com/kubernetes/enhancements/blob/master/keps/sig-network/1024-nodelocal-cache-dns/README.md",children:"NodeLocal DNS Cache Daemonset"})," \uC73C\uB85C \uC774 \uBB38\uC81C\uB97C \uD574\uACB0\uD560 \uC218 \uC788\uC5B4\uBCF4\uC600\uB2E4."]}),"\n",(0,o.jsx)(s.p,{children:"\uD074\uB7EC\uC2A4\uD130\uC5D0\uC11C \uB370\uBAAC\uC14B\uC744 \uD1B5\uD574 \uCE90\uC2F1\uB41C DNS \uB97C \uB9AC\uC878\uBE0C\uD558\uB294 \uC644\uC804\uD55C \uD574\uACB0\uCC45\uC774\uC600\uC73C\uB098 \uD074\uB77C\uC6B0\uB4DC\uC5D0\uB294 \uC811\uADFC \uAD8C\uD55C\uC774 \uC5C6\uC5B4 \uC774\uC288 \uB0B4\uC6A9\uC744 \uACF5\uC720\uD560 \uC218 \uBC16\uC5D0 \uC5C6\uC5C8\uB2E4."}),"\n",(0,o.jsx)(s.p,{children:"\uADF8\uB807\uB2E4\uBA74 \uC5B4\uD50C\uB9AC\uCF00\uC774\uC158\uC5D0\uC11C \uD574\uACB0\uD560 \uBC29\uBC95\uC744 \uCC3E\uC544\uC57C\uD588\uB2E4."}),"\n",(0,o.jsx)(s.h3,{id:"cacheable-lookup",children:"cacheable-lookup"}),"\n",(0,o.jsxs)(s.p,{children:["Node.js \uC758 HTTP \uBAA8\uB4C8\uC5D0\uC11C\uB294 lookup \uC18D\uC131\uC744 \uC9C0\uC6D0\uD558\uBA70 \uC774\uB294 \uAE30\uBCF8\uAC12\uC73C\uB85C ",(0,o.jsx)(s.code,{children:"dns.lookup"})," \uC744 \uC0AC\uC6A9\uD55C\uB2E4.\n\uACB0\uAD6D ",(0,o.jsx)(s.code,{children:"Node.js(HTTP -> dns.lookup) -> Alpine(getaddrinfo) -> K8S(socket)"})," \uC758 \uC5B4\uB290 \uAD6C\uAC04\uC774\uB77C\uB3C4 \uCE90\uC2F1\uC744 \uD558\uBA74 \uB418\uB294 \uAC83\uC774\uB2E4."]}),"\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.code,{children:"dns.lookup"})," \uB300\uC2E0\uC5D0 ",(0,o.jsx)(s.code,{children:"dns.resolve4"})," \uB97C \uC0AC\uC6A9\uD558\uBA70 ",(0,o.jsx)(s.code,{children:"Map"})," \uAE30\uBC18\uC73C\uB85C \uCE90\uC2DC\uD0A4\uB97C \uAD00\uB9AC\uD558\uB294 \uB77C\uC774\uBE0C\uB7EC\uB9AC\uB85C ",(0,o.jsx)(s.a,{href:"https://github.com/szmarczak/cacheable-lookup/blob/master/source/index.js",children:"Cachable Lookup"})," \uC744 \uCC3E\uC744 \uC218 \uC788\uC5C8\uB2E4."]}),"\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.code,{children:"axios"})," \uB77C\uC774\uBE0C\uB7EC\uB9AC\uB294 lookup \uC18D\uC131\uC744 \uC9C0\uC6D0\uD558\uC9C0 \uC54A\uC73C\uBBC0\uB85C ",(0,o.jsx)(s.code,{children:"http.globalAgent"})," \uC5D0 \uB2E4\uC74C\uACFC \uAC19\uC774 \uCD94\uAC00\uD574\uC57C\uD588\uB2E4."]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-js",children:'import CacheableLookup from "cacheable-lookup";\n\nconst cacheable = new CacheableLookup();\ncacheable.install(http.globalAgent);\n'})}),"\n",(0,o.jsxs)(s.p,{children:["\uC804\uC5ED agent \uB97C \uC624\uC5FC\uC2DC\uD0A4\uB294 \uB290\uB08C\uC774\uB77C \uC544\uC608 HTTP \uB77C\uC774\uBE0C\uB7EC\uB9AC\uB97C ",(0,o.jsx)(s.code,{children:"got"})," \uC73C\uB85C \uBCC0\uACBD\uD558\uC600\uB2E4.\n",(0,o.jsx)(s.code,{children:"got"})," \uC5D0\uC11C\uB294 ",(0,o.jsx)(s.code,{children:"dnsCache: true"})," \uB97C \uC8FC\uC5B4 \uC774 \uAE30\uB2A5\uC744 ",(0,o.jsx)(s.a,{href:"https://github.com/sindresorhus/got/issues/661",children:"\uC27D\uAC8C \uD65C\uC131\uD654"})," \uD560 \uC218 \uC788\uC5C8\uB2E4."]}),"\n",(0,o.jsx)(s.h2,{id:"\uACB0\uB860",children:"\uACB0\uB860"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:"\uC5B8\uC5B4 \uC218\uC900\uC5D0\uC11C\uC758 DNS \uCE90\uC2DC\uB294 \uC9E7\uAC8C\uB098\uB9C8 \uD544\uC694\uD574\uBCF4\uC600\uB2E4."}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"deno"})," \uC5D0\uC120 ",(0,o.jsx)(s.a,{href:"https://docs.rs/reqwest/0.10.9/reqwest/",children:"reqwest"})," \uBAA8\uB4C8 \uC704\uC5D0 HTTP \uB97C \uC62C\uB824\uB193\uC558\uB294\uB370, ",(0,o.jsx)(s.code,{children:"trust-dns"})," \uB780 DNS \uCE90\uC2DC \uBAA8\uB4C8\uC744 \uD65C\uC131\uD654\uD558\uB294 \uC635\uC158\uC740 ",(0,o.jsx)(s.a,{href:"https://github.com/denoland/deno/commit/35e3c06aed851f65ad0d561d73a447ab5765fc13",children:"\uB4E4\uC5B4\uAC00\uC788\uC9C0 \uC54A\uC558\uB2E4."})," \uB530\uB77C\uC11C \uCFE0\uBC84\uB124\uD2F0\uC2A4 \uD658\uACBD\uC5D0\uC11C \uAC19\uC740 \uC624\uB958\uB97C \uBC49\uC744\uC9C0 \uD14C\uC2A4\uD2B8\uD574\uBCF4\uACE0 \uC2F6\uB2E4."]}),"\n"]}),"\n",(0,o.jsx)(s.h2,{id:"\uCC38\uC870",children:"\uCC38\uC870"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:(0,o.jsx)(s.a,{href:"https://jameshfisher.com/2018/02/03/what-does-getaddrinfo-do/",children:"What does getaddrinfo do"})}),"\n"]})]})}function h(e={}){let{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,o.jsx)(s,{...e,children:(0,o.jsx)(a,{...e})}):a(e)}},28453(e,s,n){n.d(s,{R:()=>r,x:()=>d});var l=n(96540);let o={},t=l.createContext(o);function r(e){let s=l.useContext(t);return l.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function d(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),l.createElement(t.Provider,{value:s},e.children)}},6900(e){e.exports=JSON.parse('{"permalink":"/en/2020/11/30/nodejs-dns-cache-on-k8s","source":"@site/blog/2020/11/30/nodejs-dns-cache-on-k8s.md","title":"\uCFE0\uBC84\uB124\uD2F0\uC2A4 \uD658\uACBD\uC5D0\uC11C\uC758 Node.js DNS Cache","description":"DNS Cache","date":"2020-11-30T00:06:31.000Z","tags":[{"inline":true,"label":"nodejs","permalink":"/en/tags/nodejs"},{"inline":true,"label":"dns","permalink":"/en/tags/dns"},{"inline":true,"label":"k8s","permalink":"/en/tags/k-8-s"},{"inline":true,"label":"docker","permalink":"/en/tags/docker"}],"readingTime":2.9,"hasTruncateMarker":false,"authors":[{"name":"Gracefullight","title":"Owner","url":"https://github.com/gracefullight","imageURL":"https://avatars.githubusercontent.com/u/11773683?v=4","key":"me","page":null}],"frontMatter":{"title":"\uCFE0\uBC84\uB124\uD2F0\uC2A4 \uD658\uACBD\uC5D0\uC11C\uC758 Node.js DNS Cache","authors":"me","tags":["nodejs","dns","k8s","docker"],"date":"2020-11-30T00:06:31.000Z"},"unlisted":false,"prevItem":{"title":"\uB9E5\uC5D0\uC11C \uBE14\uB8E8\uD22C\uC2A4 \uC7A5\uCE58 \uCC28\uB2E8\uD558\uAE30","permalink":"/en/2020/11/30/mac-ignore-bluetooth-devices"},"nextItem":{"title":"\uBA38\uC2E0\uB7EC\uB2DD \uAE30\uCD08 \uC815\uB9AC","permalink":"/en/2020/08/15/ml-basic"}}')}}]);