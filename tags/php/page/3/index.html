<!doctype html>
<html lang="ko" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">&quot;php&quot; 태그로 연결된 49개 게시물개의 게시물이 있습니다. | gracefullight.dev</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://gracefullight.dev/tags/php/page/3/"><meta data-rh="true" property="og:locale" content="ko"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" name="docusaurus_locale" content="ko"><meta data-rh="true" name="docsearch:language" content="ko"><meta data-rh="true" name="google-site-verification" content="gcY9SiftHgQoJjBZ7IgwNNN5_atLPAX6kWb1nFVfa6E"><meta data-rh="true" name="msvalidate.01" content="65AD1E28C0D057CEB3C68FBC0293E55B"><meta data-rh="true" name="naver-site-verification" content="d024c2837887f72dc7b3792b958be74d69ba9593"><meta data-rh="true" name="yandex-verification" content="6672f93d837354fb"><meta data-rh="true" name="baidu-site-verification" content="yZEdU1ABcR"><meta data-rh="true" name="facebook-domain-verification" content="uelupjqqsm5egzlhy1aev2rfxow5yt"><meta data-rh="true" property="og:title" content="&quot;php&quot; 태그로 연결된 49개 게시물개의 게시물이 있습니다. | gracefullight.dev"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://gracefullight.dev/tags/php/page/3/"><link data-rh="true" rel="alternate" href="https://gracefullight.dev/tags/php/page/3/" hreflang="ko"><link data-rh="true" rel="alternate" href="https://gracefullight.dev/en/tags/php/page/3/" hreflang="en"><link data-rh="true" rel="alternate" href="https://gracefullight.dev/tags/php/page/3/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://RFS69RSYOJ-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="gracefullight.dev RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="gracefullight.dev Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="gracefullight.dev JSON Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-E99DNE7S05"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-E99DNE7S05",{})</script>


<link rel="search" type="application/opensearchdescription+xml" title="gracefullight.dev" href="/opensearch.xml">
<link rel="icon" href="/img/favicon-32x32.png">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#f28913">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f28913">
<link rel="apple-touch-icon" href="/img/apple-touch-icon.png">
<link rel="preconnect" href="https://pagead2.googlesyndication.com">
<script src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3004788392777865" async crossorigin="anonymous"></script>
<link rel="preconnect" href="https://www.clarity.ms">
<script>!function(t,e,n,a,c,i,r){t[n]=t[n]||function(){(t[n].q=t[n].q||[]).push(arguments)},(i=e.createElement(a)).async=1,i.src="https://www.clarity.ms/tag/aongv9xgi6",(r=e.getElementsByTagName(a)[0]).parentNode.insertBefore(i,r)}(window,document,"clarity","script")</script>
<link rel="preconnect" href="https://wcs.naver.net">
<script src="https://wcs.naver.net/wcslog.js" async></script>
<script>if(!wcs_add)var wcs_add={};wcs_add.wa="156bc73a81e3bd0",window.wcs&&wcs_do()</script>
<link rel="preconnect" href="https://cdn.channel.io">
<script>!function(){var n=window;if(n.ChannelIO)return(window.console.error||window.console.log||function(){})("ChannelIO script included twice.");var e=function(){e.c(arguments)};function t(){if(!n.ChannelIOInitialized){n.ChannelIOInitialized=!0;var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://cdn.channel.io/plugin/ch-plugin-web.js",e.charset="UTF-8";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}}e.q=[],e.c=function(n){e.q.push(n)},n.ChannelIO=e,"complete"===document.readyState?t():window.attachEvent?window.attachEvent("onload",t):(window.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1))}(),ChannelIO("boot",{pluginKey:"0fd130ba-a1a6-4b7e-802a-e82a885a7fd8"})</script>
<link rel="preconnect" href="https://static.cloudflareinsights.com">
<script src="https://static.cloudflareinsights.com/beacon.min.js" defer="defer" data-cf-beacon="{&quot;token&quot;:&quot;c0899829e72b45e98dff77241127252c&quot;}"></script>

<link rel="preconnect" href="https://cdn.jsdelivr.net">
<script type="application/ld+json">{"@context":"http://schema.org","@type":"Person","name":"Eunkwang Shin","url":"https://gracefullight.dev","logo":"https://gracefullight.dev/img/apple-touch-icon.png","image":"https://avatars.githubusercontent.com/u/11773683?v=4","email":"mailto:gracefullight.dev@gmail.com","jobTitle":"FullStack JavaScript Developer","nationality":"Korean","sameAs":["https://github.com/gracefullight","https://linkedin.com/in/gracefullight"]}</script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.ca23cff1.css">
<script src="/assets/js/runtime~main.f3973212.js" defer="defer"></script>
<script src="/assets/js/main.902083aa.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="본문으로 건너뛰기"><a class="skipToContent_aH51" href="#__docusaurus_skipToContent_fallback">본문으로 건너뛰기</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/favicon-32x32.png" alt="gracefullight.dev blog logo" class="themedComponent_waxE themedComponent--light_Cv1g"><img src="/img/favicon-32x32.png" alt="gracefullight.dev blog logo" class="themedComponent_waxE themedComponent--dark_OHNr"></div><b class="navbar__title text--truncate">gracefullight.dev</b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_gaze"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>한국어</a><ul class="dropdown__menu"><li><a href="/tags/php/page/3/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="ko">한국어</a></li><li><a href="/en/tags/php/page/3/" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li></ul></div><a class="navbar__item navbar__link" href="/archive/">Archives</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/tags/">Tags</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/gracefullight" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Fakl"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://www.linkedin.com/in/gracefullight" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Fakl"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbarSearchContainer_Lqye"><button type="button" class="DocSearch DocSearch-Button" aria-label="검색"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">검색</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_hEOq"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_pIhW thin-scrollbar" aria-label="최근 블로그 문서 둘러보기"><div class="sidebarItemTitle_QHap margin-bottom--md">최근 포스트</div><ul class="sidebarItemList_bKDH clean-list"><li class="sidebarItem_oor3"><a class="sidebarItemLink_O1TF" href="/2023/12/23/professional-engineer-network/">기술사 - 네트워크</a></li><li class="sidebarItem_oor3"><a class="sidebarItemLink_O1TF" href="/2023/12/19/decoupling-from-national-dependency/">국가에 대한 의존성 분리</a></li><li class="sidebarItem_oor3"><a class="sidebarItemLink_O1TF" href="/2023/12/05/ielts-retrospective/">아이엘츠 공부 회고</a></li><li class="sidebarItem_oor3"><a class="sidebarItemLink_O1TF" href="/2023/12/02/ielts-speaking-tests-flaws/">IELTS Speaking 기출 오답노트</a></li><li class="sidebarItem_oor3"><a class="sidebarItemLink_O1TF" href="/2023/12/02/ielts-speaking-tests-part3/">IELTS Speaking 기출 Part3</a></li><li class="sidebarItem_oor3"><a class="sidebarItemLink_O1TF" href="/2023/12/02/ielts-speaking-tests-part2/">IELTS Speaking 기출 Part2</a></li><li class="sidebarItem_oor3"><a class="sidebarItemLink_O1TF" href="/2023/11/16/ielts-speaking-tests-part1/">IELTS Speaking 기출 Part1</a></li><li class="sidebarItem_oor3"><a class="sidebarItemLink_O1TF" href="/2023/11/11/professional-engineer-database/">기술사 - 데이터베이스</a></li><li class="sidebarItem_oor3"><a class="sidebarItemLink_O1TF" href="/2023/11/11/professional-engineer-information-security/">기술사 - 정보보안</a></li><li class="sidebarItem_oor3"><a class="sidebarItemLink_O1TF" href="/2023/10/28/professional-engineer-sw-engineering/">기술사 - 소프트웨어 공학</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="https://schema.org/Blog"><header class="margin-bottom--xl"><h1>&quot;php&quot; 태그로 연결된 49개 게시물개의 게시물이 있습니다.</h1><a href="/tags/">모든 태그 보기</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="로그를 찍기 위해서 Log 파사드 또는 logger 헬퍼 함수를 사용할 수 있다."><header><h2 class="title_CSpS" itemprop="headline"><a itemprop="url" href="/2017/07/21/Laravel-Log-debug-vs-logger/">Laravel - Log::debug vs logger</a></h2><div class="container_jZh9 margin-vert--md"><time datetime="2017-07-21T00:46:35.000Z" itemprop="datePublished">2017년 7월 21일</time> · <!-- -->약 1분</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_BNjk"><div class="avatar margin-bottom--sm"><a href="https://github.com/gracefullight" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/11773683?v=4" alt="Eunkwang Shin" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/gracefullight" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Eunkwang Shin</span></a></div><small class="avatar__subtitle" itemprop="description">Owner</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>로그를 찍기 위해서 Log 파사드 또는 logger 헬퍼 함수를 사용할 수 있다.</p>
<p>두 함수의 차이점은 무엇일까?</p>
<ul>
<li>Log 파사드가 정의되어있어야 한다. <code>use Log;</code></li>
<li>NULL 값이 들어올시 <strong>NULL이 로그에 출력</strong>된다.</li>
</ul>
<h1>logger</h1>
<ul>
<li>헬퍼함수라 Log 파사드 없이 사용 가능하다.</li>
<li>NULL 값이 들어올시 아무 내용도 찍히지 않는다.</li>
<li>debug 레벨이 기본이라, 다른 레벨의 로그를 찍으려면 <code>logger()-&gt;error(&#x27;에러 로그&#x27;);</code> 처럼 함수를 하나 더 호출해야한다.</li>
<li>단, info 레벨 로그는 <code>info();</code> 헬퍼 함수를 사용할 수 있다.</li>
</ul></div><footer class="row docusaurus-mt-lg"><div class="col"><b>태그:</b><ul class="tags_GTCL padding--none margin-left--sm"><li class="tag_IZrL"><a class="tag_alSi tagRegular_w1M4" href="/tags/php/">php</a></li><li class="tag_IZrL"><a class="tag_alSi tagRegular_w1M4" href="/tags/laravel/">laravel</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="일본 통신사 중 소프트뱅크와 AU는 UTF8 메일이 깨져서 들어간다. (도코모는 정상적)"><header><h2 class="title_CSpS" itemprop="headline"><a itemprop="url" href="/2017/07/19/Laravel-5-4-Mail-to-Japan/">Laravel 5.5 - 일본으로 메일 보내기</a></h2><div class="container_jZh9 margin-vert--md"><time datetime="2017-07-19T00:11:01.000Z" itemprop="datePublished">2017년 7월 19일</time> · <!-- -->약 3분</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_BNjk"><div class="avatar margin-bottom--sm"><a href="https://github.com/gracefullight" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/11773683?v=4" alt="Eunkwang Shin" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/gracefullight" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Eunkwang Shin</span></a></div><small class="avatar__subtitle" itemprop="description">Owner</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>일본 통신사 중 소프트뱅크와 AU는 UTF8 메일이 깨져서 들어간다. (도코모는 정상적)
Laravel 뿐아니라 일본으로 메일을 보내고 싶다면, 이 포스팅의 방식대로 접근하면 된다.</p>
<p>먼저 인코딩을 iso-2022-jp로 바꿔줘야한다.</p>
<blockquote>
<p>테스트 결과 JIS 인코딩과 같다.
SJIS 인코딩도 있는데 위 인코딩에 몇가지 특수문자가 추가된 형태이다.</p>
</blockquote>
<p>AppServiceProvider에 메일 인코딩을 전역으로 설정하자.</p>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_nMmE">app/Providers/AppServiceProvider.php</div><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">...</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">use Swift;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">use Swift_DependencyContainer;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">use Swift_Preferences;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">class AppServiceProvider extends ServiceProvider</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">{</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  public function register() {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    // laravel의 메일 패키지는 Swift이므로 당황하지말자</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    Swift::init(function() {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      // 헤더를 추가하고</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      Swift_DependencyContainer::getInstance()</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        -&gt;register(&#x27;mime.qpheaderencoder&#x27;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        -&gt;asAliasOf(&#x27;mime.base64headerencoder&#x27;);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      // 인코딩을 변경한다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      Swift_Preferences::getInstance()-&gt;setCharset(&#x27;iso-2022-jp&#x27;);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h1>7bit</h1>
<p>위키를 참조해보면 iso-2022는 문자열을 7bit 또는 8bit로 표현하는 기술이다. 근데, 소프트뱅크 문서에 7bit로 달란다.
메일 폼을 열어서 build시에 인코딩 바이트를 변경하자.</p>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_nMmE">app/Mail/YourMailForm.php</div><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">...</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">use Swift_Mime_ContentEncoder_PlainContentEncoder;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">class YourMailForm extends Mailable</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">{</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  public function build() {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    return $this-&gt;subject(&#x27;ご注文を承りました。&#x27;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            -&gt;view(&#x27;mail.your_mail_view&#x27;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            -&gt;withSwiftMessage(function($message) {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">              // 전역으로 설정한 뒤에 이 메소드를 빼보고 테스트를 못 해봤다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">              // 다음 분이 빼고 테스트 부탁드려요 : )</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">              $message-&gt;setCharset(&#x27;iso-2022-jp&#x27;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">              // 인코딩 바이트를 바꿔준다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">              -&gt;setEncoder(new Swift_Mime_ContentEncoder_PlainContentEncoder(&#x27;7bit&#x27;));</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">          });</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h1>mail.view</h1>
<p>가장 중요한 것은 Mail View에서도 charset meta tag를 등록해줘야 한다는 것이다.
이 걸 세팅안하고 얼마나 삽질을 해댔는지, 없던 이두근이 생길지경.</p>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_nMmE">resources/view/mail/your_mail_view.blade.php</div><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;html&gt;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &lt;head&gt;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=iso-2022-jp&quot;&gt;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &lt;/head&gt;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &lt;body&gt;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &lt;/body&gt;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;/html&gt;</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>이렇게 세팅을 하고 메일을 보내면 정상적으로 보내지는 걸 확인할 수 있다.</p>
<h1>여담</h1>
<p>세 가지만 기억하자.</p>
<ul>
<li>iso-2022-jp</li>
<li>7bit</li>
<li>meta[charset=&quot;iso-2022-jp&quot;]</li>
</ul></div><footer class="row docusaurus-mt-lg"><div class="col"><b>태그:</b><ul class="tags_GTCL padding--none margin-left--sm"><li class="tag_IZrL"><a class="tag_alSi tagRegular_w1M4" href="/tags/php/">php</a></li><li class="tag_IZrL"><a class="tag_alSi tagRegular_w1M4" href="/tags/laravel/">laravel</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="이전 포스팅에서 데이터를 가져왔으니, 로그인을 구현해보자."><header><h2 class="title_CSpS" itemprop="headline"><a itemprop="url" href="/2017/07/09/Laravel-5-4-Login-with-Auth/">Laravel 5.5 - 로그인(Auth) 붙히기</a></h2><div class="container_jZh9 margin-vert--md"><time datetime="2017-07-09T22:46:57.000Z" itemprop="datePublished">2017년 7월 9일</time> · <!-- -->약 11분</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_BNjk"><div class="avatar margin-bottom--sm"><a href="https://github.com/gracefullight" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/11773683?v=4" alt="Eunkwang Shin" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/gracefullight" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Eunkwang Shin</span></a></div><small class="avatar__subtitle" itemprop="description">Owner</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><a href="/2017/06/06/Laravel-5-4-Eloquent-Model/">이전 포스팅</a>에서 데이터를 가져왔으니, 로그인을 구현해보자.</p>
<p>라라벨에서 제공하는 회원가입, 로그인, 비밀번호 찾기 기능을 사용하고 싶다면 artisan 명령어로 간단하게 시작할 수 있다.</p>
<div class="language-bash codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-bash codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ php artisan make:auth</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>명령어를 실행하면 <strong>resources/views/auth</strong> 폴더에 뷰가 <strong>app/Http/Controllers/Auth</strong>에 로직이 생성되고 <strong>routes/web.php</strong>에 라우팅이 등록된다.
DB도 같이 만들고 싶다면 <a href="https://laravel.com/docs/5.4/authentication" target="_blank" rel="noopener noreferrer">Docs</a>를 따라하자.</p>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="다른-테이블-사용">다른 테이블 사용<a href="#다른-테이블-사용" class="hash-link" aria-label="다른 테이블 사용에 대한 직접 링크" title="다른 테이블 사용에 대한 직접 링크">​</a></h2>
<p>제공된 user 테이블을 안 쓰려면 커스터마이징이 필요하다.</p>
<h3 class="anchor anchorWithStickyNavbar_PC_Z" id="설정-변경">설정 변경<a href="#설정-변경" class="hash-link" aria-label="설정 변경에 대한 직접 링크" title="설정 변경에 대한 직접 링크">​</a></h3>
<p><strong>config/auth.php</strong> 파일로 이동해 다른 모델을 등록하자.</p>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_nMmE">config/auth.php</div><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">&#x27;providers&#x27; =&gt; [</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &#x27;users&#x27; =&gt; [</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &#x27;driver&#x27; =&gt; &#x27;eloquent&#x27;,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    // 여기에 사용할 모델을 등록한다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &#x27;model&#x27; =&gt; App\Models\Member::class,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">]</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>config 안의 파일을 변경하면 config<!-- -->:clear<!-- -->를 실행해 혹시 모를 캐시를 날려주자</p>
</blockquote>
<p>그리고 <strong>app/Models/Member.php</strong>로 이동해 내 모델을 라라벨 기본 인증 모듈을 사용할 수 있게 추가해야한다.</p>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_nMmE">app/Models/Member.php</div><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;?</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// 라라벨 인증 사용</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">use Illuminate\Foundation\Auth\User as Authenticatable;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// 비밀번호 변경 메일을 위해 필요한 trait</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">use Illuminate\Notifications\Notifiable;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// Authenticatable 를 상속받는다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">class Member extends Authenticatable {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // Notifiable trait를 추가한다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  use Notifiable;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  protected $guarded = [</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &#x27;member_id&#x27;, &#x27;remember_token&#x27;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  ];</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  protected $hidden = [</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &#x27;password&#x27;, &#x27;remember_token&#x27;,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  ];</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_PC_Z" id="인증-필드-변경">인증 필드 변경<a href="#인증-필드-변경" class="hash-link" aria-label="인증 필드 변경에 대한 직접 링크" title="인증 필드 변경에 대한 직접 링크">​</a></h3>
<p>Basic Auth는 기본 필드를 email로 잡고 있기 때문에 id 필드를 사용하게 변경해야한다.</p>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_nMmE">app/Http/Controllers/Auth/LoginController.php</div><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// username 메소드를 추가</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">public function username() {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  //   반환할 필드를 선언한다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  return &#x27;id&#x27;;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="회원가입-후-자동로그인">회원가입 후 자동로그인<a href="#회원가입-후-자동로그인" class="hash-link" aria-label="회원가입 후 자동로그인에 대한 직접 링크" title="회원가입 후 자동로그인에 대한 직접 링크">​</a></h2>
<p>회원가입이 성공하면 세션을 생성해줘야한다.</p>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_nMmE">app/Http/Controllers/Auth/RegisterController.php</div><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// registered 메소드를 Override</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">protected function registered(Request $request, $user) {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // 세션 생성</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  Auth::attempt([</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &#x27;id&#x27; =&gt; $request-&gt;input(&#x27;id&#x27;),</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &#x27;password&#x27; =&gt; $request-&gt;input(&#x27;password&#x27;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  ]);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  return response(null, 204);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="ajax-처리">ajax 처리<a href="#ajax-처리" class="hash-link" aria-label="ajax 처리에 대한 직접 링크" title="ajax 처리에 대한 직접 링크">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_PC_Z" id="로그인">로그인<a href="#로그인" class="hash-link" aria-label="로그인에 대한 직접 링크" title="로그인에 대한 직접 링크">​</a></h3>
<p>로그인을 ajax로 처리해  야될 경우 커스터마이징이 필요하다.</p>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_nMmE">app/Http/Controllers/Auth/LoginController.php</div><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// authenticated 메소드를 Override</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">protected function authenticated(Request $request, $user) {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // 인증이 된 경우 페이지 전환이 아닌 전환될 페이지를 json으로 반환한다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  if ($request-&gt;ajax()) {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    return response()-&gt;json([</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &#x27;href&#x27; =&gt; url()-&gt;previous()</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    ]);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  } else {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    return abort(405);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_PC_Z" id="비밀번호-찾기">비밀번호 찾기<a href="#비밀번호-찾기" class="hash-link" aria-label="비밀번호 찾기에 대한 직접 링크" title="비밀번호 찾기에 대한 직접 링크">​</a></h3>
<p>비밀번호 찾기를 ajax로 처리해야될 경우 커스터마이징이 필요하다.</p>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_nMmE">app/Http/Controllers/Auth/ForgotPasswordController.php</div><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">public function sendResetLinkEmail(Request $request) {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  $this-&gt;validateId($request);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // email이 아닌 아이디로 검색을 해 메일을 찾고 싶다면</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  $data = Member::where(&#x27;id&#x27;, $request-&gt;only(&#x27;id&#x27;))</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    -&gt;first([&#x27;email&#x27;]);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  $email = isset($data-&gt;email) ? $data-&gt;email : null;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // 여기서 email이 User Model(Member Model)에 바인딩된다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // 아래의 sendPasswordResetNotification 메소드에서 $this-&gt;email 값이다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  $response = $this-&gt;broker()-&gt;sendResetLink([</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &#x27;email&#x27; =&gt; $email</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  ]);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // 리턴 값을 변경해주자.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  return response()-&gt;json([</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &#x27;email&#x27; =&gt; $email</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  ], $response == Password::RESET_LINK_SENT ? 200 : 500 );</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="routing-예외">routing 예외<a href="#routing-예외" class="hash-link" aria-label="routing 예외에 대한 직접 링크" title="routing 예외에 대한 직접 링크">​</a></h2>
<p>ajax 요청으로 바꿨다면 굳이 필요없는 기본 route는 등록할 필요가 없다. (예를 들면 로그인 페이지)
먼저 <strong>routes/web.php</strong>에서 <code>Auth::routes();</code> 를 지워주고 라라벨 route 파일을 열어보자.</p>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_nMmE">vendor/laravel/Illuminate/Routing/Router.php</div><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">// 994 라인</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">public function auth()</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">{</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // Authentication Routes...</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  $this-&gt;get(&#x27;login&#x27;, &#x27;Auth\LoginController@showLoginForm&#x27;)-&gt;name(&#x27;login&#x27;);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  $this-&gt;post(&#x27;login&#x27;, &#x27;Auth\LoginController@login&#x27;);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  $this-&gt;post(&#x27;logout&#x27;, &#x27;Auth\LoginController@logout&#x27;)-&gt;name(&#x27;logout&#x27;);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // Registration Routes...</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  $this-&gt;get(&#x27;register&#x27;, &#x27;Auth\RegisterController@showRegistrationForm&#x27;)-&gt;name(&#x27;register&#x27;);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  $this-&gt;post(&#x27;register&#x27;, &#x27;Auth\RegisterController@register&#x27;);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // Password Reset Routes...</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  $this-&gt;get(&#x27;password/reset&#x27;, &#x27;Auth\ForgotPasswordController@showLinkRequestForm&#x27;)-&gt;name(&#x27;password.request&#x27;);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  $this-&gt;post(&#x27;password/email&#x27;, &#x27;Auth\ForgotPasswordController@sendResetLinkEmail&#x27;)-&gt;name(&#x27;password.email&#x27;);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  $this-&gt;get(&#x27;password/reset/{token}&#x27;, &#x27;Auth\ResetPasswordController@showResetForm&#x27;)-&gt;name(&#x27;password.reset&#x27;);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  $this-&gt;post(&#x27;password/reset&#x27;, &#x27;Auth\ResetPasswordController@reset&#x27;);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>입맛에 맞게 web.php로 가져와 사용하자.</p>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="notification-예외">notification 예외<a href="#notification-예외" class="hash-link" aria-label="notification 예외에 대한 직접 링크" title="notification 예외에 대한 직접 링크">​</a></h2>
<p>Noticifation은 사용자에게 빠르게 알림을 보낼 수 있는 기능이지만, 정해져 있는 템플릿을 사용하므로 커스터마이징이 되게 힘들다.
비밀번호 찾기시에 보낼 메일을 정해진 템플릿을 사용할 수 없다면 메소드를 수정하자.</p>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_nMmE">app/Models/Member.php</div><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// 이   메소드를 override해야한다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// 첫 파라미터는 비밀번호 인증용 token이 들어온다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">public function sendPasswordResetNotification($token) {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  Mail::to($this-&gt;email)-&gt;send(new PasswordReset($token));</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h1>Auth</h1>
<p>Basic Auth를 사용하는데 건드려야 되는 곳이 많으므로 Auth 모듈만 사용하는게 정신건강에 좋다고 본다.
(Bootstrap 기반의 Laravel에 딱 맞는 모양을 입은 프로젝트라면 기본 인증이 좋겠지만)</p>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="로그인-1">로그인<a href="#로그인-1" class="hash-link" aria-label="로그인에 대한 직접 링크" title="로그인에 대한 직접 링크">​</a></h2>
<p><strong>먼저 사용할 모델에 Authenticatable 클래스를 상속 받자</strong>
그리고 LoginController에서 <strong>Auth::attempt()</strong> 메소드를 실행하면 끝이다.</p>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_nMmE">app/Http/Controllers/LoginController.php</div><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">public function login(Request $request) {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  $password = $request-&gt;password;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  if(Auth::attempt([ &#x27;id&#x27; =&gt; $request-&gt;id, &#x27;password&#x27; =&gt; $password ])){</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    return response(null, 200);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  }else{</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    return abort(401);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_PC_Z" id="not-bcrypt">not bcrypt<a href="#not-bcrypt" class="hash-link" aria-label="not bcrypt에 대한 직접 링크" title="not bcrypt에 대한 직접 링크">​</a></h3>
<p>Auth 모듈은 기본으로 bcrypt를 사용해 비밀번호를 암호화하고 비교하는데 다른 암호화 방식을 사용해야하는 경우가 있다.
bcrypt를 사용하지 않게 처리해보자.</p>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_nMmE">app/Models/Member.php</div><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">// 이 메소드를 override 해야한다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">public function getAuthPassword() {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // bcrypt 비교를 하지 않기 위해 강제로 해시를 생성한다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  return Hash::make($this-&gt;password);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>이제 <strong>Auth::attempt()</strong> 메소드에 패스워드를 넘길 때 암호화를 해주고 넘기면 된다.</p>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="n개의-세션">N개의 세션<a href="#n개의-세션" class="hash-link" aria-label="N개의 세션에 대한 직접 링크" title="N개의 세션에 대한 직접 링크">​</a></h2>
<p>관리자와 회원은 같은 세션을 사용하면 안 된다. 세션을 분기해보자.</p>
<h3 class="anchor anchorWithStickyNavbar_PC_Z" id="모델-생성">모델 생성<a href="#모델-생성" class="hash-link" aria-label="모델 생성에 대한 직접 링크" title="모델 생성에 대한 직접 링크">​</a></h3>
<p>먼저 모델을 하나 만들고 Authenticatable 클래스를 상속받는다.</p>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_nMmE">app/Models/Admin.php</div><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">use Illuminate\Foundation\Auth\User as Authenticatable;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">class Admin extends Authenticatable {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // 속성은 테이블에 맞게 알아서 정리하자</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_PC_Z" id="설정-추가">설정 추가<a href="#설정-추가" class="hash-link" aria-label="설정 추가에 대한 직접 링크" title="설정 추가에 대한 직접 링크">​</a></h3>
<p>만든 모델을 Laravel Auth에서 사용한다고 등록을 해줘야한다.</p>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_nMmE">config/auth.php</div><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">return [</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &#x27;guards&#x27; =&gt; [</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    // 아래에 등록된 provider를 admin이란 이름의 guard로 사용</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &#x27;admin&#x27; =&gt; [</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &#x27;driver&#x27;   =&gt; &#x27;session&#x27;,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &#x27;provider&#x27; =&gt; &#x27;admin&#x27;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  ],</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &#x27;providers&#x27; =&gt; [</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    // 방금 만든 모델을 Auth의 Provider로 등록</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &#x27;admin&#x27; =&gt; [</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &#x27;driver&#x27;   =&gt; &#x27;eloquent&#x27;,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &#x27;model&#x27; =&gt; App\Models\Admin::class</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  ],</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">];</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>passowrds 속성은 제공되는 password_resets 기능을 사용할 경우에만 추가해주면 된다.</p>
<h3 class="anchor anchorWithStickyNavbar_PC_Z" id="미들웨어">미들웨어<a href="#미들웨어" class="hash-link" aria-label="미들웨어에 대한 직접 링크" title="미들웨어에 대한 직접 링크">​</a></h3>
<p>관리자 세션이 인증된 사람만 관리자 페이지에 접근할 수 있어야한다.
<strong>php artisan make<!-- -->:middleware<!-- --> Admin</strong> 명령어를 실행해 Admin Middleware를 만들자.</p>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_nMmE">app/Http/Middleware/Admin.php</div><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">use Auth;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">use Closure;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">class Admin {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  public function handle($request, Closure $next) {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    // admin session이 있는 경우만 request를 진행한다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    if (Auth::guard(&#x27;admin&#x27;)-&gt;check()) {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      return $next($request);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    // 아닐경우 관리자 로그인 페이지로 넘긴다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    return redirect()-&gt;route(&#x27;admin.login&#x27;);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>그리고 Http Kernel에 방금 만든 Admin Middleware를 라우팅에서 사용할 수 있게 등록해준다.</p>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_nMmE">app/Http/Kernel.php</div><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  protected $routeMiddleware = [</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &#x27;auth&#x27; =&gt; \Illuminate\Auth\Middleware\Authenticate::class,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &#x27;auth.basic&#x27; =&gt; \Illuminate\Auth\Middleware\AuthenticateWithBasicAuth::class,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &#x27;bindings&#x27; =&gt; \Illuminate\Routing\Middleware\SubstituteBindings::class,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &#x27;can&#x27; =&gt; \Illuminate\Auth\Middleware\Authorize::class,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &#x27;guest&#x27; =&gt; \App\Http\Middleware\RedirectIfAuthenticated::class,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &#x27;throttle&#x27; =&gt; \Illuminate\Routing\Middleware\ThrottleRequests::class,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    // admin 이름으로 Admin Middleware를 호출할 수 있게 등록</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &#x27;admin&#x27; =&gt; \App\Http\Middleware\Admin::class,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  ];</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>새로운 라우팅 파일로 관리하기 위해 RouteServiceProvider에 설정을 추가한다.</p>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_nMmE">app/Providers/RouteServiceProvider.php</div><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">...</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  public function map() {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    $this-&gt;mapAdminRoutes();</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  protected function mapAdminRoutes() {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    // /admin 으로 들어오는 요청에 대해 처리한다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    Route::prefix(&#x27;admin&#x27;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    // 이런식으로 한 번에 추가할 수도 있다. 하지만 except 함수를 쓸 수 없는 것 같고,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    // 라우팅 페이지에서 미들웨어를 등록해주는 게 더 편했다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    // -&gt;middleware([&#x27;web&#x27;, &#x27;admin&#x27;])</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      -&gt;middleware(&#x27;web&#x27;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      -&gt;namespace($this-&gt;namespace)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    // routes/admin.php 파일을 관리자 라우팅 파일로 등록한다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      -&gt;group(base_path(&#x27;routes/admin.php&#x27;));</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  }</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>마지막으로 라우팅 파일에 미들웨어를 넣어준다.</p>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_nMmE">routes/admin.php</div><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// admin middleware를 사용하고, namespace에 admin.을 추가한다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Route::group([&#x27;middleware&#x27; =&gt; &#x27;admin&#x27;, &#x27;as&#x27; =&gt; &#x27;admin.&#x27;], function() {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // 이 라우팅은 route(&#x27;admin.main&#x27;) 으로 접근이 가능해진다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  Route::get(&#x27;/&#x27;, &#x27;AdminController@index&#x27;)-&gt;name(&#x27;main&#x27;);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">});</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_PC_Z" id="활용">활용<a href="#활용" class="hash-link" aria-label="활용에 대한 직접 링크" title="활용에 대한 직접 링크">​</a></h3>
<p>기존 Auth 메소드들에 guard만 추가해주면 쉽게 사용 가능하다.</p>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Auth::guard(&#x27;admin&#x27;)-&gt;attepmt();</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Auth::guard(&#x27;admin&#x27;)-&gt;check();</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Auth::guard(&#x27;admin&#x27;)-&gt;user();</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Auth::guard(&#x27;admin&#x27;)-&gt;logout();</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="로그아웃">로그아웃<a href="#로그아웃" class="hash-link" aria-label="로그아웃에 대한 직접 링크" title="로그아웃에 대한 직접 링크">​</a></h2>
<p><strong>Auth::logout()</strong> 메소드를 호출하면 된다.</p>
<h1>이슈</h1>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="세션-아이디">세션 아이디<a href="#세션-아이디" class="hash-link" aria-label="세션 아이디에 대한 직접 링크" title="세션 아이디에 대한 직접 링크">​</a></h2>
<p>라라벨에선 로그인을 할 때 세션아이디를 새로운 값으로 엎어쳐버린다.
따라서 같은 환경에서 접근했는데, 로그인을 하면 다른 사용자가 되는 경우가 생긴다.
(로그아웃시에는 그대로다.)</p>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// 로그인 전에 세션아이디를 가져와</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$old_session_id = Session::getId();</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// 로그인이 성공하면 DB에서 등록된 세션값을 업데이트하자.</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h1>소셜 로그인</h1>
<p><code>laravel/socialite</code> 패키지를 설치하고 아주 쉽게 연동이 가능하다.</p>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="세팅">세팅<a href="#세팅" class="hash-link" aria-label="세팅 에 대한 직접 링크" title="세팅에 대한 직접 링크">​</a></h2>
<div class="language-bash codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-bash codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ composer require laravel/socialite</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>기본 socialite 패키지는 <code>facebook</code>, <code>twitter</code>, <code>linkedin</code>, <code>google</code>, <code>github</code> or <code>bitbucket</code> 만 연동이 가능하므로 다른 소셜 로그인을 연동하고 싶을 경우 <a href="https://socialiteproviders.github.io/" target="_blank" rel="noopener noreferrer"><code>Socialite Providers</code></a> 패키지를 사용하면 된다.</p>
<blockquote>
<p>Socialite Providers 사이트에는 Naver, Kakao, BattleNet(?) 등의 소셜 연동이 가능한 패키지가 무수히 많다.</p>
</blockquote>
<h1>여담</h1>
<p><a href="/2017/11/03/Laravel-5-5-JWT-Auth-Guide/">JWT 인증</a>과 같이본다면 Laravel을 사용한 실무에서 필요한 인증은 다 마무리한 셈일 듯</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>태그:</b><ul class="tags_GTCL padding--none margin-left--sm"><li class="tag_IZrL"><a class="tag_alSi tagRegular_w1M4" href="/tags/php/">php</a></li><li class="tag_IZrL"><a class="tag_alSi tagRegular_w1M4" href="/tags/laravel/">laravel</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="- 암호화 함수인 mcrypt 가 PHP 7.1 버전부터 Deprecated 되었다."><header><h2 class="title_CSpS" itemprop="headline"><a itemprop="url" href="/2017/07/07/PHP-7-1에서-mcrypt-대체하기/">PHP 7.1에서 mcrypt 대체하기</a></h2><div class="container_jZh9 margin-vert--md"><time datetime="2017-07-07T22:33:46.000Z" itemprop="datePublished">2017년 7월 7일</time> · <!-- -->약 3분</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_BNjk"><div class="avatar margin-bottom--sm"><a href="https://github.com/gracefullight" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/11773683?v=4" alt="Eunkwang Shin" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/gracefullight" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Eunkwang Shin</span></a></div><small class="avatar__subtitle" itemprop="description">Owner</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><ul>
<li>암호화 함수인 <code>mcrypt</code> 가 PHP 7.1 버전부터 Deprecated 되었다.</li>
<li>왜 사라졌는지는 <a href="https://paragonie.com/blog/2015/05/if-you-re-typing-word-mcrypt-into-your-code-you-re-doing-it-wrong" target="_blank" rel="noopener noreferrer">링크</a>에 자세하게 나와있다.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="기존-소스">기존 소스<a href="#기존-소스" class="hash-link" aria-label="기존 소스에 대한 직접 링크" title="기존 소스에 대한 직접 링크">​</a></h2>
<ul>
<li>
<p>PHP 구버전에서는 <code>mcrypt</code> 와 <code>MCRYPT_RIJNDAEL_128</code> 알고리즘을 통해 AES128 이 구현되어 있을 것이다.</p>
</li>
<li>
<p><strong>MCRYPT_RIJNDAEL_128</strong>은 <strong>AES 128</strong>과 <strong>동일</strong>하다.</p>
</li>
<li>
<p>타 언어와는 조금 다른데, 호환을 위해선 pkcs5 padding 으로 변경해주는 작업이 필요하다.</p>
</li>
<li>
<p>php mcrypt function 의 기본 패딩은 zeros padding</p>
</li>
</ul>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// 이런 식이거나</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$cipherText = mcrypt_encrypt(MCRYPT_RIJNDAEL_128, $key, pkcs5_pad($plainText), MCRYPT_MODE_CBC, $iv);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// 이런 식일 것</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$td = mcrypt_module_open(&quot;rijndael-128&quot;, &quot;&quot;, &quot;cbc&quot;, &quot;&quot;);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">@mcrypt_generic_init($td, $key, $iv);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$cipherText = @mcrypt_generic($td, pkcs5_pad($plainText));</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">mcrypt_generic_deinit($td);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">mcrypt_module_close($td);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">function pkcs5_pad($text, $blockSize = 16) {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  $pad = $blockSize - (strlen($text) % $blockSize);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  return $text . str_repeat(chr($pad), $pad);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="대안">대안<a href="#대안" class="hash-link" aria-label="대안에 대한 직접 링크" title="대안에 대한 직접 링크">​</a></h2>
<ul>
<li>PHP 5.3 부터 사용 가능한 <strong>openssl_encrypt</strong> 함수를 쓰면 된다.</li>
<li>openssl 확장 모듈이 설치되어야한다.</li>
</ul>
<h1>OPENSSL</h1>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="encrypt">Encrypt<a href="#encrypt" class="hash-link" aria-label="Encrypt에 대한 직접 링크" title="Encrypt에 대한 직접 링크">​</a></h2>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$cipherText = openssl_encrypt($plainText, &#x27;AES-128-CBC&#x27;, $key, OPENSSL_RAW_DATA, $iv);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// decrypt에서 오류가 발생해 PKCS5로 패딩을 맞춰주고 보내야한다면.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$cipherText = openssl_encrypt(pkcs5_pad($plainText), &#x27;AES-128-CBC&#x27;, $key, OPENSSL_RAW_DATA, $iv);</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="decrypt">Decrypt<a href="#decrypt" class="hash-link" aria-label="Decrypt에 대한 직접 링크" title="Decrypt에 대한 직접 링크">​</a></h2>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$plainText = openssl_decrypt($cipherText, &#x27;AES-128-CBC&#x27;, $key, OPENSSL_RAW_DATA, $iv);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// unpad가 필요하다면</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$plainText = pkcs5_unpad(openssl_decrypt($cipherText, &#x27;AES-128-CBC&#x27;, $key, OPENSSL_RAW_DATA, $iv));</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">function pkcs5_unpad($text) {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  $pad = ord($text{strlen($text)-1});</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  if ($pad &gt; strlen($text)) {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    return $text;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  if (!strspn($text, chr($pad), strlen($text) - $pad)) {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    return $text;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  return substr($text, 0, -1 * $pad);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="pkcs5-vs-pkcs7">PKCS5 vs PKCS7<a href="#pkcs5-vs-pkcs7" class="hash-link" aria-label="PKCS5 vs PKCS7에 대한 직접 링크" title="PKCS5 vs PKCS7에 대한 직접 링크">​</a></h2>
<ul>
<li><code>openssl_encrypt</code>의 default padding 은 PKCS7 padding 인데, 어떻게 호환이 되는 것일까?</li>
<li><a href="https://social.msdn.microsoft.com/Forums/en-US/09fef7b7-b568-4895-8e52-f386be80aa2d/pkcs7-padding-in-net-vs-pkcs5-padding-in-java?forum=csharpgeneral" target="_blank" rel="noopener noreferrer">여기</a>서 해답을 찾았다.</li>
</ul>
<blockquote>
<p>The difference between the PKCS#5 and PKCS#7 padding mechanisms is the block size;
PKCS#5 padding is defined for 8-byte block sizes, PKCS#7 padding would work for any block size from 1 to 255 bytes.
So fundamentally PKCS#5 padding is a subset of PKCS#7 padding for 8 byte block sizes.
so, data encrypted with PKCS#5 is able to decrypt with PKCS#7, but data encrypted with PKCS#7 may not be able to decrypt with PKCS#5.</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="triple-des">triple des<a href="#triple-des" class="hash-link" aria-label="triple des에 대한 직접 링크" title="triple des에 대한 직접 링크">​</a></h2>
<ul>
<li><code>des-ede3-cbc</code>가 triple des 알고리즘이다.</li>
</ul>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// encrypt</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">openssl_encrypt($text, &quot;des-ede3-cbc&quot;, $key, OPENSSL_RAW_DATA, $iv);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// decrypt</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">openssl_decrypt($cipherText, &quot;des-ede3-cbc&quot;, $key, OPENSSL_RAW_DATA, $iv);</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h1>패키지</h1>
<ul>
<li>이 모든 걸 커버하는 라이브러리를 사용하자. <a href="https://github.com/phpseclib/mcrypt_compat" target="_blank" rel="noopener noreferrer">phpseclib/mcrypt_compat</a></li>
<li><em>phpseclib</em> 는 laravel/passport 에서도 사용되었다.</li>
</ul>
<h1>여담</h1>
<p>카카오페이가 PHP 5 버전만 지원해 문의해봤지만 계획이 없어 이번 기회에 모듈을 다 뜯어봤는데 MCRYPT 만 만져주면 정상적으로 결제가 되었다.</p>
<p>곧 이 짓을 안해도 될 듯하다.
<img loading="lazy" src="https://i.imgur.com/QBA9xnP.jpg" alt="KakaoPay 종료" class="img_waBy"></p>
<p>이러다가 다시 선형대수학 공부하겠어.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>태그:</b><ul class="tags_GTCL padding--none margin-left--sm"><li class="tag_IZrL"><a class="tag_alSi tagRegular_w1M4" href="/tags/php/">php</a></li><li class="tag_IZrL"><a class="tag_alSi tagRegular_w1M4" href="/tags/openssl/">openssl</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="Linux, Nginx, MariaDB, PHP"><header><h2 class="title_CSpS" itemprop="headline"><a itemprop="url" href="/2017/06/10/CentOS7-LEMP-Stack-적용/">CentOS7 LEMP Stack 설치하기 (HTTP2, PHP7.1, Maria, Letsencrypt)</a></h2><div class="container_jZh9 margin-vert--md"><time datetime="2017-06-10T10:05:06.000Z" itemprop="datePublished">2017년 6월 10일</time> · <!-- -->약 9분</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_BNjk"><div class="avatar margin-bottom--sm"><a href="https://github.com/gracefullight" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/11773683?v=4" alt="Eunkwang Shin" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/gracefullight" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Eunkwang Shin</span></a></div><small class="avatar__subtitle" itemprop="description">Owner</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Linux, Nginx, MariaDB, PHP</p>
<blockquote>
<p><strong>Why LEMP instead of LNMP?</strong>
We go with LEMP due to the pronunciation for Nginx: Engine-X (en-juhn-ecks).
Think of how in English, the article an is used instead of a for hour even though it begins with a consonant.
The importance is the sound of the first letter rather than its written representation.
Besides, LEMP is actually pronounceable and doesn’t sound like reciting the alphabet.</p>
</blockquote>
<h1>PHP</h1>
<p>repo 를 등록하고 설치하는 방법이 있지만 php71 등의 이름으로 설정해야되서 번거롭다.
yum 명령어의 --enablerepo 옵션을 사용해 php71 repository 를 가져오자.</p>
<div class="language-bash codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-bash codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain"># php repo를 가져오기</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ yum -y install http://rpms.famillecollet.com/enterprise/remi-release-7.rpm</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ vi /etc/yum.repos.d/remi-php71.repo</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">[remi-php71]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">name=Remi\&#x27;s PHP 7.1 RPM repository for Enterprise Linux 7 - $basearch</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">#baseurl=http://rpms.remirepo.net/enterprise/7/php71/$basearch/</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">mirrorlist=http://rpms.remirepo.net/enterprise/7/php71/mirror</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 이 값을 1로 바꿔준다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">enabled=1</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">gpgcheck=1</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-remi</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ yum -y install php php-fpm php-devel php-curl php-mcrypt php-mysql php-xmlrpc php-mbstring php-zip 등등</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ systemctl start php-fpm</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ systemctl enable php-fpm</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h1>Maria</h1>
<p><a href="/2016/12/23/CentOS-Maria-DB-설치/">예전 포스팅</a>으로 대체한다. 설치방법은 똑같고 버전만 다르게 해주면 된다.
설치 후 서비스 실행만 <code>systemctl</code> 명령어로 해주자.</p>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="xtrabackup">Xtrabackup<a href="#xtrabackup" class="hash-link" aria-label="Xtrabackup에 대한 직접 링크" title="Xtrabackup에 대한 직접 링크">​</a></h2>
<p>이제 mysqldump 를 좀 놓아주고 Incremental Backup 을 해주자.
이게 왜 좋은지는 <a href="https://www.percona.com/software/mysql-database/percona-xtrabackup/feature-comparison" target="_blank" rel="noopener noreferrer">공홈</a>이나 <a href="http://www.yes24.com/24/goods/12982561?scode=032&amp;OzSrank=1" target="_blank" rel="noopener noreferrer">책</a>이나 다른 블로그에 자세히 설명되어있다.</p>
<div class="language-bash codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-bash codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain"># xtrabackup 설치</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ yum -y install xtrabackup</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 증분백업을 위해 전체 백업이 한 번 필요하다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># root가 아닌 유저일 경우 해당 DB를 백업하기 위해 PROCESS 등 여러 권한을 추가해야한다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># (로그 메세지로 추가하라고 나온다.)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ innobackupex --user=&#x27;root&#x27; --password=&#x27;암호&#x27; --databases=&#x27;DB&#x27; --no-timestamp /백업위치</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 증분백업</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ innobackupex --user=&#x27;root&#x27; --password=&#x27;암호&#x27; --incremental --incremental-basedir=&#x27;/백업위치/xtrabackup_checkpoints&#x27; --no-timestamp /증분백업위치</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 증분백업을 전체백업 위에 얹기</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ innobackupex --apply-log --redo-only --incremental-dir=&#x27;/증분백업위치&#x27; /백업위치</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 증분백업 삭제</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ rm -rf /증분백업위치</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 복원</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ systemctl stop mariadb</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 데이터 폴더를 날려야한다. (만약을 대비해 백업)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ rm -rf /var/lib/mysql/*</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ innobackupex --copy-back /백업위치</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 권한부여</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ chown -R mysql:mysql /var/lib/mysql</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ systemctl start mariadb</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h1>Nginx</h1>
<p><strong>HTTP2 를 적용하기 위해서는 Nginx 1.9 버전과 Openssl 1.0.2 버전 이상이 필요</strong>한데, 기본 repository 에는 이 버전이 적용되어있지 않다.
따라서 검색해보면 컴파일 설치를 해야 된다는 글이 다수다. 모든 패키지는 패키지 매니져로 관리하는게 좋다고 생각하는 나로썬 그냥 넘어갈 수 없다.
Nginx 최신 repository 를 관리해주는 <a href="https://brouken.com/brouken-centos-7-repo/" target="_blank" rel="noopener noreferrer">나이스한 곳</a>을 찾았다.</p>
<div class="language-bash codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-bash codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ yum -y install yum-utils</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ yum-config-manager --add-repo https://brouken.com/brouken.repo</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 기존 nginx repo를 사용하지 않는다는 옵션</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ yum-config-manager --save --setopt=epel.exclude=nginx*;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ yum -y install nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ systemctl start nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ systemctl enable nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># nginx 버전 확인</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ Nginx -V</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">nginx version: nginx/1.13.1</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">built with OpenSSL 1.0.2k 26 Jan 2017</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="setopt-가-오류가-날-경우">setopt 가 오류가 날 경우<a href="#setopt-가-오류가-날-경우" class="hash-link" aria-label="setopt 가 오류가 날 경우에 대한 직접 링크" title="setopt 가 오류가 날 경우에 대한 직접 링크">​</a></h2>
<p>ngixn.repo 를 만들어주고 연결하자.</p>
<div class="language-bash codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-bash codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ vi /etc/yum.repos.d/nginx.repo</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># vim /etc/yum.repos.d/nginx.repo</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">[nginx]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">name=nginx repo</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">baseurl=http://nginx.org/packages/mainline/centos/7/$basearch/</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">gpgcheck=0</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">enabled=1</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 저장하고 설치 시작</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ yum update</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ yum -y install nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ systemctl start nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ systemctl enable nginx</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h1>LetsEncrypt</h1>
<p>공짜 SSL 인 LetsEncrypt 의 이름이 certbot 으로 바뀌었다. <a href="https://certbot.eff.org/#centosrhel7-nginx" target="_blank" rel="noopener noreferrer">공홈</a>을 참조해도 좋다.
인증을 받기위해 먼저 도메인을 따야한다.</p>
<div class="language-bash codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-bash codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ yum -y install certbot</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 인증</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ certbot certonly --standalone -d example.com -d www.example.com</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 갱신 확인</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ certbot renew --dry-run</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 갱신하면서 nginx 재부팅</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 이 명령어를 적절히 cron에 넣어주자.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ certbot renew --pre-hook=&quot;systemctl stop nginx&quot; --post-hook=&quot;systemctl start nginx&quot;</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>인증이 성공하면 <strong>/etc/letsencrypt/live/example.com/</strong> 경로 아래에 키가 떨어질 것이다.
자세한 명령어 옵션은 <a href="https://certbot.eff.org/docs/using.html" target="_blank" rel="noopener noreferrer">Docs</a> 참조.</p>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="nginx-연동">nginx 연동<a href="#nginx-연동" class="hash-link" aria-label="nginx 연동에 대한 직접 링크" title="nginx 연동에 대한 직접 링크">​</a></h2>
<p>ssl 을 적용하면서 HTTP2 도 붙혀보자.
HTTP2 에서는 bundling 보다 파일을 쪼개서 보내는게 더 효율적이라고 한다. (non-blocking 이니까)</p>
<div class="language-conf codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-conf codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain"># HTTP</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">server {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    listen 80;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    server_name example.com www.example.com;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    # certbot --webroot 인증을 받기위한 설정</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    #location ^~ /.well-known/acme-challenge/ {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    #	default_type &quot;text/plain&quot;;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    #	root /var/www/letsencrypt;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    #}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    # 80 접속시 443으로 redirect</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    location / {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">       return 301 https://$server_name$request_uri;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># HTTPS</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">server {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  listen 443 ssl http2;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  listen [::]:443 ssl http2;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  server_name example.com www.example.com;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  root /var/nginx/www/public;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  index index.php index.html;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  # 지저분한 보안 옵션은 추천옵션이니 넣어주자.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  ssl on;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  ssl_certificate /etc/letsencrypt/live/example.com/fullchain.pem;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  ssl_trusted_certificate /etc/letsencrypt/live/example.com/fullchain.pem;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  ssl_session_timeout 1d;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  ssl_session_cache shared:SSL:50m;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  ssl_session_tickets off;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  #ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  ssl_protocols TLSv1.2;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  ssl_ciphers EECDH+AESGCM:EECDH+AES;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  ssl_ecdh_curve secp384r1;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  ssl_prefer_server_ciphers on;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  ssl_stapling on;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  ssl_stapling_verify on;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  location / {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    try_files $uri $uri/ /index.php?$query_string;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  location ~ \.php {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    fastcgi_split_path_info ^(.+\.php)(/.+)$;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    include fastcgi_params;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    fastcgi_param SCRIPT_NAME $fastcgi_script_name;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    fastcgi_index index.php;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    fastcgi_pass 127.0.0.1:9000;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  location ~ /\.ht {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    deny all;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  # 캐싱할 데이터가 있다면 추가</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  location ~* \.(?:jpg|jpeg|gif|png|ico|cur|gz|svg|svgz|mp4|ogg|ogv|webm|htc|woff)$ {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    expires 1M;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    add_header Cache-Control &quot;public&quot;;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  location ~* \.(?:css|js)$ {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    expires 7d;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    add_header Cache-Control &quot;public&quot;;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>해당 세팅은 Laravel5.4 용이다.</p>
<p>nginx.conf 에는 해당 옵션들도 추가해주자.</p>
<div class="language-bash codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_nMmE">nginx.conf</div><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-bash codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">  # CPU 물리 코어에 따라 설정한다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  # 1코어에선 1로 나머지는 auto로 설정하면 된다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  # grep ^processor /proc/cpuinfo | wc -l 로 확인 가능</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  worker_processes 1;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  events {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    # 각 worker process에서 한 번에 처리할 수 있는 최대 연결 수</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    # ulimit -n의 값과 같게 설정하자.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    worker_connections 1024;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    # I/O event 노티 방식을 epoll로 사용. (poll보다 발전한 방식)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    use epoll;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    # worker가 한 번에 모든 연결을 수용할 수 있도록 설정</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    multi_accept on;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  http {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    # access_log 제거</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    access_log off;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    server_tokens off;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    # iframe 보안 이슈 DENY</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    add_header X-Frame-Options DENY;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    add_header X-Content-Type-Options nosniff;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    add_header X-XSS-Protection &quot;1; mode=block&quot;;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    # PHP 서버라는 header 제거</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    fastcgi_hide_header X-Powered-By;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    # static file 제공 최적화</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    sendfile       on;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    # TCP multiple buffer를 individual packet으로 전송하게 변경</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    tcp_nopush     on;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    # TCP에서 TCP_CORK 옵션을 활성화</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    # MTU에서 IP 헤더의 40-60 Byte를 뺀값과 같다는데 뭐라는건지 모르겠다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    tcp_nodelay    on;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    # keep alive 설정</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    keepalive_timeout  65;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    # keepalive_requests 100000;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    # gzip 압축설정</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    gzip on;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    gzip_min_length 1000;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    gzip_types application/x-javascript text/css application/javascript text/javascript text/plain text/xml application/json application/vnd.ms-fontobject application/x-font-opentype application/x-font-truetype application/x-font-ttf application/xml font/eot font/opentype font/otf image/svg+xml image/vnd.microsoft.icon;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    gzip_disable &quot;MSIE [1-6]\.&quot;;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  }</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>적용 후에 <a href="https://chrome.google.com/webstore/detail/http2-and-spdy-indicator/mpbpobfflnpcgagjijhmgnchggcjblin?utm_source=chrome-ntp-icon" target="_blank" rel="noopener noreferrer">HTTP2 확인 확장프로그램</a> 설치 후 이 프로그램에 파란불이 들어오면 성공이다.</p>
<h1>파일 백업</h1>
<p>소스는 git 으로 관리가 되는데 static 파일은 주기적으로 백업이 필요하다.</p>
<div class="language-bash codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_nMmE">file_backup.sh</div><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-bash codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">NOW_DATE=`date`</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">BACKUP_DATE=`date +&quot;%Y%m%d&quot;`</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">FILE_DIR=백업할  폴더 경로</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">BACKUP_DIR=백업된 파일 경로</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># gz 압축</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">tar zcvf ${BACKUP_DIR}/${BACKUP_DATE}.tar.gz ${FILE_DIR}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 3일 이상된 백업파일은 제거</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">find ${BACKUP_DIR}/ -mtime +3 -exec rm -f {} \;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># find ${BACKUP_DIR}/ -mtime 3 -delete</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h1>여담</h1>
<p>다음부터 Ubuntu 쓸까 생각했는데, Nginx 최신 Repo 를 찾은게 컸다. 하지만 빨리 Docker 책 읽자.
Nginx, Reverse Proxy, Redis, PHP, Jenkins 를 한 번에 해결해주겠지.
이제 DockerFile 이 잘 읽히긴 하는데, 언제쯤 갈아탈 수 있으려나</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>태그:</b><ul class="tags_GTCL padding--none margin-left--sm"><li class="tag_IZrL"><a class="tag_alSi tagRegular_w1M4" href="/tags/linux/">linux</a></li><li class="tag_IZrL"><a class="tag_alSi tagRegular_w1M4" href="/tags/php/">php</a></li><li class="tag_IZrL"><a class="tag_alSi tagRegular_w1M4" href="/tags/nginx/">nginx</a></li><li class="tag_IZrL"><a class="tag_alSi tagRegular_w1M4" href="/tags/mariadb/">mariadb</a></li><li class="tag_IZrL"><a class="tag_alSi tagRegular_w1M4" href="/tags/letsencrypt/">letsencrypt</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="Eloquent ORM을 사용해 데이터를 가져와보자."><header><h2 class="title_CSpS" itemprop="headline"><a itemprop="url" href="/2017/06/06/Laravel-5-4-Eloquent-Model/">Laravel 5.5 - Eloquent ORM 사용하기</a></h2><div class="container_jZh9 margin-vert--md"><time datetime="2017-06-06T11:49:33.000Z" itemprop="datePublished">2017년 6월 6일</time> · <!-- -->약 17분</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_BNjk"><div class="avatar margin-bottom--sm"><a href="https://github.com/gracefullight" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/11773683?v=4" alt="Eunkwang Shin" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/gracefullight" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Eunkwang Shin</span></a></div><small class="avatar__subtitle" itemprop="description">Owner</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Eloquent ORM을 사용해 데이터를 가져와보자.
<a href="/2017/05/16/Laravel-5-4-Start/">이전 포스팅</a>에서 이어진다. (Eloquent ORM 기능만 필요하다면 <a href="#Model">3.Model</a>부터 보면 된다)</p>
<p>DBMS에 상관 없이 테이블을 똑같이 생성하기 위한 기능이다.</p>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="생성">생성<a href="#생성" class="hash-link" aria-label="생성에 대한 직접 링크" title="생성에 대한 직접 링크">​</a></h2>
<p>artisan 명령어로 간단히 생성할 수 있다. 날짜_테이블 형식의 파일이 database/migrations 밑에 생성된다.
<strong>이 파일들의 자동 생성된 이름을 절대 변경하지 말자</strong> 내부적으로 언더스코어를 <em>explode</em>해 class를 호출하기 때문에 건들면 고생한다.</p>
<div class="language-bash codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-bash codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 모델을 생성하면서 같이 생성</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># m 옵션을 추가한다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ php artisan make:model -m 모델명</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 마이그레이션만 생성</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ php artisan make:migration 마이그레이션명</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>생성 후에 up 메소드 안에 테이블을 꾸며주고 down 메소드에 테이블을 지울 때 실행할 로직을 구현한다.
컬럼 타입을 지정하는 메소드는 <a href="https://laravel.com/docs/5.4/migrations#columns" target="_blank" rel="noopener noreferrer">여기</a>를 참조하면 된다.</p>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">public function up() {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  Schema::create(&#x27;table_name&#x27;, function (Blueprint $table) {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    $table-&gt;increments(&#x27;idx&#x27;);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    $table-&gt;string(&#x27;id&#x27;, 20)-&gt;unique();</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    $table-&gt;string(&#x27;name&#x27;, 30);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    $table-&gt;string(&#x27;email&#x27;, 100)-&gt;unique();</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    $table-&gt;string(&#x27;password&#x27;, 250);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    $table-&gt;tinyInteger(&#x27;tiny&#x27;)-&gt;nullable();</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    $table-&gt;timestamps();</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  });</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// 테이블에 외래키 제약조건이 걸려있을 경우 migration으로 일괄 삭제시에</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// 오류가 발생하므로, 외래키 체크 옵션을 비활성화 해줘야될 수 도 있다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">public function down() {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  DB::statement(&#x27;SET FOREIGN_KEY_CHECKS = 0&#x27;);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  Schema::dropIfExists(&#x27;table_name&#x27;);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  DB::statement(&#x27;SET FOREIGN_KEY_CHECKS = 1&#x27;);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="실행">실행<a href="#실행" class="hash-link" aria-label="실행에 대한 직접 링크" title="실행에 대한 직접 링크">​</a></h2>
<p>php artisan migrate 명령어로 실행하면 된다.</p>
<ul>
<li>migrate =&gt; 전체 실행</li>
<li>migrate<!-- -->:refresh<!-- --> =&gt; 다시 실행</li>
<li>migrate<!-- -->:rollback<!-- --> =&gt; 마지막 migrate 시점으로 돌림</li>
<li>migrate<!-- -->:reset<!-- --> =&gt; 제거</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="tinker">Tinker<a href="#tinker" class="hash-link" aria-label="Tinker에 대한 직접 링크" title="Tinker에 대한 직접 링크">​</a></h2>
<p>이미 데이터가 들어간 테이블이 있어 migrate --path로 한 파일만을 실행해야 하는데, tinker를 사용하면 더 쉽게 해당 마이그레이션을 실행시킬 수 있다.
Tinker는 커맨드로 라라벨 쉘(실행환경)으로 들어간다고 생각하면 된다.</p>
<div class="language-bash codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-bash codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain"># tinker</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ php artisan tinker</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># shell로 접속된다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Psy Shell v0.8.5 (PHP 7.0.7 ??cli) by Justin Hileman</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">New version is available (current: v0.8.5, latest: v0.8.8)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">&gt;&gt;&gt;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># blueprint 의존성을 추가해주고 (Blueprint는 up 메소드에 DI로 들어가 있기에 읽지 못한다.)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ use Illuminate\Database\Schema\Blueprint;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 새로 실행하려 했던 스키마를 실행시켜주기만 하면 된다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ Schema::create(&#x27;new_table&#x27;, function (Blueprint $table) {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    $table-&gt;increments(&#x27;idx&#x27;);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    $table-&gt;string(&#x27;id&#x27;, 20)-&gt;unique();</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    $table-&gt;timestamps();</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  });</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>DB에 해당 테이블이 생성된 걸 확인할 수 있다.</p>
<h1>Seed</h1>
<p>Seed는 테이블에 필수 데이터 또는 더미 데이터를 심어주는 과정이다.
테스트에 필요한 데이터를 넣어주는데 아주 효과적이다.</p>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="생성-1">생성<a href="#생성-1" class="hash-link" aria-label="생성에 대한 직접 링크" title="생성에 대한 직접 링크">​</a></h2>
<div class="language-bash codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-bash codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ php artisan make:seeder 시더명</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>database/seeds 아래에 파일이 생성된다.
파일을 열어보면 run() 메소드 하나가 있는데, 여기에 시드파일이 호출될 때 실행할 로직을 구현해주면 된다.</p>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_nMmE">database/seeds/BoardSeed.php</div><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">public function run() {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // 모델로 생성하기</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  Board::create([</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &#x27;title&#x27; =&gt; &#x27;공지&#x27;,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &#x27;author&#x27; =&gt; &#x27;관리자&#x27;,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &#x27;content&#x27; =&gt; &#x27;공지입니다&#x27;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  ]);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // DB 파사드로 생성하기</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  DB::table(&#x27;board&#x27;)-&gt;insert([</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &#x27;title&#x27; =&gt; &#x27;공지&#x27;,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &#x27;author&#x27; =&gt; &#x27;관리자&#x27;,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &#x27;content&#x27; =&gt; &#x27;공지입니다&#x27;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  ]);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_PC_Z" id="faker">Faker<a href="#faker" class="hash-link" aria-label="Faker에 대한 직접 링크" title="Faker에 대한 직접 링크">​</a></h3>
<p>랜덤한 테스트용 데이터가 많이 필요하다면, 가짜(더미) 데이터를 생성해주는 <a href="https://github.com/fzaninotto/Faker" target="_blank" rel="noopener noreferrer">라이브러리</a>를 사용할 수 있다.
링크를 따라가보면 정말 엄청난 종류의 랜덤 데이터를 생성할 수 있음에 놀랄 것이다.</p>
<p>faker를 사용하려면 ModelFactory를 먼저 정의해야한다.
상품 모델을 가져와 가짜 데이터 타입을 정의해보자.</p>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_nMmE">database/factories/ModelFactory.php</div><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$factory-&gt;define(App\Models\Product::class, function(Faker\Generator $faker){</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  return [</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      // 메소드는 위의 라이브러리를 참고하자.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      // 상품명을 중복되지 않게 city(도시명)으로 가져온다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &#x27;name&#x27; =&gt; $faker-&gt;unique()-&gt;city,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      // 색상 헥스코드를 가져온다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &#x27;color&#x27; =&gt; $faker-&gt;safeColorName,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      // 1000~50000원 사이의 가격을 가져온다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &#x27;price&#x27; =&gt; $faker-&gt;numberBetween(1000, 50000),</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      // lorempixel의 랜덤 이미지를 가져온다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &#x27;thumbnail&#x27; =&gt; $faker-&gt;imageUrl(200, 100),</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &#x27;detail_image&#x27; =&gt; $faker-&gt;imageUrl(300, 600),</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &#x27;qty&#x27; =&gt; $faker-&gt;numberBetween(1, 1000),</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &#x27;status&#x27; =&gt; 1,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &#x27;owner&#x27; =&gt; $faker-&gt;name,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &#x27;sorting&#x27; =&gt; $faker-&gt;numberBetween(1, 9999)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  ];</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">});</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="실행-1">실행<a href="#실행-1" class="hash-link" aria-label="실행에 대한 직접 링크" title="실행에 대한 직접 링크">​</a></h2>
<p>위에서 선언한 faker 모델을 seed에서 호출해보자.</p>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_nMmE">database/seeds/ProductSeed.php</div><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">public function run() {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // 두번째 인자로 실행시킬 횟수를 넣어주면 된다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  factory(App\Models\Product::class, 100)-&gt;create();</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-bash codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-bash codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ php artisan db:seed</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>테이블에 상품 더미데이터가 100개 생성된 것을 확인할 수 있다.</p>
<h1>Model</h1>
<p>모델은 하나의 테이블의 타입을 정해 놓은 것이라 보면 된다.
데이터를 가져오거나 넣을 때 모델에 정의된 형태로 가져온다.</p>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="기본-구조">기본 구조<a href="#기본- 구조" class="hash-link" aria-label="기본 구조에 대한 직접 링크" title="기본 구조에 대한 직접 링크">​</a></h2>
<p>아래 구조 정도만 알아두면 된다. 더 자세한건 <a href="https://github.com/laravel/framework/blob/5.4/src/Illuminate/Database/Eloquent/Model.php" target="_blank" rel="noopener noreferrer">Eloquent Model Class</a>를 확인해보자.</p>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_nMmE">app/Models/Board.php</div><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">namespace App\Models;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">use Illuminate\Database\Eloquent\Model;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">class Board extends Model {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // 임의의 생성 필드가 있다면 설정해준다. (기본값 created_at)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  const CREATED_AT = &#x27;created_dt&#x27;;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // 사용하지 않을 경우 Null로 초기화해주자. (기본값 updated_at)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  const UPDATED_AT = null;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // 둘 다  사용하지 않을 경우 timestamps만 꺼주면 된다. (기본값 true)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  public $timestamps = false;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // PK가 auto increment가 아닐경우 false로 바꿔준다. (기본값 true)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  public $incrementing = false;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // PK 값을 변경한다. (기본값 id)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  protected $primaryKey = &#x27;idx&#x27;;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // 테이블 명을 변경한다. (기본값 모델명의 복수형)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  protected $table = &#x27;board&#x27;;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // dump insert 및 dump update가 안되는 필드를 설정한다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  protected $guarded = [</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &#x27;idx&#x27;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  ];</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // guarded와 fillable 중 하나만 있으면 된다. (써보니 guarded가 편하더라.)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // dump insert 및 dump update가 가능한 필드를 설정한다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  //protected $fillable = [</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  //  &#x27;title&#x27;, &#x27;content&#x27;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  //];</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // 노출시키지 않을 필드가 있을 경우</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  protected $hidden = [</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &#x27;password&#x27;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  ];</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="relationship">Relationship<a href="#relationship" class="hash-link" aria-label="Relationship에 대한 직접 링크" title="Relationship에 대한 직접 링크">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_PC_Z" id="11">1:1<a href="#11" class="hash-link" aria-label="1:1에 대한 직접 링크" title="1:1에 대한 직접 링크">​</a></h3>
<p>hasOne과 belongsTo로 연결한다.</p>
<h3 class="anchor anchorWithStickyNavbar_PC_Z" id="1">1<!-- -->:n<a href="#1" class="hash-link" aria-label="1에 대한 직접 링크" title="1에 대한 직접 링크">​</a></h3>
<p>hasMany와 belongsTo로 연결한다.</p>
<h3 class="anchor anchorWithStickyNavbar_PC_Z" id="n">n<!-- -->:m<a href="#n" class="hash-link" aria-label="n에 대한 직접 링크" title="n에 대한 직접 링크">​</a></h3>
<p>belongsToMany로 연결한다.
처음에 제일 감이 안왔던 Relationship이지만 코드를 보면 이해하기가 쉽다.
주문(Order) - 주문 상품(OrderProduct) - 상품(Product) 테이블이 있다고 가정한다. 각각 시작 - 링크(피벗) - 종료 테이블이다.</p>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;?php App/Models/Order.php</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">public function product(){</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // 마지막으로 연결될 모델명, 링크 테이블 명, 시작-&gt;링크를 연결시킬 인덱스, 링크-&gt;종료를 연결시킬 인덱스</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  return $this-&gt;belongsToMany(&#x27;App\Models\Product&#x27;, &#x27;order_product&#x27;, &#x27;order_id&#x27;, &#x27;product_id&#x27;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">          // 링크 테이블의 컬럼을 가져와야할 때</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">          -&gt;withPivot([&#x27;price&#x27;, &#x27;quantity&#x27;]);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>이렇게 정의하면 뷰에서 <strong>order-&gt;product</strong>를 <em>foreach</em>로 돌려 <strong>product-&gt;product_id</strong>처럼 접근할 수 있고
<strong>product-&gt;pivot-&gt;price</strong>로 pivot 테이블의 데이터도 가져올 수 있다.</p>
<h3 class="anchor anchorWithStickyNavbar_PC_Z" id="111">1:1:1<a href="#111" class="hash-link" aria-label="1:1:1에 대한 직접 링크" title="1:1:1에 대한 직접 링크">​</a></h3>
<p>이런 관계가 있을 경우에 라라벨에서 관계메소드를 직접 지원하지는 않는다.
억지로 사용하려면, <code>hasOne</code>을 두 번 사용해 연결해야하는데, Select Query를 두 번 날려야 된다는 소리다. (참을 수 없다)</p>
<p><a href="https://github.com/znck/belongs-to-through" target="_blank" rel="noopener noreferrer">BelongsToThrough</a> trait 패키지를 통해 깔끔하게 해결할 수 있다.
메소드에서 <code>belongsToMany</code>처럼 커스텀 외래키를 사용해야할 경우엔 5번째 파라미터로 <strong>[ 클래스 =&gt; 키 ]</strong> 형식으로 넘겨주면 된다. (<a href="https://github.com/znck/belongs-to-through/pull/25/files" target="_blank" rel="noopener noreferrer">여기</a>의 소스를 참고하자)</p>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="이슈">이슈<a href="#이슈" class="hash-link" aria-label="이슈에 대한 직접 링크" title="이슈에 대한 직접 링크">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_PC_Z" id="orm의-join-방식">ORM의 Join 방식<a href="#orm의-join-방식" class="hash-link" aria-label="ORM의 Join 방식에 대한 직접 링크" title="ORM의 Join 방식에 대한 직접 링크">​</a></h3>
<p>한 방 쿼리가 불가능하다. 오직 PK를 통해 Select된 데이터들을 다시 PHP 단에서 합쳐서 보여준다.
한 방이 필요할 때는 Database에서 View를 이용하거나 DB 파사드를 써야한다.</p>
<h3 class="anchor anchorWithStickyNavbar_PC_Z" id="composite-key">Composite Key<a href="#composite-key" class="hash-link" aria-label="Composite Key에 대한 직접 링크" title="Composite Key에 대한 직접 링크">​</a></h3>
<p>라라벨 Eloquent Model에서 복합키를 사용할 수는 없다. 편법으로 <a href="https://stackoverflow.com/questions/31415213/how-i-can-put-composite-keys-in-models-in-laravel-5" target="_blank" rel="noopener noreferrer">trait를 추가</a>할 수 있는데 find 메소드도 overriding 해야 된다.</p>
<h3 class="anchor anchorWithStickyNavbar_PC_Z" id="timestamps">Timestamps<a href="#timestamps" class="hash-link" aria-label="Timestamps에 대한 직접 링크" title="Timestamps에 대한 직접 링크">​</a></h3>
<p>created_at과 updated_at은 timestamps 형식이라 date_format과 같은 쿼리함수 대신 whereDate 메소드로 연산을 실행해야한다.
물론 DB에 데이터가 들어가기 전 datetime으로 해당 컬럼을 변경해주면 된다.
(timestamps의 유효기간은 2035 년까지므로.)</p>
<h3 class="anchor anchorWithStickyNavbar_PC_Z" id="group-by">Group By<a href="#group-by" class="hash-link" aria-label="Group By에 대한 직접 링크" title="Group By에 대한 직접 링크">​</a></h3>
<p>GroupBy를 이용한 쿼리 사용시에 <strong>Syntax error or access violation: 1055 &#x27;table.column&#x27; isn&#x27;t in GROUP BY</strong>라는 오류 메세지가 보이며 실행이 안 되는 경우가 있다. 해당 컬럼으로 GroupBy를 하지 않았는데도 발생한다.</p>
<p>database config의 strict 모드 중 <strong>ONLY_FULL_GROUP_BY</strong> 모드가 활성화 되어있어서 그런데 이 모드만 제외를 시켜주면 된다.</p>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_nMmE">config/database.php</div><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">&#x27;connections&#x27; =&gt; [</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &#x27;mysql&#x27; =&gt; [</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    // strict 속성을 false로 바꿔준다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &#x27;strict&#x27; =&gt; false,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    // modes 속성을 추가해 기본 strict 옵션을 다시 추가한다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &#x27;modes&#x27; =&gt; [</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &#x27;STRICT_TRANS_TABLES&#x27;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &#x27;NO_ZERO_IN_DATE&#x27;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &#x27;NO_ZERO_DATE&#x27;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &#x27;ERROR_FOR_DIVISION_BY_ZERO&#x27;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &#x27;NO_AUTO_CREATE_USER&#x27;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &#x27;NO_ENGINE_SUBSTITUTION&#x27;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  ],</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>변경 후 config<!-- -->:cache<!-- -->로 config 파일들을 다시 캐싱해주자.</p>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="연동">연동<a href="#연동" class="hash-link" aria-label="연동에 대한 직접 링크" title="연동에 대한 직접 링크">​</a></h2>
<p>만든 모델을 선언만 하면 <a href="https://laravel.com/docs/5.4/eloquent#inserting-and-updating-models" target="_blank" rel="noopener noreferrer">Eloquent Model 메소드</a>와 <a href="https://laravel.com/docs/5.4/queries" target="_blank" rel="noopener noreferrer">Query Builder 메소드</a>를 사용할 수 있다.</p>
<p>CRUD는 다음과 같다.</p>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_nMmE">YourController.php</div><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">use App\Model;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">public function test($id) {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // PK로 데이터 1개 반환</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  Model::find($id);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  Model::where(&#x27;idx&#x27;, $id)-&gt;first();</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // 전체 데이터 반환</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  Model::all();</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // 조건 데이터 반환</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  Model::where()-&gt;get();</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // Insert</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  $model = new Model;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  $model-&gt;column = &#x27;추가 값&#x27;;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  $model-&gt;column2 = &#x27;추가 값2&#x27;;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  $model-&gt;save();</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // Mass Insert</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  Model::create([</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &#x27;column&#x27; =&gt; &#x27;추가 값&#x27;,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &#x27;column2&#x27; =&gt; &#x27;추가 값2&#x27;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  ]);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // Bulk Insert</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  Model::insert([[</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &#x27;column&#x27; =&gt; &#x27;추가 값&#x27;,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &#x27;column2&#x27; =&gt; &#x27;추가 값2&#x27;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  ], [</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &#x27;column&#x27; =&gt; &#x27;추가 값&#x27;,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &#x27;column2&#x27; =&gt; &#x27;추가 값2&#x27;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  ]]);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // Update</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  $model = Model::find($id);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  $model-&gt;column = &#x27;변경 값&#x27;;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  $model-&gt;column2 = &#x27;변경 값2&#x27;;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  $model-&gt;save();</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // Mass Update</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  Model::where()-&gt;update([</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &#x27;column&#x27; =&gt; &#x27;변경 값&#x27;,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &#x27;column2&#x27; =&gt; &#x27;변경 값2&#x27;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  ]);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // Delete</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  Model::destory($id);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  Model::find($id)-&gt;delete();</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  Model::where()-&gt;delete();</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="collection과-model의-차이">Collection과 Model의 차이<a href="#collection과-model의-차이" class="hash-link" aria-label="Collection과 Model의 차이에 대한 직접 링크" title="Collection과 Model의 차이에 대한 직접 링크">​</a></h2>
<p>Model에서 쓸 수 있는 메소드와 Collection에서 쓸 수 있는 메소드가 다르다.
Model Class에서 정의하는 관계 메소드들은 Model에서만 사용 가능하다.</p>
<ul>
<li><strong>Collection</strong>: <code>Array&lt;Model&gt;</code> 즉 모델의 집합이다.</li>
<li><strong>Model</strong>: 테이블에서 하나의 행이라고 생각하자.</li>
</ul>
<h1>Paging</h1>
<p>모델에서 paginate 메소드를 사용하면, querystring에 page 변수가 붙어 페이징이 된다. (예를들면 /boards?page=1)
라라벨의 기본 페이징은 Bootstrap의 Class를 사용한다.</p>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// 이렇게 모델을 가지고 왔다면</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Model::where()-&gt;get();</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// get을 paginate로 바꿔주기만 하면 된다. (뿌려지는 list item의 기본값은 15이다.)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Model::where()-&gt;paginate(10);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// next와 prev 버튼이 없는 pagination을 구현하고 싶다면</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Model::where()-&gt;simplePaginate(10);</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>페이징 뷰를 꾸미고 싶다면 아래 명령어를 실행해 <strong>resources/views/vendor/pagination</strong>에 view가 생기고 <strong>default.blade.php</strong>를 수정하면 된다.</p>
<div class="language-bash codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-bash codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ php artisan vendor:publish --tag=laravel-pagination</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="ajax-pagination">ajax pagination<a href="#ajax-pagination" class="hash-link" aria-label="ajax pagination에 대한 직접 링크" title="ajax pagination에 대한 직접 링크">​</a></h2>
<p>실무에선 Paging 호출을 GET보단 AJAX를 쓰는게 깔끔한데 List View와 ListItem View, Controller 세부분을 모두 변경해줘야한다.
아래 소스는 jQuery를 사용하고 있다고 가정한다. (Frontend Framework를 같이 사용하고 있다면 더 깔끔하게 처리 될 수 있을듯)</p>
<h3 class="anchor anchorWithStickyNavbar_PC_Z" id="controller">Controller<a href="#controller" class="hash-link" aria-label="Controller에 대한 직접 링크" title="Controller에 대한 직접 링크">​</a></h3>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_nMmE">YourController.php</div><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">public function list(Request $request) {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // ajax 요청일 경우에 listitem 뷰 반환</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  if ($request-&gt;ajax()) {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    return view(&#x27;listitem&#x27;, [</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &#x27;data&#x27; =&gt; Model::where()-&gt;paginate(10);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    ]);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // get 요청일 경우에 list 뷰 반환</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  } else {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    return view(&#x27;list&#x27;, [</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &#x27;data&#x27; =&gt; Model::where()-&gt;paginate(10);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    ])</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_PC_Z" id="list-view">List view<a href="#list-view" class="hash-link" aria-label="List view에 대한 직접 링크" title="List view에 대한 직접 링크">​</a></h3>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_nMmE">list.blade.php</div><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;div id=&quot;list&quot;&gt;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  @include(&#x27;listitem&#x27;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;/div&gt;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;script&gt;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">var paging_listener = function () {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // 페이지 버튼에 click listener 등록</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  $(&#x27;.pagination a&#x27;).click(function (e) {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    // a href 로 페이지가 이동하는걸 방지한다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    e.preventDefault();</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    get_list($(this).attr(&#x27;href&#x27;));</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  });</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">};</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">var get_list = function (url) {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  $.get(url)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  .then(function(html) {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    $(&#x27;#list&#x27;).html(html);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    // 페이지가 다시 그려졌으므로 listener를 다시 등록한다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    paging_listener();</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  });</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">};</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$(function () {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  paging_listener();</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">});</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;/script&gt;</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_PC_Z" id="listitem-view">ListItem view<a href="#listitem-view" class="hash-link" aria-label="ListItem view에 대한 직접 링크" title="ListItem view에 대한 직접 링크">​</a></h3>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_nMmE">listitem.blade.php</div><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;ul&gt;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">@foreach($data as $item)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &lt;li&gt;{{ $item-&gt;name }}&lt;/li&gt;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">@endforeach</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;/ul&gt;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// pagination html이 반환되어 자동으로 보여진다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">{{ $data-&gt;links() }}</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="multiple-pagination">multiple pagination<a href="#multiple-pagination" class="hash-link" aria-label="multiple pagination에 대한 직접 링크" title="multiple pagination에 대한 직접 링크">​</a></h2>
<p>한 페이지에 여러 리스트가 있는 경우가 종종 있다. 먼저 <a href="https://github.com/laravel/framework/blob/5.4/src/Illuminate/Database/Query/Builder.php#L1723" target="_blank" rel="noopener noreferrer">paginate 메소드</a>를 살펴보자.</p>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">* Paginate the given query into a simple paginator.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">*</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">* @param  int  $perPage</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">* @param  array  $columns</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">* @param  string  $pageName</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">* @param  int|null  $page</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">* @return \Illuminate\Contracts\Pagination\LengthAwarePaginator</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">*/</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">public function paginate($perPage = 15, $columns = [&#x27;*&#x27;], $pageName = &#x27;page&#x27;, $page = null)</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><strong>perPage</strong>: 한 페이지에 표시될 Item 수</li>
<li><strong>columns</strong>: 가져올 컬럼명의 배열</li>
<li><strong>pageName</strong>: page 변수명 (예를들면 /boards?page=1 에서 page 변수명을 변경 가능)</li>
<li><strong>page</strong>: 가져올  페이지</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_PC_Z" id="controller-1">Controller<a href="#controller-1" class="hash-link" aria-label="Controller에 대한 직접 링크" title="Controller에 대한 직접 링크">​</a></h3>
<p>Controller에서 paginate 메소드를 활용해보자.</p>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_nMmE">YourController.php</div><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">public function list(Request $request) {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  if ($request-&gt;ajax()) {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    // list1_page 값이 들어올 경우</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    if ($request-&gt;has(&#x27;list1_page&#x27;)) {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        // list1_item 뷰에 바인딩해준다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      return view(&#x27;list1_item&#x27;, [</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        &#x27;data1&#x27; =&gt; $this-&gt;get_list1()</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      ]);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    } else if ($request-&gt;has(&#x27;list2_page&#x27;)) {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      return view(&#x27;list2_item&#x27;, [</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        &#x27;data2&#x27; =&gt; $this-&gt;get_list2()</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      ]);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // 메인 요청</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  $data1 = $this-&gt;get_list1();</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  $data2 = $this-&gt;get_list2();</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  return view(&#x27;list&#x27;, [</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &#x27;data1&#x27; =&gt; $data1,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &#x27;data2&#x27; =&gt; $data2</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  ]);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">protected function get_list1() {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  return Model::where()-&gt;orderBy()-&gt;paginate(5, [&#x27;*&#x27;], &#x27;list1_page&#x27;);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">protected function get_list2() {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  return Model::where()-&gt;paginate(10, [&#x27;*&#x27;], &#x27;list2_page&#x27;);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_PC_Z" id="list-view-1">List view<a href="#list-view-1" class="hash-link" aria-label="List view에 대한 직접 링크" title="List view에 대한 직접 링크">​</a></h3>
<p>위의 script에서 조금만 수정해주면 된다.
(list item view는 위와 동일한 코드의 반복이므로 생략)</p>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_nMmE">list.blade.php</div><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;div id=&quot;list1&quot;&gt;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  @include(&#x27;list1_item&#x27;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;/div&gt;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;div id=&quot;list2&quot;&gt;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  @include(&#x27;list2_item&#x27;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;/div&gt;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;script&gt;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">var paging_listener = function () {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  $(&#x27;.pagination a&#x27;).click(function (e) {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    e.preventDefault();</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    var page = $(this).attr(&#x27;href&#x27;).split(&#x27;?&#x27;)[1];</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    // page.split(&#x27;=&#x27;)[0]은 페이지 변수명을 가져온다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    var paging_type = page.split(&#x27;=&#x27;)[0] === &#x27;list1_page&#x27;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                      ? &#x27;list1&#x27;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                      : &#x27;list2&#x27;;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    get_list($(this).attr(&#x27;href&#x27;), paging_type);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  });</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">};</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">var get_list = function (url, target) {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  $.get(url)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  .then(function(html) {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    $(`#${target}`).html(html);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    paging_listener();</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  });</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">};</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;/script&gt;</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h1>여담</h1>
<p>이제 DB에서 데이터를 가져오는 것까지 끝났다.
<a href="/2017/07/09/Laravel-5-4-Login-with-Auth/">다음 포스팅</a>에서는 User Login을 구현해보자.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>태그:</b><ul class="tags_GTCL padding--none margin-left--sm"><li class="tag_IZrL"><a class="tag_alSi tagRegular_w1M4" href="/tags/php/">php</a></li><li class="tag_IZrL"><a class="tag_alSi tagRegular_w1M4" href="/tags/laravel/">laravel</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="컴포저로 패키지를 다운 받은 후에 갑자기 오류가 나면서 다른 설치조차 안되는 경우가 있다."><header><h2 class="title_CSpS" itemprop="headline"><a itemprop="url" href="/2017/05/24/composer-zlib-decode와-content-length-mismatch-오류/">composer zlib_decode와 content-length mismatch 오류</a></h2><div class="container_jZh9 margin-vert--md"><time datetime="2017-05-24T22:14:22.000Z" itemprop="datePublished">2017년 5월 24일</time> · <!-- -->약 3분</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_BNjk"><div class="avatar margin-bottom--sm"><a href="https://github.com/gracefullight" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/11773683?v=4" alt="Eunkwang Shin" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/gracefullight" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Eunkwang Shin</span></a></div><small class="avatar__subtitle" itemprop="description">Owner</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>컴포저로 패키지를 다운 받은 후에 갑자기 오류가 나면서 다른 설치조차 안되는 경우가 있다.
오류 메세지는 아래 두 경우로 나타난다.</p>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="zlib_decode">zlib_decode<a href="#zlib_decode" class="hash-link" aria-label="zlib_decode에 대한 직접 링크" title="zlib_decode에 대한 직접 링크">​</a></h2>
<p>json 파일 디코딩이 실패했다는 오류이다.</p>
<div class="language-bash codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-bash codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">Failed to decode response: zlib_decode(): data error</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Retrying with degraded mode, check https://getcomposer.org/doc/articles/troubleshooting.md#degraded-mode for more info</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">[ErrorException]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">zlib_decode(): data error</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>위의 링크를 따라가 보면 해결책으로 다음과 같이 제시가 되는데
ESET antivirus는 아직 국내에서 쓰는 사람을 못 봤고, IPv6을 막아도 그대로일 것이다.</p>
<ul>
<li>If you are using ESET antivirus, go in &quot;Advanced Settings&quot; and disable &quot;HTTP-scanner&quot; under &quot;web access protection&quot;</li>
<li>If you are using IPv6, try disabling it. If that solves your issues, get in touch with your ISP or server host, the problem is not at the Packagist level but in the routing rules between you and Packagist (i.e. the internet at large). The best way to get these fixed is raise awareness to the network engineers that have the power to fix it. Take a look at the next section for IPv6 workarounds.</li>
<li>If none of the above helped, please report the error.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="content-length-mismatch">content-length mismatch<a href="#content-length-mismatch" class="hash-link" aria-label="content-length mismatch에 대한 직접 링크" title="content-length mismatch에 대한 직접 링크">​</a></h2>
<p>composer의 패키지 list를 가지고 있는 json파일이 다 안받아졌다는 내용의 오류이다.</p>
<div class="language-bash codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-bash codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">[Composer\Downloader\TransportException]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Content-Length mismatch</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h1>해결</h1>
<p>구글링 해보면 clear-cache를 한 뒤에 composer -vvv 명령어를 사용해 디버깅 로그를 확인해보라는 내용이 주류인데 별 도움은 안 된다.
http 연결이아닌 https로 packagist에 붙어보라는 것도 해결되지 않았다.</p>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="packagist-repository-변경">packagist repository 변경<a href="#packagist-repository-변경" class="hash-link" aria-label="packagist repository 변경에 대한 직접 링크" title="packagist repository 변경에 대한 직접 링크">​</a></h2>
<p>packagist는 유럽에 있어서 한국에서 유럽까지 갔다가 다시 돌아오는 구조라,
<a href="https://packagist.jp/" target="_blank" rel="noopener noreferrer">packagist 일본 미러</a>를 이용하면 이 문제가 해결된다.</p>
<div class="language-bash codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-bash codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 이 명령어로 global config에 repos.packagist 를 추가한다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ composer config -g repos.packagist composer https://packagist.jp</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 설정이 되었는지 확인한다..</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ composer config -gl|grep repo</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 아래 설정이 보이면 추가가 된 것이다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">[repositories.packagist.org.type] composer</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">[repositories.packagist.org.url] https://packagist.jp</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="캐시-제거">캐시 제거<a href="#캐시-제거" class="hash-link" aria-label="캐시 제거에 대한 직접 링크" title="캐시 제거에 대한 직접 링크">​</a></h2>
<div class="language-bash codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-bash codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ composer global clear-cache</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ composer clear-cache</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>이제 다시 패키지를 설치하면 설치가 될 것이다.</p>
<h1>다운로드 속도 향상</h1>
<p>병렬 다운로드를 가능하게 하는 <a href="https://github.com/hirak/prestissimo" target="_blank" rel="noopener noreferrer">hirak/prestissimo</a> 패키지를 설치하자.
288s -&gt; 26s 가 되는 마법이 일어난다고 한다.</p>
<div class="language-bash codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-bash codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ composer global require hirak/prestissimo</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>태그:</b><ul class="tags_GTCL padding--none margin-left--sm"><li class="tag_IZrL"><a class="tag_alSi tagRegular_w1M4" href="/tags/php/">php</a></li><li class="tag_IZrL"><a class="tag_alSi tagRegular_w1M4" href="/tags/composer/">composer</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="image from hexo"><header><h2 class="title_CSpS" itemprop="headline"><a itemprop="url" href="/2017/05/16/Laravel-5-4-Start/">Laravel 5.5 - 시작하기</a></h2><div class="container_jZh9 margin-vert--md"><time datetime="2017-05-16T22:34:39.000Z" itemprop="datePublished">2017년 5월 16일</time> · <!-- -->약 11분</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_BNjk"><div class="avatar margin-bottom--sm"><a href="https://github.com/gracefullight" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/11773683?v=4" alt="Eunkwang Shin" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/gracefullight" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Eunkwang Shin</span></a></div><small class="avatar__subtitle" itemprop="description">Owner</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><img loading="lazy" src="https://i.imgur.com/TuwFZD4.png" alt="image from hexo" class="img_waBy"></p>
<p>1등이 된지가 14년 7월이다. 이 글은 17년 글이다.
다른 장점이 궁금하다면 다른 포스트나 stackoverflow에서 해결해줄 것 같다.</p>
<p>이 글을 읽어주시는 분들은 <strong>Modern PHP에 대해 이해</strong>하고 있다고 생각했기 떄문에 문법적인 것들은 설명하지 않을 것이다.
<em>더군다나 라라벨을 도입하면서 삽질한 내용을 정리하고 있기에, 입문용은 절대 아니다.</em>
기본적으로 아래와 같은 PHP 개념을 알고 있어야한다.</p>
<ul>
<li>PSR</li>
<li>Composer</li>
<li>Class</li>
<li>Namespace</li>
<li>Closure</li>
<li>Trait</li>
<li>PDO</li>
</ul>
<p>추가적으로 이런 걸 사용해 봤다면 더 쉬울 듯하다.</p>
<ul>
<li>Monolog</li>
<li>다른 MVC 프레임워크</li>
<li>Lodash</li>
</ul>
<h1>설치</h1>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="php">PHP<a href="#php" class="hash-link" aria-label="PHP에 대한 직접 링크" title="PHP에 대한 직접 링크">​</a></h2>
<p>PHP 7 이상을 설치해주고, 아래 Extension은 웬만하면 열어주는 것들이니 크게 신경쓰지 말자.</p>
<ul>
<li>PHP &gt;= 7.0.0</li>
<li>OpenSSL PHP Extension</li>
<li>PDO PHP Extension</li>
<li>Mbstring PHP Extension</li>
<li>Tokenizer PHP Extension</li>
<li>XML PHP Extension</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="composer">Composer<a href="#composer" class="hash-link" aria-label="Composer에 대한 직접 링크" title="Composer에 대한 직접 링크">​</a></h2>
<p><a href="https://getcomposer.org/download/" target="_blank" rel="noopener noreferrer">Composer 홈페이지</a>에서 다운받고 전역설정만 해주면 된다.</p>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="laravel-cli">Laravel Cli<a href="#laravel-cli" class="hash-link" aria-label="Laravel Cli에 대한 직접 링크" title="Laravel Cli에 대한 직접 링크">​</a></h2>
<p>Laravel 명령어를 사용할 수 있게 composer로 전역 설치하자.</p>
<div class="language-bash codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-bash codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">composer global require &quot;laravel/installer&quot;</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h1>프로젝트 생성</h1>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="초기-생성">초기 생성<a href="#초기-생성" class="hash-link" aria-label="초기 생성에 대한 직접 링크" title="초기 생성에 대한 직접 링크">​</a></h2>
<div class="language-bash codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-bash codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">laravel new 프로젝트명</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>위 명령어를 실행하면, 알아서 composer 패키지까지 설치된다.</p>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="clone-했을-때">clone 했을 때<a href="#clone-했을-때" class="hash-link" aria-label="clone 했을 때에 대한 직접 링크" title="clone 했을 때에 대한 직접 링크">​</a></h2>
<p>환경 설정 파일과 프로젝트 키가 없으므로 적절하게 세팅해줘야한다.</p>
<div class="language-bash codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-bash codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 패키지 의존성 설치</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ composer install</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># .env 파일 복사 (설정파일 생성)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># post-root-package-install scripts로 들어가 있긴한데, 복사가 안 되는 경우</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ cp .env.example .env</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 프로젝트 키 생성</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ php artisan key:generate</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="실행">실행<a href="#실행" class="hash-link" aria-label="실행에 대한 직접 링크" title="실행에 대한 직접 링크">​</a></h2>
<p>프로젝트를 실행해보자.</p>
<div class="language-bash codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-bash codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">php artisan serve</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>이제 localhost:8000으로 라라벨 프로젝트에 접근이 가능하다.</p>
<blockquote>
<p>php artisan 명령어는 laravel에서 사용하는 커맨드 쉘이다.
<strong>php artisan</strong>로 명령어 리스트가 나오고 <strong>php artisan help 명령어</strong> 로 해당 명령어의 옵션을 볼 수 있다.</p>
</blockquote>
<h1>프로젝트 구조</h1>
<p><a href="https://laravel.kr/docs/5.4/structure" target="_blank" rel="noopener noreferrer">라라벨 한글 메뉴얼</a>이 나 <a href="https://laravel.com/docs/5.4/structure" target="_blank" rel="noopener noreferrer">공식 메뉴얼</a>을 보면 되는데 마치 사전을 펴놓았는데 어떤 단어를 찾는지 까먹은 느낌이 들 것이다.</p>
<p>모든 프레임워크는 Model, View, Controller, Routing만 알면 끝이라는 것을 잠시 기억 속에서 꺼내보고 <strong>딱 3가지 경로만 기억</strong>하자.</p>
<ul>
<li><strong>Route</strong>: routes/</li>
<li><strong>Controller</strong>: app/Http/Controllers/</li>
<li><strong>View</strong> : resources/views/</li>
</ul>
<blockquote>
<p>모델은 어딨어? 라고 생각할 것 같은데 Model을 완벽하게 사용하려면 ORM을 써야하고 DB를 ORM에 맞게 정규화해야하며 이 작업은 처음 진행하기에 고통스럽다.
다음 포스트에 진행해보자.</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="route">Route<a href="#route" class="hash-link" aria-label="Route에 대한 직접 링크" title="Route에 대한 직접 링크">​</a></h2>
<p>모든 웹 프레임워크의 기본은 Routing이다.
routes 폴더에 기본으로 api, channels, console, web 파일이 보이는데 그 중 2가지만 알면 된다.</p>
<ul>
<li>api.php: Token 인증이 필요한 라우터로 <code>/api/{route}</code> 로 접근이 가능하다.</li>
<li>web.php: 기본적인 Route이다. GET이 아닌 다른 메소드는 CSRF Token이 있어야만 호출이 가능하다.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="controller">Controller<a href="#controller" class="hash-link" aria-label="Controller에 대한 직접 링크" title="Controller에 대한 직접 링크">​</a></h2>
<p>Routing 요청을 처리하는 로직이 들어있는 부분이다.</p>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="view">View<a href="#view" class="hash-link" aria-label="View에 대한 직접 링크" title="View에 대한 직접 링크">​</a></h2>
<p>Controller에서 처리된 데이터를 플랫폼에 보여주는 부분이다.</p>
<h1>프로젝트 세팅</h1>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="app-설정">App 설정<a href="#app-설정" class="hash-link" aria-label="App 설정에 대한 직접 링크" title="App 설정에 대한 직접 링크">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_PC_Z" id="env-파일">env 파일<a href="#env-파일" class="hash-link" aria-label="env 파일에 대한 직접 링크" title="env 파일에 대한 직접 링크">​</a></h3>
<p>.env 파일에서 APP_NAME과 DB로 시작하는 설정을 바꿔준다.</p>
<h3 class="anchor anchorWithStickyNavbar_PC_Z" id="app-파일">app 파일<a href="#app-파일" class="hash-link" aria-label="app 파일에 대한 직접 링크" title="app 파일에 대한 직접 링크">​</a></h3>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_nMmE">config/app.php</div><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">return [</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // 시간대 세팅을 한다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &#x27;timezone&#x27; =&gt; &#x27;Asia/Seoul&#x27;,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // 언어 설정을 한다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // fallback_locale은 언어팩이있어야 하므로 아래에서 진행할 laravel-lang 설치 후 바꿔주자.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &#x27;locale&#x27; =&gt; &#x27;ko&#x27;,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">]</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_PC_Z" id="database-파일">database 파일<a href="#database-파일" class="hash-link" aria-label="database 파일에 대한 직접 링크" title="database 파일에 대한 직접 링크">​</a></h3>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_nMmE">config/database.php</div><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">return [</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &#x27;connections&#x27; =&gt; [</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &#x27;mysql&#x27; =&gt; [</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      // mysql일 경우 utf8로 설정해준다 (maria는 utf8mb4)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      // DB 설정과  다르게 Model 이용시 charset 및 collation이 지정되어 들어가기에 꼭 설정해줘야한다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &#x27;charset&#x27; =&gt; &#x27;utf8&#x27;,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &#x27;collation&#x27; =&gt; &#x27;utf8_general_ci&#x27;,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      // 내 테이블의 접두사가 필요하다면 여기서 설정한다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      // 예를들어 test_member, test_product 이런식의 테이블 명명규칙이라면 아래처럼 주면된다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &#x27;prefix&#x27; =&gt; &#x27;test_&#x27;,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      // engine 옵션은 my.ini에서 만져주자..</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &#x27;engine&#x27; =&gt; null,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">];</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>config 내의 파일과 .env파일을 건드릴 경우 laravel 환경을 다시 캐싱해주거나 아예 삭제해야 적용이 된다.
<strong>php artisan config<!-- -->:cache</strong> 명령어 또는 <strong>php artisan config<!-- -->:clear</strong> 명령어를 실행해주자.</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="debug-bar">Debug Bar<a href="#debug-bar" class="hash-link" aria-label="Debug Bar에 대한 직접 링크" title="Debug Bar에 대한 직접 링크">​</a></h2>
<p>정말 멋진 디버깅 툴이다.
간단히 설치 후에 .env 파일의 <strong>APP_DEBUG</strong> 옵션이 true이면 자동으로 View 하단에 생성된다.
아래와 같은 데이터를 확인할 수 있다.</p>
<ul>
<li>로그 내역</li>
<li>뷰 데이터 바인딩 확인</li>
<li>오류</li>
<li>라우팅</li>
<li>쿼리 실행</li>
<li>메일 발송 데이터</li>
<li>실행 시간</li>
<li>Request</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_PC_Z" id="설치-1">설치<a href="#설치-1" class="hash-link" aria-label="설치에 대한 직접 링크" title="설치에 대한 직접 링크">​</a></h3>
<div class="language-bash codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-bash codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">composer require barryvdh/laravel-debugbar</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="laravel-lang">laravel-lang<a href="#laravel-lang" class="hash-link" aria-label="laravel-lang에 대한 직접 링크" title="laravel-lang에 대한 직접 링크">​</a></h2>
<p>기본 오류 메세지들의 localization 패키지이다.</p>
<h3 class="anchor anchorWithStickyNavbar_PC_Z" id="설치-2">설치<a href="#설치-2" class="hash-link" aria-label="설치에 대한 직접 링크" title="설치에 대한 직접 링크">​</a></h3>
<div class="language-bash codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-bash codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">composer require caouecs/laravel-lang:~3.0</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_PC_Z" id="적용">적용<a href="#적용" class="hash-link" aria-label="적용에 대한 직접 링크" title="적용에 대한 직접 링크">​</a></h3>
<p><code>vendor/caouecs/laravel-lang/src/{국가}</code> 폴더를
<code>resources/lang/{국가}</code> 로 복사하고 <strong>config/app.php</strong> 의 <strong>fallback_locale</strong>을 <code>{국가}</code>로 바꿔주면 된다.</p>
<div class="language-bash codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-bash codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 귀찮으니 git bash에서 날려봅시다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ cp -r ./vendor/caouecs/laravel-lang/src/ko ./resources/lang/ko</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h1>라우팅</h1>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_nMmE">routes/web.php</div><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// url 변수</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Route::get(&#x27;/your_url/{id}&#x27;, function($id) {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  return $id;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">});</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Route::get(&#x27;/your_url/{id?}&#x27;, function($id = null) {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  return $id;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">});</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h1>컨트롤러</h1>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="생성">생성<a href="#생성" class="hash-link" aria-label="생성에 대한 직접 링크" title="생성에 대한 직접 링크">​</a></h2>
<p>artisan 명령어로 간단히 생성할 수 있다.</p>
<div class="language-bash codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-bash codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain"># make:controller 폴더명/컨트롤러명</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ php artisan make:controller TestController</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 리소스 메소드를 같이 생성</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ php artisan make:controller TestController --resource</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="연결">연결<a href="#연결" class="hash-link" aria-label="연결에 대한 직접 링크" title="연결에 대한 직접 링크">​</a></h2>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_nMmE">routes/web.php</div><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// 컨트롤러명@메소드명 으로 바로 연결시킬 수 있다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Route::get(&#x27;/url/{id}&#x27;, &#x27;TestController@get&#x27;);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Route::post(&#x27;/url&#x27;, &#x27;TestContoller@post&#x27;);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// CRUD가 명확한 컨트롤러인 경우 Resource를 사용하는 게 편할 수 있다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Route::resource(&#x27;tests&#x27;, &#x27;TestController&#x27;);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// only 또는 except로 원하는 resource만 가져갈 수 있다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Route::resource(&#x27;tests&#x27;, &#x27;TestController&#x27;, [</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &#x27;only&#x27; =&gt; [</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &#x27;index&#x27;, &#x27;show&#x27;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">]);</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_nMmE">app/Http/Controllers/TestController.php</div><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">use Illuminate\Http\Request;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">class TestController extends Controller{</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  public function get($id){</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    // 뷰를 호출</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    return view(&#x27;test.detail&#x27;, [</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &#x27;data&#x27; =&gt; $data</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    ]);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  public function post(Request $request, $id){</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    // Request 데이터를 제어할 수 있다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    $input = $request-&gt;all();</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    $name = $request-&gt;input(&#x27;name&#x27;);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    $data = [];</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    // json body와 201 http code를 반환</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    return response()-&gt;json([</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &#x27;data&#x27; =&gt; $data</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    ], 201);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_PC_Z" id="resource">Resource<a href="#resource" class="hash-link" aria-label="Resource에 대한 직접 링크" title="Resource에 대한 직접 링크">​</a></h3>
<p>리소스 사용시라면 아래와 같은 메소드로 구성되어야한다.
게시판 컨트롤러라면 아래와 같은 구성일 것이다.</p>
<table><thead><tr><th>메소드</th><th>경로</th><th>액션</th><th>라우트.메소드</th></tr></thead><tbody><tr><td>GET</td><td>/boards</td><td>게시판 메인</td><td>boards.index</td></tr><tr><td>GET</td><td>/boards/create</td><td>게시글 생성페이지</td><td>boards.create</td></tr><tr><td>POST</td><td>/boards</td><td>게시글 저장</td><td>boards.store</td></tr><tr><td>GET</td><td><code>/boards/{id}</code></td><td>게시글 상세페이지</td><td>boards.show</td></tr><tr><td>GET</td><td><code>/boards/{id}/edit</code></td><td>게시글 수정페이지</td><td>boards.edit</td></tr><tr><td>PUT/PATCH</td><td><code>/boards/{id}</code></td><td>게시글 수정로직</td><td>boards.update</td></tr><tr><td>DELETE</td><td><code>/boards/{id}</code></td><td>게시글 삭제</td><td>boards.destroy</td></tr></tbody></table>
<h1>뷰</h1>
<p>블레이드 템플릿을 사용하며 <a href="https://laravel.com/docs/5.4/blade#control-structures" target="_blank" rel="noopener noreferrer">홈페이지</a> 설명이 꽤나 자세하다.
당장 알아야 할건 아래 두 개 정도 뿐이다. 나머지는 그때 그때 문서를 참조하자.</p>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_nMmE">resources/views/test/detail.blade.php</div><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">// 바인딩 한 데이터를 {{ }} 구문으로 바로 접근할 수 있다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">{{ $data-&gt;name }}님의 정보입니다.</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_nMmE">resources/views/test/create.blade.php</div><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">// post로 전송시</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;form method=&quot;post&quot; url=&quot;/url&quot;&gt;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // post로 데이터를 전송시 csrf 토큰이 필요하다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // 이 헬퍼함수를 호출하면 자동으로 토큰 값이 들어간 input hidden 필드가 생성된다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  {{ csrf_field() }}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  이름: &lt;input type=&quot;text&quot; name=&quot;name&quot; vavlue=&quot;&quot;&gt;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;/form&gt;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// 기타 메소드로 전송시</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;form method=&quot;post&quot; url=&quot;/url&quot;&gt;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  {{ crsf_field() }}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // PUT, PATCH, DELETE 와 같은 메소드로 전송시 form 태그에서는 지원을 해주지 않으므로 method spoofing이 필요하다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // 이 헬퍼함수를 호출하면 해결된다.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  {{ method_field(&#x27;PUT&#x27;)}}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;/form&gt;</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h1>여담</h1>
<p>이제 라라벨을 이용해 데이터를 서버에 보내고 뷰를 구성할 수 있게 되었다.
<a href="/2017/06/06/Laravel-5-4-Eloquent-Model/">다음 포스팅</a>에서는 DB 연동과 ORM 모델을 사용해 데이터를 가져오고 페이징 처리를 해보자.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>태그:</b><ul class="tags_GTCL padding--none margin-left--sm"><li class="tag_IZrL"><a class="tag_alSi tagRegular_w1M4" href="/tags/php/">php</a></li><li class="tag_IZrL"><a class="tag_alSi tagRegular_w1M4" href="/tags/laravel/">laravel</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="PHP 로 페이지를 크롤링한 후 HTML tag 안의 데이터가 필요할 때 함수 하나로 해결할 수 있다."><header><h2 class="title_CSpS" itemprop="headline"><a itemprop="url" href="/2017/02/13/php-get-text-between-tags/">PHP에서 HTML tag 사이의 문자 가져오기</a></h2><div class="container_jZh9 margin-vert--md"><time datetime="2017-02-13T15:00:14.000Z" itemprop="datePublished">2017년 2월 13일</time> · <!-- -->약 2분</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_BNjk"><div class="avatar margin-bottom--sm"><a href="https://github.com/gracefullight" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/11773683?v=4" alt="Eunkwang Shin" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/gracefullight" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Eunkwang Shin</span></a></div><small class="avatar__subtitle" itemprop="description">Owner</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>PHP 로 페이지를 크롤링한 후 HTML tag 안의 데이터가 필요할 때 함수 하나로 해결할 수 있다.</p>
<div class="language-php codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-php codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> * [splitBetweenStr 텍스트 사이의 문자열을 배열로 반환]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> * @param  [string] $str        [전체 문자열]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> * @param  [string] $startWord  [찾을 시작 문자열]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> * @param  [string] $endWord    [찾을 종료 문자열]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> * @return [array]              [텍스트 사이의 문자열 배열]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> * ex) splitBetweenStr(&#x27;&lt;br&gt;hi&lt;/br&gt;&lt;b&gt;test&lt;/b&gt;&lt;br&gt;graceful_light&lt;/br&gt;&#x27;, &#x27;&lt;br&gt;&#x27;, &#x27;&lt;/br&gt;&#x27;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> *     =&gt; [&#x27;hi&#x27;, &#x27;graceful_light&#x27;]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">function splitBetweenStr($str, $startWord, $endWord) {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  for ($i=0, $len=strlen($str); $i&lt;$len; $i++) {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    $target = substr($str,$i);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    $prevStartIdx = strpos($target, $startWord);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    $startIdx = $prevStartIdx + strlen($startWord);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    $endIdx = strpos(substr($target, $startIdx), $endWord);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    if ($prevStartIdx===false || $endIdx===false) {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      break;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    } else {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      $betweenStrings[] = substr($target, $startIdx, $endIdx);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      $i += $startIdx + $endIdx + strlen($endWord) - 1;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  return $betweenStrings;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에   코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h1>여담</h1>
<p>물론 <a href="https://packagist.org/search/?q=crawl&amp;orderBys%5B0%5D%5Bsort%5D=downloads&amp;orderBys%5B0%5D%5Border%5D=desc" target="_blank" rel="noopener noreferrer">다른 크롤러 라이브러리</a>를 사용하는게 속편하다.
호스팅 환경에서는 유용하게 사용할 수 있다.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>태그:</b><ul class="tags_GTCL padding--none margin-left--sm"><li class="tag_IZrL"><a class="tag_alSi tagRegular_w1M4" href="/tags/php/">php</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="window localhost php 에서 cURL 함수 사용시"><header><h2 class="title_CSpS" itemprop="headline"><a itemprop="url" href="/2017/02/02/cURL-SSL-certificate-problem/">cURL error 60 SSL certificate problem</a></h2><div class="container_jZh9 margin-vert--md"><time datetime="2017-02-02T23:50:09.000Z" itemprop="datePublished">2017년 2월 2일</time> · <!-- -->약 1분</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_BNjk"><div class="avatar margin-bottom--sm"><a href="https://github.com/gracefullight" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/11773683?v=4" alt="Eunkwang Shin" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/gracefullight" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Eunkwang Shin</span></a></div><small class="avatar__subtitle" itemprop="description">Owner</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>window localhost php 에서 cURL 함수 사용시
cURL error 60: SSL certificate problem...으로 시작하는 오류가 발생할 때가 있다.</p>
<p><img loading="lazy" src="https://i.imgur.com/u6XZCfz.png" alt="image from hexo" class="img_waBy"></p>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="키-다운로드">키 다운로드<a href="#키-다운로드" class="hash-link" aria-label="키 다운로드에 대한 직접 링크" title="키 다운로드에 대한 직접 링크">​</a></h2>
<p><a href="https://curl.haxx.se/ca/cacert.pem" target="_blank" rel="noopener noreferrer">root certificate bundle</a>을 다운로드 받아 php 하위 경로로 넣어준다.</p>
<h2 class="anchor anchorWithStickyNavbar_PC_Z" id="등록">등록<a href="#등록" class="hash-link" aria-label="등록에 대한 직접 링크" title="등록에 대한 직접 링크">​</a></h2>
<p><strong>php.ini</strong>에서 키를 추가한다.</p>
<div class="language-ini codeBlockContainer_ypMI theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_nMmE">php.ini</div><div class="codeBlockContent_aVD_"><pre tabindex="0" class="prism-code language-ini codeBlock_ydjN thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_GlDW"><span class="token-line" style="color:#9CDCFE"><span class="token plain">[curl]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">; A default value for the CURLOPT_CAINFO option. This is required to be an</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">; absolute path.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">curl.cainfo = D:/php7/extras/ssl/cacert.pem</span><br></span></code></pre><div class="buttonGroup_zJhC"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_yZd6" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_DCmi"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_hNCt"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h1>참조</h1>
<ul>
<li><a href="http://stackoverflow.com/questions/21114371/php-curl-error-code-60" target="_blank" rel="noopener noreferrer">PHP cURL error code 60</a></li>
</ul></div><footer class="row docusaurus-mt-lg"><div class="col"><b>태그:</b><ul class="tags_GTCL padding--none margin-left--sm"><li class="tag_IZrL"><a class="tag_alSi tagRegular_w1M4" href="/tags/php/">php</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="블로그 게시물 목록 탐색"><a class="pagination-nav__link pagination-nav__link--prev" href="/tags/php/page/2/"><div class="pagination-nav__label">이전 페이지</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/tags/php/page/4/"><div class="pagination-nav__label">다음 페이지</div></a></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Support Me</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.buymeacoffee.com/LOUB2kN" target="_blank" rel="noopener noreferrer" style="cursor: pointer;">
                <img src="https://www.buymeacoffee.com/assets/img/custom_images/orange_img.png" style="height: auto !important;width: auto !important;">
              </a></li></ul></div><div class="col footer__col"><div class="footer__title">Feeds</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://gracefullight.dev/rss.xml" target="_blank" rel="noopener noreferrer" class="footer__link-item">RSS<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Fakl"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://gracefullight.dev/atom.xml" target="_blank" rel="noopener noreferrer" class="footer__link-item">Atom<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Fakl"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Eunkwang Shin.</div></div></div></footer></div>
</body>
</html>