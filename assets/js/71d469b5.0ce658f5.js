"use strict";(self.webpackChunkgracefullight_github_io=self.webpackChunkgracefullight_github_io||[]).push([[48631],{59754:(e,t,n)=>{n.d(t,{Zo:()=>m,kt:()=>d});var o=n(76687);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=o.createContext({}),p=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},m=function(e){var t=p(e.components);return o.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},u=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,s=e.parentName,m=i(e,["components","mdxType","originalType","parentName"]),u=p(n),d=r,k=u["".concat(s,".").concat(d)]||u[d]||c[d]||a;return n?o.createElement(k,l(l({ref:t},m),{},{components:n})):o.createElement(k,l({ref:t},m))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,l=new Array(a);l[0]=u;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:r,l[1]=i;for(var p=2;p<a;p++)l[p]=n[p];return o.createElement.apply(null,l)}return o.createElement.apply(null,n)}u.displayName="MDXCreateElement"},18757:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>c,frontMatter:()=>a,metadata:()=>i,toc:()=>p});var o=n(96428),r=(n(76687),n(59754));const a={title:"AWS CodeCommit \uc0ac\uc6a9\ud558\uae30",authors:"me",tags:["server","aws","git"],date:new Date("2017-08-18T22:34:22.000Z")},l=void 0,i={permalink:"/2017/08/18/AWS-CodeCommit-\uc0ac\uc6a9\ud558\uae30",source:"@site/blog/2017/08/18/AWS-CodeCommit-\uc0ac\uc6a9\ud558\uae30.md",title:"AWS CodeCommit \uc0ac\uc6a9\ud558\uae30",description:"AWS \uc5d0\uc11c \uc81c\uacf5\ud558\ub294 Cloud Git Repository \uc778 CodeCommit \uc73c\ub85c \uc18c\uc2a4\ucf54\ub4dc\ub97c \uad00\ub9ac\ud574\ubcf4\uc790.",date:"2017-08-18T22:34:22.000Z",formattedDate:"August 18, 2017",tags:[{label:"server",permalink:"/tags/server"},{label:"aws",permalink:"/tags/aws"},{label:"git",permalink:"/tags/git"}],readingTime:4.89,hasTruncateMarker:!1,authors:[{name:"Gracefullight",title:"Owner",url:"https://github.com/gracefullight",imageURL:"https://avatars.githubusercontent.com/u/11773683?v=4",key:"me"}],frontMatter:{title:"AWS CodeCommit \uc0ac\uc6a9\ud558\uae30",authors:"me",tags:["server","aws","git"],date:"2017-08-18T22:34:22.000Z"},prevItem:{title:"Cannot start container iptables failed",permalink:"/2017/08/19/Cannot-start-container-iptables-failed"},nextItem:{title:"Laravel 5.5 - Log Permission \ubb38\uc81c",permalink:"/2017/08/18/Laravel-5-4-Log-Permission-Denied"}},s={authorsImageUrls:[void 0]},p=[{value:"IAM \uc720\uc800 \uc0dd\uc131",id:"iam-\uc720\uc800-\uc0dd\uc131",level:2},{value:"\ud0a4 \ud30c\uc77c \uc5c5\ub85c\ub4dc",id:"\ud0a4-\ud30c\uc77c-\uc5c5\ub85c\ub4dc",level:2},{value:"config",id:"config",level:2},{value:"\ud14c\uc2a4\ud2b8",id:"\ud14c\uc2a4\ud2b8",level:2},{value:"ssh \uc5f0\ub3d9\uc774 \uc798 \ub418\uc9c0 \uc54a\uc744\uc2dc",id:"ssh-\uc5f0\ub3d9\uc774-\uc798-\ub418\uc9c0-\uc54a\uc744\uc2dc",level:2},{value:"Lambda",id:"lambda",level:2},{value:"\uc124\uc815",id:"\uc124\uc815-1",level:3},{value:"\uc18c\uc2a4",id:"\uc18c\uc2a4",level:3},{value:"\ub85c\uadf8",id:"\ub85c\uadf8",level:2}],m={toc:p};function c(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,o.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"AWS \uc5d0\uc11c \uc81c\uacf5\ud558\ub294 Cloud Git Repository \uc778 CodeCommit \uc73c\ub85c \uc18c\uc2a4\ucf54\ub4dc\ub97c \uad00\ub9ac\ud574\ubcf4\uc790."),(0,r.kt)("h1",{id:"\uc124\uc815"},"\uc124\uc815"),(0,r.kt)("p",null,"\uacf5\uc2dd \ubb38\uc11c\uac00 \uc544\uc8fc \uc798 \ub418\uc5b4\uc788\ub2e4. \ubb38\uc11c\ub97c \ubcf4\uace0 \uc2dc\uc791\ud574\ub3c4 \ub41c\ub2e4."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"http://docs.aws.amazon.com/ko_kr/codecommit/latest/userguide/setting-up-ssh-unixes.html"},"Mac")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"http://docs.aws.amazon.com/ko_kr/codecommit/latest/userguide/setting-up-ssh-windows.html"},"Windows"))),(0,r.kt)("h2",{id:"iam-\uc720\uc800-\uc0dd\uc131"},"IAM \uc720\uc800 \uc0dd\uc131"),(0,r.kt)("p",null,"IAM \uc5d0\uc11c \uc720\uc800\ub97c \ub9cc\ub4e0 \ub4a4\uc5d0 ",(0,r.kt)("strong",{parentName:"p"},"AWSCodeCommitFullAccess")," \uad8c\ud55c\uc744 \ucd94\uac00\ud55c\ub2e4."),(0,r.kt)("h2",{id:"\ud0a4-\ud30c\uc77c-\uc5c5\ub85c\ub4dc"},"\ud0a4 \ud30c\uc77c \uc5c5\ub85c\ub4dc"),(0,r.kt)("p",null,"ssh \ud0a4\ub97c \uc0dd\uc131\ud558\uace0 Public Key \ud30c\uc77c(id_rsa.pub)\uc744 \ud574\ub2f9 \uc720\uc800\uc758 ",(0,r.kt)("strong",{parentName:"p"},"Security credentials")," \uba54\ub274\uc5d0\uc11c \uc5c5\ub85c\ub4dc\ud55c\ub2e4.\n\ud0a4\uac00 \ub4f1\ub85d\ub418\uba74 ",(0,r.kt)("strong",{parentName:"p"},"SSH key ID"),"\uac00 \ubcf4\uc774\ub294\ub370 \uba54\ubaa8\ud574 \ub193\uc790."),(0,r.kt)("h2",{id:"config"},"config"),(0,r.kt)("p",null,"\uc0ac\uc6a9\ud560 \uc720\uc800\uc758 ssh config \ub97c \uc124\uc815\ud574\uc918\uc57c\ud55c\ub2e4.\nUser \uc5d0 \ub4e4\uc5b4\uac00\ub294 \uac12\uc740 \uc704\uc5d0\uc11c \uc801\uc5b4\ub193\uc740 ",(0,r.kt)("strong",{parentName:"p"},"SSH key ID")," \uac12\uc774\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ vi ~/.ssh/config\n\n# \uc544\ub798 \ub0b4\uc6a9\uc744 \ub9e8 \uc704\uc5d0 \ub123\uc5b4\uc8fc\uc790.\nHost git-codecommit.*.amazonaws.com\n  User EXAMPLEEXAMPLEEXAMPLE\n  IdentityFile ~/.ssh/id_rsa\n\n# \uc800\uc7a5\ud55c \ub4a4 \uad8c\ud55c\uc744 \ubc14\uafd4\uc900\ub2e4.\nchmod 600 ~/.ssh/config\n")),(0,r.kt)("h2",{id:"\ud14c\uc2a4\ud2b8"},"\ud14c\uc2a4\ud2b8"),(0,r.kt)("p",null,"\uc124\uc815\uc774 \uc644\ub8cc\ub41c \ud6c4\uc5d0 \uc11c\uc6b8\ub9ac\uc83c\uc73c\ub85c ssh \uc5f0\uacb0\uc744 \uc2dc\ub3c4\ud574\ubcf4\uc790."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ ssh git-codecommit.ap-northeast-2.amazonaws.com\n\n# \ub2e4\uc74c\uacfc \uac19\uc740 \uba54\uc138\uc9c0\uac00 \ub9ac\ud134\ub418\uba74 \uc131\uacf5\uc774\ub2e4.\nYou have successfully authenticated over SSH. You can use Git to interact with AWS CodeCommit. Interactive shells are not supported.Connection to git-codecommit.\nap-northeast-2.amazonaws.com closed by remote host.\nConnection to git-codecommit.ap-northeast-2.amazonaws.com closed.\n")),(0,r.kt)("h1",{id:"\uc5f0\ub3d9"},"\uc5f0\ub3d9"),(0,r.kt)("p",null,"\uc774\uc81c AWS CodeCommit \uacfc \ub0b4 \uc18c\uc2a4\ub97c \uc5f0\uacb0\uc2dc\ucf1c\ubcf4\uc790."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# \uc774\ubbf8 \uc874\uc7ac\ud558\ub294 \ud504\ub85c\uc81d\ud2b8\uc758 \uacbd\uc6b0\n$ git remote remove origin\n$ git remote add origin ssh://git-codecommit.ap-northeast-2.amazonaws.com/v1/repos/\ub808\ud30c\uc9c0\ud1a0\ub9ac\uba85\n\n# \ucc98\uc74c \uc2dc\uc791\ud558\ub294 \uacbd\uc6b0\n$ git clone ssh://git-codecommit.ap-northeast-2.amazonaws.com/v1/repos/\ub808\ud30c\uc9c0\ud1a0\ub9ac\uba85\n\n# \uad8c\ud55c\uc774 \uc5c6\uac70\ub098 ssh \uacc4\uc815\uc744 \ubb3c\uc5b4\ubcfc \ub54c\n# origin\uc758 path \uc55e\uc5d0 SSH key ID\ub97c \ucd94\uac00\ud558\uc790\n$ git remote add origin ssh://EXAMPLEEXAMPLEEXAMPLE@git-codecommit.ap-northeast-2.amazonaws.com/v1/repos/\ub808\ud30c\uc9c0\ud1a0\ub9ac\uba85\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"git pull origin master"),"\uc2dc\uc5d0 \uc815\uc0c1\uc801\uc73c\ub85c \uac00\uc838\uc624\ub294 \uac78 \ud655\uc778\ud560 \uc218 \uc788\ub2e4."),(0,r.kt)("h2",{id:"ssh-\uc5f0\ub3d9\uc774-\uc798-\ub418\uc9c0-\uc54a\uc744\uc2dc"},"ssh \uc5f0\ub3d9\uc774 \uc798 \ub418\uc9c0 \uc54a\uc744\uc2dc"),(0,r.kt)("p",null,"\uba54\ub274\uc5bc\ub300\ub85c \ub530\ub77c\ud574\ub3c4 \uc5f0\ub3d9\uc774 \uc548\ub420 \ub54c\ub294 \ub2f9\ud669\ud558\uc9c0 \ub9d0\uace0 ",(0,r.kt)("inlineCode",{parentName:"p"},"IAM > Users > Security credentials"),"\uc5d0\uc11c ",(0,r.kt)("inlineCode",{parentName:"p"},"HTTPS Git credentials for AWS CodeCommit"),"\ub97c \ub9cc\ub4e4\uc5b4\uc8fc\uace0 CodeCommit Repository \uc5f0\uacb0\uc744 ",(0,r.kt)("inlineCode",{parentName:"p"},"http"),"\ub85c \ud558\uba74 \ub41c\ub2e4."),(0,r.kt)("h1",{id:"webhook"},"Webhook"),(0,r.kt)("p",null,"Github, Bitbucket \uc640 \ub2ec\ub9ac Webhook \uc124\uc815\ud558\ub294 \ubc95\uc774 \uc870\uae08\uc740 \ubcf5\uc7a1\ud558\ub2e4. (GCP \uc758 Pub/Sub \uc640 \ube44\uc2b7\ud55c \ub290\ub08c)"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"CodeDeploy \uc11c\ube44\uc2a4\ub97c \uc0ac\uc6a9\ud558\uba74 \uc26c\uc6cc\uc9c8 \uac83 \uac19\uc740\ub370, \uadf8\ub7fc CodePipeline \ub3c4 \uc4f0\uace0 \uc2f6\uc744 \uac83 \uac19\uace0 CI \uc138\ud305\uc744 \ud574\uc57c\ub418\uace0 \ub2e4\uc74c \uae30\ud68c\uc5d0")),(0,r.kt)("h2",{id:"lambda"},"Lambda"),(0,r.kt)("p",null,"\ub78c\ub2e4\ub294 \uc6f9(URL)\uc73c\ub85c \ud638\ucd9c\ud560 \uc218 \uc788\ub294 Javascript function \uc774\ub2e4."),(0,r.kt)("h3",{id:"\uc124\uc815-1"},"\uc124\uc815"),(0,r.kt)("p",null,"\uba3c\uc800 ",(0,r.kt)("strong",{parentName:"p"},"Lambda > \ud568\uc218 > \ud568\uc218\uc0dd\uc131 > \uc0c8\ub85c \uc791\uc131")," \uba54\ub274\uc5d0\uc11c webhook \uc774\ub780 \uc774\ub984\uc758 \ud568\uc218\ub97c \uc0dd\uc131\ud55c\ub2e4.\n",(0,r.kt)("strong",{parentName:"p"},"\ud2b8\ub9ac\uac70 \uad6c\uc131")," \uba54\ub274\uc5d0\uc11c CodeCommit \uc744 \uc120\ud0dd\ud558\uace0 \uc785\ub825 \ud3fc\uc744 \uc798 \ucc44\uc6cc\uc8fc\uc790."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://i.imgur.com/qpDqsjv.png",alt:"image from hexo"})),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\uae30\uc874 \ube0c\ub79c\uce58\ub85c \ud478\uc2dc, master \ube0c\ub79c\uce58"),"\ub97c \uc120\ud0dd\ud588\ub2e4.\n",(0,r.kt)("strong",{parentName:"p"},"\uc0ac\uc6a9\uc790 \uc9c0\uc815\ub370\uc774\ud130"),"\uc5d0\ub294 webhook \uc744 \uac78 URL \uacbd\ub85c\ub97c \ub123\uc5b4\uc900\ub2e4. (\uc608: ",(0,r.kt)("a",{parentName:"p",href:"https://yourdomain.com/webhook"},"https://yourdomain.com/webhook"),")"),(0,r.kt)("h3",{id:"\uc18c\uc2a4"},"\uc18c\uc2a4"),(0,r.kt)("p",null,"\uc774\ubbf8 \uc138\ud305\ub41c ",(0,r.kt)("a",{parentName:"p",href:"https://gist.github.com/babelop/42e5580b7898719887516649b3053bc7"},"\ud568\uc218"),"\ub97c \uc0ac\uc6a9\ud558\uc790."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'"use strict";\n\nconst url = require("url");\nconst https = require("https");\n\nexports.handler = (event, context, callback) => {\n  let webhook_url = event.Records[0].customData;\n\n  if (!webhook_url) {\n    let error = new Error("Web-hook URL not provided as custom data.");\n    callback(error);\n  } else {\n    console.log("POST web-hook to " + webhook_url);\n    let options = url.parse(webhook_url);\n    options["method"] = "POST";\n\n    const req = https.request(options, (res) => {\n      let body = "";\n      console.log("Status:", res.statusCode);\n      console.log("Headers:", JSON.stringify(res.headers));\n      res.setEncoding("utf8");\n      res.on("data", (chunk) => (body += chunk));\n      res.on("end", () => {\n        console.log("Successfully triggered web-hook.");\n        // If we know it\'s JSON, parse it.\n        if (res.headers["content-type"] === "application/json") {\n          body = JSON.parse(body);\n        }\n        callback(null, body);\n      });\n    });\n\n    req.on("error", callback);\n    req.end();\n  }\n};\n')),(0,r.kt)("p",null,"https \ucee4\ub125\uc158\uc774 \uc544\ub2cc \uacbd\uc6b0 ",(0,r.kt)("inlineCode",{parentName:"p"},"http")," \ubaa8\ub4c8\uc744 \uc0ac\uc6a9\ud574\uc11c request \ub97c \ubcf4\ub0b4\uba74 \ub420 \uac83 \uac19\ub2e4."),(0,r.kt)("p",null,"\ub4f1\ub85d \ud6c4\uc5d4 ",(0,r.kt)("strong",{parentName:"p"},"CodeCommit > \ud2b8\ub9ac\uac70 > webhook > \ud2b8\ub9ac\uac70 \ud14c\uc2a4\ud2b8"),"\ub97c \uc9c4\ud589\ud558\uba74 \uc815\uc0c1\uc801\uc73c\ub85c \ud638\ucd9c\uc774 \ub41c\ub2e4."),(0,r.kt)("h2",{id:"\ub85c\uadf8"},"\ub85c\uadf8"),(0,r.kt)("p",null,"\ud638\ucd9c \ub85c\uadf8\ub294 ",(0,r.kt)("strong",{parentName:"p"},"CloudWatch > \ub85c\uadf8"),"\uc5d0\uc11c \uc0dd\uc131\ud55c Lambda \uba85\uc73c\ub85c \ud655\uc778\ud560 \uc218 \uc788\ub2e4."),(0,r.kt)("p",null,"\ub85c\uadf8 \uc2a4\ud2b8\ub9bc\uc774 \uc124\uc815\ub418\uc9c0 \uc54a\uc558\uc744 \uacbd\uc6b0\uc5d4 ",(0,r.kt)("strong",{parentName:"p"},"Lambda > \uad6c\uc131 > \uae30\uc874 \uc5ed\ud560"),"\uc5d0 \ud45c\uc2dc\ub41c \uc5ed\ud560(Rule)\uc774 \ud574\ub2f9 Lambda \ud568\uc218\ub97c \uc7a1\uace0 \uc788\ub294\uc9c0 \ud655\uc778\ud574\uc57c\ud55c\ub2e4.\n",(0,r.kt)("strong",{parentName:"p"},"IAM > Rules > \ud574\ub2f9 \ub8f0 > Permissions"),"\uc5d0\uc11c ",(0,r.kt)("strong",{parentName:"p"},"Show policy"),"\ub97c \ub204\ub974\uba74 ",(0,r.kt)("strong",{parentName:"p"},"Resource \uc18d\uc131"),"\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\uace0 \ub2e4\ub974\ub2e4\uba74 \uc81c\ub300\ub85c \uc5f0\uacb0\uc2dc\ucf1c\uc8fc\uba74 \ub41c\ub2e4."),(0,r.kt)("h1",{id:"\uc5ec\ub2f4"},"\uc5ec\ub2f4"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("a",{parentName:"p",href:"https://aws.amazon.com/ko/blogs/korea/week-in-review-28-08-17/"},"AWS Korea week in review"),"\uc5d0 \uc18c\uac1c\ub418\uc5c8\ub2e4.")))}c.isMDXComponent=!0}}]);