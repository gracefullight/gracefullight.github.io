"use strict";(self.webpackChunkgracefullight_github_io=self.webpackChunkgracefullight_github_io||[]).push([[20194],{96499:(e,n,l)=>{l.r(n),l.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>t,toc:()=>d});var s=l(11527),i=l(97793);const r={title:"\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub864\ub9c1 \uc5c5\ub370\uc774\ud2b8\uc640 \ubc30\ud3ec",authors:"me",tags:["k8s","docker"],date:new Date("2019-12-27T20:43:20.000Z")},a="Deployment",t={permalink:"/2019/12/27/kubernetes-rolling-update",source:"@site/blog/2019/12/27/kubernetes-rolling-update.md",title:"\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub864\ub9c1 \uc5c5\ub370\uc774\ud2b8\uc640 \ubc30\ud3ec",description:"Deployment \uc758 \ud30c\ub4dc \uad50\uccb4 \uc804\ub7b5\uc5d0\ub294 RollingUpdate \uc640 Recreate \uac00 \uc788\ub2e4.",date:"2019-12-27T20:43:20.000Z",formattedDate:"2019\ub144 12\uc6d4 27\uc77c",tags:[{label:"k8s",permalink:"/tags/k-8-s"},{label:"docker",permalink:"/tags/docker"}],readingTime:4.545,hasTruncateMarker:!1,authors:[{name:"Eunkwang Shin",title:"Owner",url:"https://github.com/gracefullight",imageURL:"https://avatars.githubusercontent.com/u/11773683?v=4",key:"me"}],frontMatter:{title:"\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub864\ub9c1 \uc5c5\ub370\uc774\ud2b8\uc640 \ubc30\ud3ec",authors:"me",tags:["k8s","docker"],date:"2019-12-27T20:43:20.000Z"},unlisted:!1,prevItem:{title:"\ub9e5 \ucd94\ucc9c \ud328\ud0a4\uc9c0",permalink:"/2019/12/29/mac-recommended-packages"},nextItem:{title:"Pythonic - \uae30\ubcf8\uae30",permalink:"/2019/12/15/Pythonic-the-basics"}},c={authorsImageUrls:[void 0]},d=[{value:"RollingUpdate",id:"rollingupdate",level:2},{value:"maxUnavailable",id:"maxunavailable",level:3},{value:"maxSurge",id:"maxsurge",level:3},{value:"Probe",id:"probe",level:2},{value:"livenessProbe",id:"livenessprobe",level:3},{value:"readinessProbe",id:"readinessprobe",level:3},{value:"\uc751\ub2f5 \uc911\uc778 \ud30c\ub4dc \uad50\uccb4",id:"\uc751\ub2f5-\uc911\uc778-\ud30c\ub4dc-\uad50\uccb4",level:2},{value:"\ud30c\ub4dc 1:1 \uad50\uccb4",id:"\ud30c\ub4dc-11-\uad50\uccb4",level:2},{value:"Blue/Green",id:"bluegreen",level:2}];function o(e){const n={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:["Deployment \uc758 \ud30c\ub4dc \uad50\uccb4 \uc804\ub7b5\uc5d0\ub294 ",(0,s.jsx)(n.strong,{children:"RollingUpdate"})," \uc640 ",(0,s.jsx)(n.strong,{children:"Recreate"})," \uac00 \uc788\ub2e4.\n\uae30\ubcf8 \uac12\uc740 ",(0,s.jsx)(n.strong,{children:"RollingUpdate"})," \uc774\uba70 \uac04\ub2e8\ud55c \uc124\uc815\uc774 \uc801\uc6a9\ub41c \ub514\ud50c\ub85c\uc774\uba3c\ud2b8\ub294 \uc544\ub798\uc640 \uac19\uc744 \uac83\uc774\ub2e4."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: test-rolling-update\n  label:\n    app: test\nspec:\n  replicas: 4\n  strategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 3\n      maxSerge: 4\n  selector:\n    matchLabels:\n      app: test\n  template:\n    metadata:\n      labels:\n        app: test\n    spec:\n      containers:\n        - name: test\n          image: echo\n          ports:\n            - containerPort: 8080\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc5ec\uae30\uc11c \ub864\ub9c1\uc5c5\ub370\uc774\ud2b8 \uc18d\uc131\uc744 \uc880 \ub354 \uc790\uc138\ud788 \uc54c\uc544\ubcf4\uc790."}),"\n",(0,s.jsx)(n.h2,{id:"rollingupdate",children:"RollingUpdate"}),"\n",(0,s.jsx)(n.h3,{id:"maxunavailable",children:"maxUnavailable"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\ub864\ub9c1 \uc5c5\ub370\uc774\ud2b8 \uc911 \ub3d9\uc2dc\uc5d0 \uc0ad\uc81c\ud560 \uc218 \uc788\ub294 \ud30c\ub4dc\uc758 \ucd5c\ub300 \uac2f\uc218"}),"\n",(0,s.jsx)(n.li,{children:"\uae30\ubcf8 \uac12\uc740 replicas\uc758 25% \uc774\ub2e4."}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"replicas: 4"}),"\uc758 \uacbd\uc6b0 1\uac1c \ud30c\ub4dc \uc0ad\uc81c, ",(0,s.jsx)(n.code,{children:"replicas: 8"}),"\uc758 \uacbd\uc6b0 2\uac1c \ud30c\ub4dc \ub3d9\uc2dc \uc0ad\uc81c"]}),"\n",(0,s.jsx)(n.li,{children:"\ud37c\uc13c\ud2b8 \ubc0f \uc9c1\uc811 \uc9c0\uc815\uc774 \uac00\ub2a5\ud558\ub2e4."}),"\n",(0,s.jsx)(n.li,{children:"\uc704\uc758 \uc608\uc2dc \ub514\ud50c\ub85c\uc774\uba3c\ud2b8\uc5d0\uc11c \ub864\ub9c1\uc5c5\ub370\uc774\ud2b8 \uc2dc\uc791 \uc2dc \ud30c\ub4dc 3\uac1c\uac00 \ubc14\ub85c \uc8fd\ub294\ub2e4."}),"\n",(0,s.jsxs)(n.li,{children:["\uc774 \uac12\uc744 \ub192\uac8c \uc124\uc815\ud558\uba74 \ub3d9\uc2dc\uc5d0 \uad50\uccb4\ub418\ub294 \ud30c\ub4dc\uac00 \ub298\uc5b4\ub098\ubbc0\ub85c \ub864\ub9c1 \uc5c5\ub370\uc774\ud2b8 \uc2dc\uac04\uc774 \uc904\uc5b4\ub4e0\ub2e4.","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\ud558\uc9c0\ub9cc \ub864\ub9c1\uc5c5\ub370\uc774\ud2b8 \uc911\uc5d0 \ub0a8\uc544 \uc788\ub294 \ud30c\ub4dc\uc5d0 \uc694\uccad \uc218\uac00 \ubab0\ub9b4 \uc218 \uc788\ub2e4."}),"\n",(0,s.jsxs)(n.li,{children:["\ub530\ub77c\uc11c ",(0,s.jsx)(n.code,{children:"1"}),"\ub85c \uc124\uc815\ud574 \ud30c\ub4dc\ub97c \ud558\ub098\uc529 \uad50\uccb4\ud558\ub294 \uac83\uc774 \uc548\uc804\ud560 \uc218 \uc788\ub2e4."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"maxsurge",children:"maxSurge"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\ub864\ub9c1 \uc5c5\ub370\uc774\ud2b8 \uc911 \ub3d9\uc2dc\uc5d0 \uc0dd\uc131\ud558\ub294 \ud30c\ub4dc \uac2f\uc218"}),"\n",(0,s.jsx)(n.li,{children:"\uae30\ubcf8 \uac12\uc740 replicas\uc758 25% \uc774\ub2e4."}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"replicas: 4"}),"\uba74\uc11c ",(0,s.jsx)(n.code,{children:"maxSurge: 4"}),"\uba74 \ub864\ub9c1 \uc5c5\ub370\uc774\ud2b8 \uc2dc\uc791 \uc2dc \uc0c8 \ubc84\uc804\uc758 \ud30c\ub4dc\uac00 4\uac1c \ucd94\uac00\ub85c \uc0dd\uc131\ub41c\ub2e4."]}),"\n",(0,s.jsxs)(n.li,{children:["\uc774 \uac12\uc744 \ub192\uac8c \uc124\uc815\ud558\uba74 \ud544\uc694\ud55c \ud30c\ub4dc\ub97c \ube68\ub9ac \uc0dd\uc131\ud558\ubbc0\ub85c \ud30c\ub4dc \uad50\uccb4 \uc2dc\uac04\uc774 \ub2e8\ucd95\ub41c\ub2e4.","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\ud558\uc9c0\ub9cc \ud544\uc694\ud55c \uc2dc\uc2a4\ud15c \uc790\uc6d0\uc774 \uae09\uc99d\ud560 \uc218 \uc788\ub2e4."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"probe",children:"Probe"}),"\n",(0,s.jsxs)(n.p,{children:["\uc138\ubd80 \uc124\uc815\uc740 ",(0,s.jsx)(n.a,{href:"https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/#configure-probes",children:"Docs"}),"\ub97c \ucc38\uc870\ud558\uc790"]}),"\n",(0,s.jsx)(n.h3,{id:"livenessprobe",children:"livenessProbe"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\uc560\ud50c\ub9ac\ucf00\uc774\uc158 \ud5ec\uc2a4 \uccb4\ud06c \uae30\ub2a5"}),"\n",(0,s.jsx)(n.li,{children:"\uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \uc758\uc874\ud558\ub294 \ucee8\ud14c\uc774\ub108 \uc548\uc758 \ud30c\uc77c\uc758 \uc874\uc7ac\uc5ec\ubd80 \ud655\uc778"}),"\n",(0,s.jsx)(n.li,{children:"Unhealthy \uc0c1\ud0dc\uc758 \uacbd\uc6b0 \ud30c\ub4dc \uc7ac\uc2dc\uc791"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"readinessprobe",children:"readinessProbe"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\ucee8\ud14c\uc774\ub108 \uc678\ubd80\uc5d0\uc11c HTTP \ub4f1\uc758 \ud2b8\ub798\ud53d\uc744 \ubc1c\uc0dd\uc2dc\ucf1c \ucc98\ub9ac\ud560 \uc218 \uc788\ub294 \uc0c1\ud0dc\uc778\uc9c0 \ud655\uc778"}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"tcpSocket"}),"\uc73c\ub85c \ud3ec\ud2b8 \uc9c0\uc815\ub3c4 \uac00\ub2a5\ud558\ub2e4."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\uc751\ub2f5-\uc911\uc778-\ud30c\ub4dc-\uad50\uccb4",children:"\uc751\ub2f5 \uc911\uc778 \ud30c\ub4dc \uad50\uccb4"}),"\n",(0,s.jsxs)(n.p,{children:["\uc751\ub2f5 \uc911\uc778 \ud30c\ub4dc\uac00 \uad50\uccb4\ub418\ub294 \uacbd\uc6b0 ",(0,s.jsx)(n.code,{children:"SIGTERM"})," \uc2e0\ud638\ub97c \ubcf4\ub0b4 \ud30c\ub4dc\uac00 \uc0ad\uc81c\ub418\ub294\ub370,\n",(0,s.jsx)(n.code,{children:"Graceful Shutdown"})," \uc0c1\ud0dc\ub85c \ub9cc\ub4e4\uae30 \uc704\ud574\uc11c \uc885\ub8cc \ucc98\ub9ac\uac00 \uc624\ub798 \uac78\ub9ac\ub294 \ud30c\ub4dc\uc5d4 ",(0,s.jsx)(n.strong,{children:"terminationGracePeriodSeconds"})," \ub97c \uc124\uc815\ud574\uc8fc\ub294 \uac83\uc774 \uc88b\ub2e4."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"spec:\n  # \uae30\ubcf8\uac12 30\n  terminationGracePeriodSeconds: 40\n  containers:\n    - name: maria\n      image: maria:latest\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.em,{children:"Nginx"}),"\ucc98\ub7fc ",(0,s.jsx)(n.code,{children:"SIGTERM"})," \uc2dc\uadf8\ub110\uc744 \ubc1b\uace0 \ubc14\ub85c \uc885\ub8cc\ub418\ub294 \uc5b4\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \uc788\ub294 \ud30c\ub4dc\ub77c\uba74, \ub77c\uc774\ud50c\uc0ac\uc774\ud074 \ud6c5\uc744 \ud65c\uc6a9\ud574 \uc548\uc804\ud558\uac8c \uc885\ub8cc\uc2dc\ud0a4\ub294 \uac83\uc774 \uc911\uc694\ud558\ub2e4."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'spec:\n  containers:\n    - name: nginx\n      image: nginx:latest\n      ports:\n        - containerPort: 80\n      lifecycle:\n        # \ud30c\ub4dc \uc885\ub8cc \uc804 \ud6c5\n        preStop:\n          exec:\n            command: ["/usr/sbin/nginx", "-s", "quit"]\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\ud30c\ub4dc-11-\uad50\uccb4",children:"\ud30c\ub4dc 1:1 \uad50\uccb4"}),"\n",(0,s.jsxs)(n.p,{children:["\uadf8\ub807\ub2e4\uba74 ",(0,s.jsx)(n.code,{children:"replicas: 1"}),"\uc778 \ud30c\ub4dc\ub97c 1:1 \uad50\uccb4 \uc2dc\uc5d0\ub294 \uc5b4\ub5a4 \uc804\ub7b5\uc744 \uac00\uc838\uac00\uc57c\ud560\uae4c\n\ub2f5\uc740 \uc544\ub798\uc640 \uac19\ub2e4."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"strategy:\n  type: RollingUpdate\n  rollingUpdate:\n    # \ub864\ub9c1 \uc5c5\ub370\uc774\ud2b8 \uc2dc \uc0ad\uc81c \ub418\ub294 \ud30c\ub4dc \uc218\n    maxUnavailable: 0\n    # \ub864\ub9c1 \uc5c5\ub370\uc774\ud2b8 \uc2dc \uc0c8\ub85c \uc0dd\uc131\ub418\ub294 \ud30c\ub4dc \uc218\n    maxSurge: 1\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\uc5ec\uae30\uc5d0 \ud30c\ub4dc\uac00 \ud2b8\ub798\ud53d\uc744 \ubc1b\uc744 \uc218 \uc788\ub294\uc9c0 ",(0,s.jsx)(n.code,{children:"readinessProbe"}),"\ub97c \ucd94\uac00\ud574\uc8fc\uba74 \ub41c\ub2e4."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"readinessProbe:\n  httpGet:\n    path: /ping\n    port: 80\n  initialDelaySeconds: 5\n  periodSeconds: 5\n  successThreshold: 1\n  failureThreshold: 3\n  timeoutSeconds: 3\n"})}),"\n",(0,s.jsxs)(n.p,{children:["5\ucd08 \ud6c4\uc5d0 5\ucd08\ub9c8\ub2e4 ",(0,s.jsx)(n.code,{children:"/ping"})," \uc744 \ubcf4\ub0b4 \uc131\uacf5\uc5ec\ubd80\ub97c \ud655\uc778\ud55c\ub2e4.\n\ud0c0\uc784\uc544\uc6c3\uc740 3\ucd08\uba70 3\ubc88\uae4c\uc9c0 \uc7ac\uc2dc\ub3c4\ud55c\ub2e4."]}),"\n",(0,s.jsx)(n.h2,{id:"bluegreen",children:"Blue/Green"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\ub514\ud50c\ub85c\uc774\uba3c\ud2b8\ub97c 2\uac1c \ub9cc\ub4e4\uace0, \uc11c\ube44\uc2a4\uc758 selector \uac12\uc744 \ub77c\ubca8\uc5d0 \ub530\ub77c \ubcc0\uacbd\ud558\uc790."}),"\n",(0,s.jsx)(n.li,{children:"\uc11c\ube44\uc2a4\uba54\uc2dc\ub97c \uc5f0\ub3d9\ud558\uba74 \uce74\ub098\ub9ac\uc544 \ubc30\ud3ec \ubc29\uc2dd\ub3c4 \uac00\ub2a5\ud558\ub2e4."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},97793:(e,n,l)=>{l.d(n,{Z:()=>t,a:()=>a});var s=l(50959);const i={},r=s.createContext(i);function a(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);