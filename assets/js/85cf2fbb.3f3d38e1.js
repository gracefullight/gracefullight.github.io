"use strict";(self.webpackChunkgracefullight_github_io=self.webpackChunkgracefullight_github_io||[]).push([[20194],{59754:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>d});var a=n(76687);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var o=a.createContext({}),s=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=s(e.components);return a.createElement(o.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,o=e.parentName,u=p(e,["components","mdxType","originalType","parentName"]),c=s(n),d=r,k=c["".concat(o,".").concat(d)]||c[d]||m[d]||l;return n?a.createElement(k,i(i({ref:t},u),{},{components:n})):a.createElement(k,i({ref:t},u))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,i=new Array(l);i[0]=c;var p={};for(var o in t)hasOwnProperty.call(t,o)&&(p[o]=t[o]);p.originalType=e,p.mdxType="string"==typeof e?e:r,i[1]=p;for(var s=2;s<l;s++)i[s]=n[s];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},58873:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>i,default:()=>m,frontMatter:()=>l,metadata:()=>p,toc:()=>s});var a=n(96428),r=(n(76687),n(59754));const l={title:"\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub864\ub9c1 \uc5c5\ub370\uc774\ud2b8\uc640 \ubc30\ud3ec",authors:"me",tags:["k8s","docker"],date:new Date("2019-12-27T20:43:20.000Z")},i="Deployment",p={permalink:"/2019/12/27/kubernetes-rolling-update",source:"@site/blog/2019/12/27/kubernetes-rolling-update.md",title:"\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub864\ub9c1 \uc5c5\ub370\uc774\ud2b8\uc640 \ubc30\ud3ec",description:"Deployment \uc758 \ud30c\ub4dc \uad50\uccb4 \uc804\ub7b5\uc5d0\ub294 RollingUpdate \uc640 Recreate \uac00 \uc788\ub2e4.",date:"2019-12-27T20:43:20.000Z",formattedDate:"December 27, 2019",tags:[{label:"k8s",permalink:"/tags/k-8-s"},{label:"docker",permalink:"/tags/docker"}],readingTime:4.545,hasTruncateMarker:!1,authors:[{name:"Gracefullight",title:"Owner",url:"https://github.com/gracefullight",imageURL:"https://avatars.githubusercontent.com/u/11773683?v=4",key:"me"}],frontMatter:{title:"\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub864\ub9c1 \uc5c5\ub370\uc774\ud2b8\uc640 \ubc30\ud3ec",authors:"me",tags:["k8s","docker"],date:"2019-12-27T20:43:20.000Z"},prevItem:{title:"\ub9e5 \ucd94\ucc9c \ud328\ud0a4\uc9c0",permalink:"/2019/12/29/mac-recommended-packages"},nextItem:{title:"Pythonic - \uae30\ubcf8\uae30",permalink:"/2019/12/15/Pythonic-the-basics"}},o={authorsImageUrls:[void 0]},s=[{value:"RollingUpdate",id:"rollingupdate",level:2},{value:"maxUnavailable",id:"maxunavailable",level:3},{value:"maxSurge",id:"maxsurge",level:3},{value:"Probe",id:"probe",level:2},{value:"livenessProbe",id:"livenessprobe",level:3},{value:"readinessProbe",id:"readinessprobe",level:3},{value:"\uc751\ub2f5 \uc911\uc778 \ud30c\ub4dc \uad50\uccb4",id:"\uc751\ub2f5-\uc911\uc778-\ud30c\ub4dc-\uad50\uccb4",level:2},{value:"\ud30c\ub4dc 1:1 \uad50\uccb4",id:"\ud30c\ub4dc-11-\uad50\uccb4",level:2},{value:"Blue/Green",id:"bluegreen",level:2}],u={toc:s};function m(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Deployment \uc758 \ud30c\ub4dc \uad50\uccb4 \uc804\ub7b5\uc5d0\ub294 ",(0,r.kt)("strong",{parentName:"p"},"RollingUpdate")," \uc640 ",(0,r.kt)("strong",{parentName:"p"},"Recreate")," \uac00 \uc788\ub2e4.\n\uae30\ubcf8 \uac12\uc740 ",(0,r.kt)("strong",{parentName:"p"},"RollingUpdate")," \uc774\uba70 \uac04\ub2e8\ud55c \uc124\uc815\uc774 \uc801\uc6a9\ub41c \ub514\ud50c\ub85c\uc774\uba3c\ud2b8\ub294 \uc544\ub798\uc640 \uac19\uc744 \uac83\uc774\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: test-rolling-update\n  label:\n    app: test\nspec:\n  replicas: 4\n  strategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 3\n      maxSerge: 4\n  selector:\n    matchLabels:\n      app: test\n  template:\n    metadata:\n      labels:\n        app: test\n    spec:\n      containers:\n        - name: test\n          image: echo\n          ports:\n            - containerPort: 8080\n")),(0,r.kt)("p",null,"\uc5ec\uae30\uc11c \ub864\ub9c1\uc5c5\ub370\uc774\ud2b8 \uc18d\uc131\uc744 \uc880 \ub354 \uc790\uc138\ud788 \uc54c\uc544\ubcf4\uc790."),(0,r.kt)("h2",{id:"rollingupdate"},"RollingUpdate"),(0,r.kt)("h3",{id:"maxunavailable"},"maxUnavailable"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\ub864\ub9c1 \uc5c5\ub370\uc774\ud2b8 \uc911 \ub3d9\uc2dc\uc5d0 \uc0ad\uc81c\ud560 \uc218 \uc788\ub294 \ud30c\ub4dc\uc758 \ucd5c\ub300 \uac2f\uc218"),(0,r.kt)("li",{parentName:"ul"},"\uae30\ubcf8 \uac12\uc740 replicas\uc758 25% \uc774\ub2e4."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"replicas: 4"),"\uc758 \uacbd\uc6b0 1\uac1c \ud30c\ub4dc \uc0ad\uc81c, ",(0,r.kt)("inlineCode",{parentName:"li"},"replicas: 8"),"\uc758 \uacbd\uc6b0 2\uac1c \ud30c\ub4dc \ub3d9\uc2dc \uc0ad\uc81c"),(0,r.kt)("li",{parentName:"ul"},"\ud37c\uc13c\ud2b8 \ubc0f \uc9c1\uc811 \uc9c0\uc815\uc774 \uac00\ub2a5\ud558\ub2e4."),(0,r.kt)("li",{parentName:"ul"},"\uc704\uc758 \uc608\uc2dc \ub514\ud50c\ub85c\uc774\uba3c\ud2b8\uc5d0\uc11c \ub864\ub9c1\uc5c5\ub370\uc774\ud2b8 \uc2dc\uc791 \uc2dc \ud30c\ub4dc 3\uac1c\uac00 \ubc14\ub85c \uc8fd\ub294\ub2e4."),(0,r.kt)("li",{parentName:"ul"},"\uc774 \uac12\uc744 \ub192\uac8c \uc124\uc815\ud558\uba74 \ub3d9\uc2dc\uc5d0 \uad50\uccb4\ub418\ub294 \ud30c\ub4dc\uac00 \ub298\uc5b4\ub098\ubbc0\ub85c \ub864\ub9c1 \uc5c5\ub370\uc774\ud2b8 \uc2dc\uac04\uc774 \uc904\uc5b4\ub4e0\ub2e4.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\ud558\uc9c0\ub9cc \ub864\ub9c1\uc5c5\ub370\uc774\ud2b8 \uc911\uc5d0 \ub0a8\uc544 \uc788\ub294 \ud30c\ub4dc\uc5d0 \uc694\uccad \uc218\uac00 \ubab0\ub9b4 \uc218 \uc788\ub2e4."),(0,r.kt)("li",{parentName:"ul"},"\ub530\ub77c\uc11c ",(0,r.kt)("inlineCode",{parentName:"li"},"1"),"\ub85c \uc124\uc815\ud574 \ud30c\ub4dc\ub97c \ud558\ub098\uc529 \uad50\uccb4\ud558\ub294 \uac83\uc774 \uc548\uc804\ud560 \uc218 \uc788\ub2e4.")))),(0,r.kt)("h3",{id:"maxsurge"},"maxSurge"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\ub864\ub9c1 \uc5c5\ub370\uc774\ud2b8 \uc911 \ub3d9\uc2dc\uc5d0 \uc0dd\uc131\ud558\ub294 \ud30c\ub4dc \uac2f\uc218"),(0,r.kt)("li",{parentName:"ul"},"\uae30\ubcf8 \uac12\uc740 replicas\uc758 25% \uc774\ub2e4."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"replicas: 4"),"\uba74\uc11c ",(0,r.kt)("inlineCode",{parentName:"li"},"maxSurge: 4"),"\uba74 \ub864\ub9c1 \uc5c5\ub370\uc774\ud2b8 \uc2dc\uc791 \uc2dc \uc0c8 \ubc84\uc804\uc758 \ud30c\ub4dc\uac00 4\uac1c \ucd94\uac00\ub85c \uc0dd\uc131\ub41c\ub2e4."),(0,r.kt)("li",{parentName:"ul"},"\uc774 \uac12\uc744 \ub192\uac8c \uc124\uc815\ud558\uba74 \ud544\uc694\ud55c \ud30c\ub4dc\ub97c \ube68\ub9ac \uc0dd\uc131\ud558\ubbc0\ub85c \ud30c\ub4dc \uad50\uccb4 \uc2dc\uac04\uc774 \ub2e8\ucd95\ub41c\ub2e4.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\ud558\uc9c0\ub9cc \ud544\uc694\ud55c \uc2dc\uc2a4\ud15c \uc790\uc6d0\uc774 \uae09\uc99d\ud560 \uc218 \uc788\ub2e4.")))),(0,r.kt)("h2",{id:"probe"},"Probe"),(0,r.kt)("p",null,"\uc138\ubd80 \uc124\uc815\uc740 ",(0,r.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/#configure-probes"},"Docs"),"\ub97c \ucc38\uc870\ud558\uc790"),(0,r.kt)("h3",{id:"livenessprobe"},"livenessProbe"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\uc560\ud50c\ub9ac\ucf00\uc774\uc158 \ud5ec\uc2a4 \uccb4\ud06c \uae30\ub2a5"),(0,r.kt)("li",{parentName:"ul"},"\uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \uc758\uc874\ud558\ub294 \ucee8\ud14c\uc774\ub108 \uc548\uc758 \ud30c\uc77c\uc758 \uc874\uc7ac\uc5ec\ubd80 \ud655\uc778"),(0,r.kt)("li",{parentName:"ul"},"Unhealthy \uc0c1\ud0dc\uc758 \uacbd\uc6b0 \ud30c\ub4dc \uc7ac\uc2dc\uc791")),(0,r.kt)("h3",{id:"readinessprobe"},"readinessProbe"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\ucee8\ud14c\uc774\ub108 \uc678\ubd80\uc5d0\uc11c HTTP \ub4f1\uc758 \ud2b8\ub798\ud53d\uc744 \ubc1c\uc0dd\uc2dc\ucf1c \ucc98\ub9ac\ud560 \uc218 \uc788\ub294 \uc0c1\ud0dc\uc778\uc9c0 \ud655\uc778"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"tcpSocket"),"\uc73c\ub85c \ud3ec\ud2b8 \uc9c0\uc815\ub3c4 \uac00\ub2a5\ud558\ub2e4.")),(0,r.kt)("h2",{id:"\uc751\ub2f5-\uc911\uc778-\ud30c\ub4dc-\uad50\uccb4"},"\uc751\ub2f5 \uc911\uc778 \ud30c\ub4dc \uad50\uccb4"),(0,r.kt)("p",null,"\uc751\ub2f5 \uc911\uc778 \ud30c\ub4dc\uac00 \uad50\uccb4\ub418\ub294 \uacbd\uc6b0 ",(0,r.kt)("inlineCode",{parentName:"p"},"SIGTERM")," \uc2e0\ud638\ub97c \ubcf4\ub0b4 \ud30c\ub4dc\uac00 \uc0ad\uc81c\ub418\ub294\ub370,\n",(0,r.kt)("inlineCode",{parentName:"p"},"Graceful Shutdown")," \uc0c1\ud0dc\ub85c \ub9cc\ub4e4\uae30 \uc704\ud574\uc11c \uc885\ub8cc \ucc98\ub9ac\uac00 \uc624\ub798 \uac78\ub9ac\ub294 \ud30c\ub4dc\uc5d4 ",(0,r.kt)("strong",{parentName:"p"},"terminationGracePeriodSeconds")," \ub97c \uc124\uc815\ud574\uc8fc\ub294 \uac83\uc774 \uc88b\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"spec:\n  # \uae30\ubcf8\uac12 30\n  terminationGracePeriodSeconds: 40\n  containers:\n    - name: maria\n      image: maria:latest\n")),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Nginx"),"\ucc98\ub7fc ",(0,r.kt)("inlineCode",{parentName:"p"},"SIGTERM")," \uc2dc\uadf8\ub110\uc744 \ubc1b\uace0 \ubc14\ub85c \uc885\ub8cc\ub418\ub294 \uc5b4\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \uc788\ub294 \ud30c\ub4dc\ub77c\uba74, \ub77c\uc774\ud50c\uc0ac\uc774\ud074 \ud6c5\uc744 \ud65c\uc6a9\ud574 \uc548\uc804\ud558\uac8c \uc885\ub8cc\uc2dc\ud0a4\ub294 \uac83\uc774 \uc911\uc694\ud558\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"spec:\n  containers:\n    - name: nginx\n      image: nginx:latest\n      ports:\n        - containerPort: 80\n      lifecycle:\n        # \ud30c\ub4dc \uc885\ub8cc \uc804 \ud6c5\n        preStop:\n          exec:\n            command: ['/usr/sbin/nginx', '-s', 'quit']\n")),(0,r.kt)("h2",{id:"\ud30c\ub4dc-11-\uad50\uccb4"},"\ud30c\ub4dc 1:1 \uad50\uccb4"),(0,r.kt)("p",null,"\uadf8\ub807\ub2e4\uba74 ",(0,r.kt)("inlineCode",{parentName:"p"},"replicas: 1"),"\uc778 \ud30c\ub4dc\ub97c 1:1 \uad50\uccb4 \uc2dc\uc5d0\ub294 \uc5b4\ub5a4 \uc804\ub7b5\uc744 \uac00\uc838\uac00\uc57c\ud560\uae4c\n\ub2f5\uc740 \uc544\ub798\uc640 \uac19\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"strategy:\n  type: RollingUpdate\n  rollingUpdate:\n    # \ub864\ub9c1 \uc5c5\ub370\uc774\ud2b8 \uc2dc \uc0ad\uc81c \ub418\ub294 \ud30c\ub4dc \uc218\n    maxUnavailable: 0\n    # \ub864\ub9c1 \uc5c5\ub370\uc774\ud2b8 \uc2dc \uc0c8\ub85c \uc0dd\uc131\ub418\ub294 \ud30c\ub4dc \uc218\n    maxSurge: 1\n")),(0,r.kt)("p",null,"\uc5ec\uae30\uc5d0 \ud30c\ub4dc\uac00 \ud2b8\ub798\ud53d\uc744 \ubc1b\uc744 \uc218 \uc788\ub294\uc9c0 ",(0,r.kt)("inlineCode",{parentName:"p"},"readinessProbe"),"\ub97c \ucd94\uac00\ud574\uc8fc\uba74 \ub41c\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"readinessProbe:\n  httpGet:\n    path: /ping\n    port: 80\n  initialDelaySeconds: 5\n  periodSeconds: 5\n  successThreshold: 1\n  failureThreshold: 3\n  timeoutSeconds: 3\n")),(0,r.kt)("p",null,"5\ucd08 \ud6c4\uc5d0 5\ucd08\ub9c8\ub2e4 ",(0,r.kt)("inlineCode",{parentName:"p"},"/ping")," \uc744 \ubcf4\ub0b4 \uc131\uacf5\uc5ec\ubd80\ub97c \ud655\uc778\ud55c\ub2e4.\n\ud0c0\uc784\uc544\uc6c3\uc740 3\ucd08\uba70 3\ubc88\uae4c\uc9c0 \uc7ac\uc2dc\ub3c4\ud55c\ub2e4."),(0,r.kt)("h2",{id:"bluegreen"},"Blue/Green"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\ub514\ud50c\ub85c\uc774\uba3c\ud2b8\ub97c 2\uac1c \ub9cc\ub4e4\uace0, \uc11c\ube44\uc2a4\uc758 selector \uac12\uc744 \ub77c\ubca8\uc5d0 \ub530\ub77c \ubcc0\uacbd\ud558\uc790."),(0,r.kt)("li",{parentName:"ul"},"\uc11c\ube44\uc2a4\uba54\uc2dc\ub97c \uc5f0\ub3d9\ud558\uba74 \uce74\ub098\ub9ac\uc544 \ubc30\ud3ec \ubc29\uc2dd\ub3c4 \uac00\ub2a5\ud558\ub2e4.")))}m.isMDXComponent=!0}}]);