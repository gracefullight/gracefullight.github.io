"use strict";(self.webpackChunkgracefullight_github_io=self.webpackChunkgracefullight_github_io||[]).push([[68671],{88264:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>c,default:()=>o,frontMatter:()=>i,metadata:()=>l,toc:()=>d});var s=t(11527),r=t(46224);const i={title:"PHP 7.1\uc5d0\uc11c mcrypt \ub300\uccb4\ud558\uae30",authors:"me",tags:["php","openssl"],date:new Date("2017-07-07T22:33:46.000Z")},c="MCRYPT",l={permalink:"/2017/07/07/PHP-7-1\uc5d0\uc11c-mcrypt-\ub300\uccb4\ud558\uae30",source:"@site/blog/2017/07/07/PHP-7-1\uc5d0\uc11c-mcrypt-\ub300\uccb4\ud558\uae30.md",title:"PHP 7.1\uc5d0\uc11c mcrypt \ub300\uccb4\ud558\uae30",description:"- \uc554\ud638\ud654 \ud568\uc218\uc778 mcrypt \uac00 PHP 7.1 \ubc84\uc804\ubd80\ud130 Deprecated \ub418\uc5c8\ub2e4.",date:"2017-07-07T22:33:46.000Z",formattedDate:"2017\ub144 7\uc6d4 7\uc77c",tags:[{label:"php",permalink:"/tags/php"},{label:"openssl",permalink:"/tags/openssl"}],readingTime:2.905,hasTruncateMarker:!1,authors:[{name:"Eunkwang Shin",title:"Owner",url:"https://github.com/gracefullight",imageURL:"https://avatars.githubusercontent.com/u/11773683?v=4",key:"me"}],frontMatter:{title:"PHP 7.1\uc5d0\uc11c mcrypt \ub300\uccb4\ud558\uae30",authors:"me",tags:["php","openssl"],date:"2017-07-07T22:33:46.000Z"},unlisted:!1,prevItem:{title:"Laravel 5.5 - \ub85c\uadf8\uc778(Auth) \ubd99\ud788\uae30",permalink:"/2017/07/09/Laravel-5-4-Login-with-Auth"},nextItem:{title:"Paypal \uae30\ubd80 \ubc84\ud2bc \ub9cc\ub4e4\uae30",permalink:"/2017/07/03/Paypal-\uae30\ubd80-\ubc84\ud2bc-\ub9cc\ub4e4\uae30"}},p={authorsImageUrls:[void 0]},d=[{value:"\uae30\uc874 \uc18c\uc2a4",id:"\uae30\uc874-\uc18c\uc2a4",level:2},{value:"\ub300\uc548",id:"\ub300\uc548",level:2},{value:"Encrypt",id:"encrypt",level:2},{value:"Decrypt",id:"decrypt",level:2},{value:"PKCS5 vs PKCS7",id:"pkcs5-vs-pkcs7",level:2},{value:"triple des",id:"triple-des",level:2}];function a(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\uc554\ud638\ud654 \ud568\uc218\uc778 ",(0,s.jsx)(n.code,{children:"mcrypt"})," \uac00 PHP 7.1 \ubc84\uc804\ubd80\ud130 Deprecated \ub418\uc5c8\ub2e4."]}),"\n",(0,s.jsxs)(n.li,{children:["\uc65c \uc0ac\ub77c\uc84c\ub294\uc9c0\ub294 ",(0,s.jsx)(n.a,{href:"https://paragonie.com/blog/2015/05/if-you-re-typing-word-mcrypt-into-your-code-you-re-doing-it-wrong",children:"\ub9c1\ud06c"}),"\uc5d0 \uc790\uc138\ud558\uac8c \ub098\uc640\uc788\ub2e4."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\uae30\uc874-\uc18c\uc2a4",children:"\uae30\uc874 \uc18c\uc2a4"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["PHP \uad6c\ubc84\uc804\uc5d0\uc11c\ub294 ",(0,s.jsx)(n.code,{children:"mcrypt"})," \uc640 ",(0,s.jsx)(n.code,{children:"MCRYPT_RIJNDAEL_128"})," \uc54c\uace0\ub9ac\uc998\uc744 \ud1b5\ud574 AES128 \uc774 \uad6c\ud604\ub418\uc5b4 \uc788\uc744 \uac83\uc774\ub2e4."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"MCRYPT_RIJNDAEL_128"}),"\uc740 ",(0,s.jsx)(n.strong,{children:"AES 128"}),"\uacfc ",(0,s.jsx)(n.strong,{children:"\ub3d9\uc77c"}),"\ud558\ub2e4."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\ud0c0 \uc5b8\uc5b4\uc640\ub294 \uc870\uae08 \ub2e4\ub978\ub370, \ud638\ud658\uc744 \uc704\ud574\uc120 pkcs5 padding \uc73c\ub85c \ubcc0\uacbd\ud574\uc8fc\ub294 \uc791\uc5c5\uc774 \ud544\uc694\ud558\ub2e4."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"php mcrypt function \uc758 \uae30\ubcf8 \ud328\ub529\uc740 zeros padding"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:'<?php\n// \uc774\ub7f0 \uc2dd\uc774\uac70\ub098\n$cipherText = mcrypt_encrypt(MCRYPT_RIJNDAEL_128, $key, pkcs5_pad($plainText), MCRYPT_MODE_CBC, $iv);\n\n// \uc774\ub7f0 \uc2dd\uc77c \uac83\n$td = mcrypt_module_open("rijndael-128", "", "cbc", "");\n@mcrypt_generic_init($td, $key, $iv);\n$cipherText = @mcrypt_generic($td, pkcs5_pad($plainText));\nmcrypt_generic_deinit($td);\nmcrypt_module_close($td);\n\nfunction pkcs5_pad($text, $blockSize = 16) {\n  $pad = $blockSize - (strlen($text) % $blockSize);\n  return $text . str_repeat(chr($pad), $pad);\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\ub300\uc548",children:"\ub300\uc548"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["PHP 5.3 \ubd80\ud130 \uc0ac\uc6a9 \uac00\ub2a5\ud55c ",(0,s.jsx)(n.strong,{children:"openssl_encrypt"})," \ud568\uc218\ub97c \uc4f0\uba74 \ub41c\ub2e4."]}),"\n",(0,s.jsx)(n.li,{children:"openssl \ud655\uc7a5 \ubaa8\ub4c8\uc774 \uc124\uce58\ub418\uc5b4\uc57c\ud55c\ub2e4."}),"\n"]}),"\n",(0,s.jsx)(n.h1,{id:"openssl",children:"OPENSSL"}),"\n",(0,s.jsx)(n.h2,{id:"encrypt",children:"Encrypt"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"<?php\n$cipherText = openssl_encrypt($plainText, 'AES-128-CBC', $key, OPENSSL_RAW_DATA, $iv);\n// decrypt\uc5d0\uc11c \uc624\ub958\uac00 \ubc1c\uc0dd\ud574 PKCS5\ub85c \ud328\ub529\uc744 \ub9de\ucdb0\uc8fc\uace0 \ubcf4\ub0b4\uc57c\ud55c\ub2e4\uba74.\n$cipherText = openssl_encrypt(pkcs5_pad($plainText), 'AES-128-CBC', $key, OPENSSL_RAW_DATA, $iv);\n"})}),"\n",(0,s.jsx)(n.h2,{id:"decrypt",children:"Decrypt"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"<?php\n$plainText = openssl_decrypt($cipherText, 'AES-128-CBC', $key, OPENSSL_RAW_DATA, $iv);\n// unpad\uac00 \ud544\uc694\ud558\ub2e4\uba74\n$plainText = pkcs5_unpad(openssl_decrypt($cipherText, 'AES-128-CBC', $key, OPENSSL_RAW_DATA, $iv));\n\nfunction pkcs5_unpad($text) {\n  $pad = ord($text{strlen($text)-1});\n  if ($pad > strlen($text)) {\n    return $text;\n  }\n  if (!strspn($text, chr($pad), strlen($text) - $pad)) {\n    return $text;\n  }\n  return substr($text, 0, -1 * $pad);\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"pkcs5-vs-pkcs7",children:"PKCS5 vs PKCS7"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"openssl_encrypt"}),"\uc758 default padding \uc740 PKCS7 padding \uc778\ub370, \uc5b4\ub5bb\uac8c \ud638\ud658\uc774 \ub418\ub294 \uac83\uc77c\uae4c?"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://social.msdn.microsoft.com/Forums/en-US/09fef7b7-b568-4895-8e52-f386be80aa2d/pkcs7-padding-in-net-vs-pkcs5-padding-in-java?forum=csharpgeneral",children:"\uc5ec\uae30"}),"\uc11c \ud574\ub2f5\uc744 \ucc3e\uc558\ub2e4."]}),"\n"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"The difference between the PKCS#5 and PKCS#7 padding mechanisms is the block size;\nPKCS#5 padding is defined for 8-byte block sizes, PKCS#7 padding would work for any block size from 1 to 255 bytes.\nSo fundamentally PKCS#5 padding is a subset of PKCS#7 padding for 8 byte block sizes.\nso, data encrypted with PKCS#5 is able to decrypt with PKCS#7, but data encrypted with PKCS#7 may not be able to decrypt with PKCS#5."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"triple-des",children:"triple des"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"des-ede3-cbc"}),"\uac00 triple des \uc54c\uace0\ub9ac\uc998\uc774\ub2e4."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:'<?php\n// encrypt\nopenssl_encrypt($text, "des-ede3-cbc", $key, OPENSSL_RAW_DATA, $iv);\n\n// decrypt\nopenssl_decrypt($cipherText, "des-ede3-cbc", $key, OPENSSL_RAW_DATA, $iv);\n'})}),"\n",(0,s.jsx)(n.h1,{id:"\ud328\ud0a4\uc9c0",children:"\ud328\ud0a4\uc9c0"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\uc774 \ubaa8\ub4e0 \uac78 \ucee4\ubc84\ud558\ub294 \ub77c\uc774\ube0c\ub7ec\ub9ac\ub97c \uc0ac\uc6a9\ud558\uc790. ",(0,s.jsx)(n.a,{href:"https://github.com/phpseclib/mcrypt_compat",children:"phpseclib/mcrypt_compat"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.em,{children:"phpseclib"})," \ub294 laravel/passport \uc5d0\uc11c\ub3c4 \uc0ac\uc6a9\ub418\uc5c8\ub2e4."]}),"\n"]}),"\n",(0,s.jsx)(n.h1,{id:"\uc5ec\ub2f4",children:"\uc5ec\ub2f4"}),"\n",(0,s.jsx)(n.p,{children:"\uce74\uce74\uc624\ud398\uc774\uac00 PHP 5 \ubc84\uc804\ub9cc \uc9c0\uc6d0\ud574 \ubb38\uc758\ud574\ubd24\uc9c0\ub9cc \uacc4\ud68d\uc774 \uc5c6\uc5b4 \uc774\ubc88 \uae30\ud68c\uc5d0 \ubaa8\ub4c8\uc744 \ub2e4 \ub72f\uc5b4\ubd24\ub294\ub370 MCRYPT \ub9cc \ub9cc\uc838\uc8fc\uba74 \uc815\uc0c1\uc801\uc73c\ub85c \uacb0\uc81c\uac00 \ub418\uc5c8\ub2e4."}),"\n",(0,s.jsxs)(n.p,{children:["\uace7 \uc774 \uc9d3\uc744 \uc548\ud574\ub3c4 \ub420 \ub4ef\ud558\ub2e4.\n",(0,s.jsx)(n.img,{src:"https://i.imgur.com/QBA9xnP.jpg",alt:"KakaoPay \uc885\ub8cc"})]}),"\n",(0,s.jsx)(n.p,{children:"\uc774\ub7ec\ub2e4\uac00 \ub2e4\uc2dc \uc120\ud615\ub300\uc218\ud559 \uacf5\ubd80\ud558\uaca0\uc5b4."})]})}function o(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},46224:(e,n,t)=>{t.d(n,{Z:()=>l,a:()=>c});var s=t(50959);const r={},i=s.createContext(r);function c(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);