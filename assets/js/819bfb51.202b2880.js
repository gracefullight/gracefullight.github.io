"use strict";(self.webpackChunkgracefullight_github_io=self.webpackChunkgracefullight_github_io||[]).push([["77338"],{70933(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>c});var s=t(42302),r=t(74848),a=t(28453);let i={title:"\uC11C\uBE44\uC2A4\uC6CC\uCEE4\uB85C POST Request \uCE90\uC2F1\uD558\uAE30",authors:"me",tags:["javascript","pwa","serviceworker"],date:new Date("2020-01-16T23:58:30.000Z")},o,l={authorsImageUrls:[void 0]},c=[{value:"\uC55E\uC11C",id:"\uC55E\uC11C",level:2},{value:"\uC18C\uC2A4",id:"\uC18C\uC2A4",level:2},{value:"\uC5EC\uB2F4",id:"\uC5EC\uB2F4",level:2}];function h(e){let n={a:"a",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"\uC55E\uC11C",children:"\uC55E\uC11C"}),"\n",(0,r.jsxs)(n.p,{children:["\uC11C\uBE44\uC2A4\uC6CC\uCEE4\uB85C Navigation Request \uB098 Static Assets \uC5D0 \uB300\uD55C \uB9AC\uC18C\uC2A4 \uCE90\uC2DC\uB294 \uC27D\uB2E4.\n(",(0,r.jsx)(n.a,{href:"/2017/12/22/PWA-ServiceWorker-Web-Caching/",children:"\uC774\uC804 \uD3EC\uC2A4\uD305"})," \uCC38\uC870)"]}),"\n",(0,r.jsxs)(n.p,{children:["\uD558\uC9C0\uB9CC ",(0,r.jsx)(n.code,{children:"POST Request"})," \uC5D0 \uB300\uD55C \uB808\uD37C\uB7F0\uC2A4\uB294 \uCC3E\uAE30 \uD798\uB4E4\uC5B4 \uACB0\uAD6D \uB9CC\uB4E4\uC5B4\uBC84\uB838\uB2E4.\n\uBCF5\uC7A1\uD55C \uB85C\uC9C1\uC774\uC9C0\uB9CC Request Body \uB97C SHA1\uB85C \uD574\uC2F1\uD574 \uD0A4\uB85C IndexedDB \uC5D0 \uC800\uC7A5\uD558\uACE0 \uADF8 \uD0A4\uAC00 \uB9DE\uC73C\uBA74 \uAEBC\uB0B4\uC8FC\uB294 \uBC29\uC2DD\uC774\uB2E4."]}),"\n",(0,r.jsx)(n.h2,{id:"\uC18C\uC2A4",children:"\uC18C\uC2A4"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'// IndexedDB \uB294 Promisify \uB418\uC5B4\uC788\uC9C0 \uC54A\uC544\uC11C \uB77C\uC774\uBE0C\uB7EC\uB9AC\uAC00 \uD544\uC694\uD558\uB2E4.\nimportScripts(\n  "https://cdn.jsdelivr.net/npm/localforage@1.7.3/dist/localforage.min.js",\n);\n\n// \uCE90\uC2DC\uD558\uACE0 \uC2F6\uC740 POST \uC5D4\uB4DC\uD3EC\uC778\uD2B8\nconst ENDPOINT = "https://your-domain/post-request";\n\nconst bin2Hex = (buffer) => {\n  let digest = "";\n  const dataView = new DataView(buffer);\n  for (let i = 0, len = dataView.byteLength; i < len; i += 4) {\n    const value = dataView.getUint32(i);\n    // hex \uB85C \uBC14\uAFB8\uBA74 \uD328\uB529\uBE44\uD2B8 0 \uC774 \uC81C\uAC70\uB41C\uB2E4.\n    const hex = value.toString(16);\n    // uint32 \uB294 4bytes \uB85C \uB098\uC628\uB2E4.\n    const padding = "00000000";\n    // \uD328\uB529\uC744 \uB354\uD574\uC11C \uB4A4\uC5D0\uC11C \uC798\uB77C\uC900\uB2E4.\n    const paddedValue = (padding + hex).slice(-padding.length);\n    digest += paddedValue;\n  }\n\n  return digest;\n};\n\nconst postRequestFetchListener = (fetchEvent) => {\n  const requestUrl = fetchEvent.request.url;\n  const method = fetchEvent.request.method.toUpperCase();\n  // \uB9DE\uB294 \uC5D4\uB4DC\uD3EC\uC778\uD2B8\uC778\uC9C0 \uD655\uC778\n  if (!(method === "POST" && requestUrl === ENDPOINT)) {\n    return;\n  }\n\n  fetchEvent.respondWith(\n    fetchEvent.request\n      .clone()\n      .arrayBuffer()\n      .then((buffer) => {\n        const requestBody = String.fromCharCode.apply(\n          null,\n          new Uint8Array(buffer),\n        );\n        // request body \uC5D0 \uC6D0\uD558\uB294 \uC870\uAC74\uB9CC \uCE90\uC2DC\uCC98\uB9AC\uD560 \uC218 \uC788\uAC8C \uD55C\uB2E4.\n        if (requestBody.includes("cache=1")) {\n          // \uC18D\uB3C4\uBA74\uC5D0\uC11C \uB2E4\uB978 \uD574\uC2F1 \uC54C\uACE0\uB9AC\uC998\uC744 \uC0AC\uC6A9\uD574\uB3C4 \uBB34\uBC29\uD558\uB2E4.\n          return crypto.subtle.digest("SHA-1", buffer);\n        }\n\n        return Promise.reject();\n      })\n      .then((sha1Buffer) => {\n        const sha1Hash = bin2Hex(sha1Buffer);\n        console.log("SHA1 Hash => ", sha1Hash);\n\n        // IndexedDB \uC5D0\uC11C \uCE90\uC2DC\uB41C \uD0A4\uB97C \uCC3E\uB294\uB2E4.\n        return localforage.getItem(sha1Hash).then((cachedResponse) => {\n          if (cachedResponse) {\n            console.log("Cached repsonse => ", cachedResponse);\n            return new Response(cachedResponse, {\n              // \uC5EC\uAE30\uC11C statusCode \uB97C 304 \uB85C \uB0B4\uBCF4\uB0B4\uACE0 \uC2F6\uC5C8\uC73C\uB098, Body \uB97C \uBC18\uD658\uD560 \uC218 \uC5C6\uC5C8\uB2E4.\n              status: 200,\n              statusText: "OK",\n              headers: {\n                "Content-Length": cachedResponse.length,\n                "Content-Type": "application/json",\n                // \uADF8\uB798\uC11C \uCEE4\uC2A4\uD140 \uD5E4\uB354\uB97C \uCD94\uAC00\uD588\uB2E4.\n                "X-SW-Cache-Hit": 1,\n                "X-SW-Cache-Type": "POST",\n              },\n            });\n          }\n\n          // \uCE90\uC2DC\uB41C \uB370\uC774\uD130\uAC00 \uC5C6\uC744 \uACBD\uC6B0 \uC0C8\uB85C \uC694\uCCAD\uD55C\uB2E4.\n          return fetch(fetchEvent.request).then((response) => {\n            console.log("Fetching response => ", response.clone());\n\n            // \uC815\uC0C1\uC801\uC77C \uACBD\uC6B0\uB9CC IndexedDB \uC5D0 \uC800\uC7A5\uD55C\uB2E4.\n            if (200 <= response.status && response.status < 400) {\n              // \uC774 \uC791\uC5C5\uC740 \uBE44\uB3D9\uAE30\uC9C0\uB9CC \uAD73\uC774 \uAE30\uB2E4\uB9AC\uC9C0 \uC54A\uC544\uB3C4 \uB41C\uB2E4.\n              response\n                .clone()\n                .text()\n                .then((textResponse) => {\n                  console.log("Caching response => ", textResponse);\n                  return localforage.setItem(sha1Hash, textResponse);\n                });\n            }\n\n            return response;\n          });\n        });\n      })\n      .catch(() => fetch(fetchEvent.request)),\n  );\n};\n\n// \uB9AC\uC2A4\uB108\uB97C \uB4F1\uB85D\uD574\uC900\uB2E4.\nself.addEventListener("fetch", postRequestFetchListener);\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\uC5EC\uB2F4",children:"\uC5EC\uB2F4"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["WorkBox \uB97C \uC0AC\uC6A9\uD560 \uC218 \uC788\uB2E4\uBA74 ",(0,r.jsx)(n.a,{href:"https://developers.google.com/web/tools/workbox/modules/workbox-cacheable-response#caching_based_on_headers",children:"CacheableResponse"}),"\uC640 CacheFirst \uC815\uCC45\uC73C\uB85C \uB2E8\uBC88\uC5D0 \uCC98\uB9AC \uAC00\uB2A5\uD560 \uAC83\uC774\uB2E4."]}),"\n",(0,r.jsx)(n.li,{children:"\uAD73\uC774 \uD574\uC2DC\uB97C \uD0A4\uB85C \uC0AC\uC6A9\uD558\uC9C0 \uC54A\uC544\uB3C4 \uB41C\uB2E4. RequestBody \uC758 Serialize \uB97C \uD0A4\uB85C \uC368\uB3C4 \uB41C\uB2E4. (\uB9CC\uB4E4\uBA74\uC11C crypto \uB77C\uC774\uBE0C\uB7EC\uB9AC\uB97C \uC0AC\uC6A9\uD574\uBCF4\uACE0 \uC2F6\uC5C8\uC744 \uBFD0)"}),"\n"]})]})}function u(e={}){let{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},28453(e,n,t){t.d(n,{R:()=>i,x:()=>o});var s=t(96540);let r={},a=s.createContext(r);function i(e){let n=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),s.createElement(a.Provider,{value:n},e.children)}},42302(e){e.exports=JSON.parse('{"permalink":"/2020/01/16/Serviceworker-cache-POST-requests","source":"@site/blog/2020/01/16/Serviceworker-cache-POST-requests.md","title":"\uC11C\uBE44\uC2A4\uC6CC\uCEE4\uB85C POST Request \uCE90\uC2F1\uD558\uAE30","description":"\uC55E\uC11C","date":"2020-01-16T23:58:30.000Z","tags":[{"inline":false,"label":"javascript","permalink":"/tags/javascript","description":"Any application that can be written in JavaScript, will eventually be written in JavaScript"},{"inline":true,"label":"pwa","permalink":"/tags/pwa"},{"inline":true,"label":"serviceworker","permalink":"/tags/serviceworker"}],"readingTime":1.79,"hasTruncateMarker":false,"authors":[{"name":"Eunkwang Shin","title":"Owner","url":"https://github.com/gracefullight","socials":{"linkedin":"https://www.linkedin.com/in/gracefullight/","github":"https://github.com/gracefullight","email":"mailto:gracefullight.dev@gmail.com"},"description":"Full Stack JavaScript Developer | Half-time Open Sourcerer.","page":{"permalink":"/authors/me"},"imageURL":"https://avatars.githubusercontent.com/u/11773683?v=4","key":"me"}],"frontMatter":{"title":"\uC11C\uBE44\uC2A4\uC6CC\uCEE4\uB85C POST Request \uCE90\uC2F1\uD558\uAE30","authors":"me","tags":["javascript","pwa","serviceworker"],"date":"2020-01-16T23:58:30.000Z"},"unlisted":false,"prevItem":{"title":"\uCFE0\uBC84\uB124\uD2F0\uC2A4 \uB9AC\uB205\uC2A4 \uCEE4\uB110 \uD29C\uB2DD\uD558\uAE30","permalink":"/2020/01/24/k8s-linux-kernel-tuning"},"nextItem":{"title":"Dockerfile\uC758 \uBAA8\uB4E0 \uAC83","permalink":"/2020/01/13/Dockerfile\uC758-\uBAA8\uB4E0-\uAC83"}}')}}]);